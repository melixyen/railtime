
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html lang="zh-TW" xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width; initial-scale=1.0" />
<meta name="description" content="接軌時刻 - 台灣鐵路火車捷運時刻表及路線轉乘查詢系統 Taiwan Railway MRT Timetable Web APP" />
<meta name="keywords" content="捷運,台鐵,火車,鐵路,時刻表,轉乘,TRA,TRTC,MRT,Timetable,Taiwan Railway,接軌時刻" />
<meta http-equiv="X-UA-Compatible" content="IE=Edge">
<title>接軌時刻 - Taiwan Railway MRT Timetable Web APP</title>
<style type="text/css">
@charset "utf-8";

body {
    /*font-family:'細明體', "PMingLiU";*/
    font-size: 14px;
    margin: 0px;
}

.headerBar{
    position: fixed;
    height: 40px;
    max-height: 40px;
    overflow: hidden;
    top: 0px;
    left: 0px;
    width: 100%;
    line-height: 28px;
    background-color: #FFF;
}
.headerButton, .headerButton2{
    display: inline;
    margin: 3px 6px;
    border: 2px solid #22CCEF;
    background-color: #4BE9F2;
    color: #5E5E5E;
    text-align: center;
    cursor: pointer;
    border-radius: 4px;
    overflow: hidden;
}
.headerButton2{
    border: 2px solid #a2a912;
    background-color: #dbc932;
}
@supports (display: flex) {
    .headerBar{
        display: -webkit-flex;
        display: flex;
    }
    .headerButton{
        -webkit-flex: 1;
        flex: 1;
    }
}

.statusBar{
    position: fixed;
    height: 20px;
    bottom: 0px;
    left: 0px;
    width: 100%;
    background-color: #DDD;
    padding-left: 20px;
    color: #5E3B70;
    line-height: 18px;
    font-size: 12px;
}

.center{
    border: 2px solid #4EBCD5;
    margin: 40px 10px 20px;
    overflow: auto;
}

.centerPage{
    margin: 3px;
    display: none;
    padding-top: 15px;
}
.centerPage.show{
    display: block;
}
.centerPage .selectStationOut{background-color: #E2FAE4;}
.centerPage .selectWeekOut, .centerPage .selectTimeOut{background-color: #FAFAE2;}
.centerPage .selectStationOut .selectStationIn,  .centerPage .findButtonDiv,
.centerPage .selectWeekOut .selectWeekIn,
.centerPage .selectTimeOut .selectTimeIn{
    padding: 5px;
}

.centerPage .selectTimeOut .selectTimeIn .setNow{
    display: inline-block;
    font-size: 12px;
    margin: 0 5px;
    border-radius: 10px;
    border: 2px solid #7CE;
    background-color: #8EF;
    color: #357;
    padding: 0px 8px;
    cursor: pointer;
}

.help_selectStationByLine,
.centerPage .selectStationOut .selectStationIn .selectStationByLine,
.centerPage .selectStationOut .selectStationIn .selectStationExchange{
    display: inline-block;
    border: 2px solid #1A2;
    border-radius: 10px;
    background-color: #2E3;
    color: #131;
    padding: 0px 8px;
    cursor: pointer;
    margin-left: 5px;
}
.centerPage .selectStationOut .selectStationIn .selectStationExchange{
    border: 2px solid #7CE;
    background-color: #8EF;
    color: #357;
}
.centerPage .inputStation{
    display: inline-block;
    width: 120px;
    margin: 0 10px;
}
#ttc_stationSelect_start, #ttc_stationSelect_end{
    background-color: #EEF;
}

.center .frameA{
    border: 1px solid #2E9CB5;
    margin: 10px auto;
    max-width: 1000px;
    padding: 3px;
}
.center .frameA .title{
    font-weight: bold;
    font-size: 16px;
    color: #444;
    margin: 3px;
}

.center .frameB{
    border: 1px solid #4E9CD5;
    margin: 10px auto;
    padding: 3px;
}

.center .ttbDisplay{
    border: 1px solid #4E8CE5;
    margin: 10px auto;
    max-width: 1000px;
}

.center .ttbDisplay .route{
    background-color: #FCF9FD;
    border-bottom: 1px solid #4A4C55;
    margin: 0px;
    min-height: 80px;
    width: 100%;
}
.center .ttbDisplay .train{
    background-color: #FEFEFE;
    margin: 0px;
    min-height: 200px;
    width: 100%;
}

.center .preSetting{
    border-bottom: 1px solid #2C2C2C;
    margin-bottom: 5px;
    padding-bottom: 5px;
}

.inputListStation{
    position: absolute;
    background-color: #FDFDFD;
    border: 1px solid #CACACA;
    top: 0px;
    left: 0px;
    cursor: pointer;
}
.inputListStation .name{
    padding: 5px 10px;
    font-size: 13px;
    color: #2D4DFF;
}
.inputListStation .name:hover{
    background-color: #DFD;
}

.define_rail_bgcolor_tra_xibu, .define_rail_bgcolor_tra_shan, .define_rail_bgcolor_tra_zhjy, .define_rail_bgcolor_tra_jygx, .define_rail_bgcolor_tra_yilan, .define_rail_bgcolor_tra_beihui,
.define_rail_bgcolor_tra_pingxi, .define_rail_bgcolor_tra_liujia, .define_rail_bgcolor_tra_huadong, .define_rail_bgcolor_tra_shalun,
.define_rail_bgcolor_trtc_2, .define_rail_bgcolor_trtc_3, .define_rail_bgcolor_trtc_4, .define_rail_bgcolor_trtc_5{
    color: #EEF !important;
}
.define_rail_bgcolor_tra_xibu{
    background-color: #000050 !important;
}
.define_rail_bgcolor_tra_shan{
    background-color: #104020 !important;
}
.define_rail_bgcolor_tra_zhjy{
    background-color: #707010 !important;
}
.define_rail_bgcolor_tra_jygx{
    background-color: #302040 !important;
}
.define_rail_bgcolor_tra_yilan{
    background-color: #500000 !important;
}
.define_rail_bgcolor_tra_beihui{
    background-color: #004060 !important;
}
.define_rail_bgcolor_tra_huadong{
    background-color: #605040 !important;
}
.define_rail_bgcolor_tra_pingxi{
    background-color: #003030 !important;
}
.define_rail_bgcolor_tra_liujia{
    background-color: #403090 !important;
}
.define_rail_bgcolor_tra_shalun{
    background-color: #124060 !important;
}
.define_rail_bgcolor_trtc_2{
    background-color: #cb2c30 !important;
}
.define_rail_bgcolor_trtc_3{
    background-color: #007749 !important;
}
.define_rail_bgcolor_trtc_4{
    background-color: #ffa300 !important;
    color: #555 !important;
}
.define_rail_bgcolor_trtc_5{
    background-color: #005eb8 !important;
}

.tt_ck_route_sh{
    display:inline-block; border:1px solid #222;
    background-color: #EFBCDF;
    margin: 8px;
    height: 24px;
}
.tt_ck_route_sh .stag{
    color: #FDFDFD;
    background-color: #9c6f2e;
    border:1px solid #812;
    display:inline-block;
    margin-right: 8px;
}
.tt_ck_route_sh .fmin{
    color: #223EED;
}
.tt_ck_route_filterPri{
    display:inline-block; 
    border:2px solid #BA2;
    border-radius: 5px;
    background-color: #EFDC3F;
    margin: 3px 8px;
    height: 20px;
    width: 20px;
    text-align: center;
    font-size: 140%;
    line-height: 20px;
    cursor: pointer;
}

.tt_ck_sortby_sh{
    display:inline-block; 
    border:1px solid #29A;
    border-radius: 8px;
    background-color: #AFBCBF;
    margin: 5px 10px;
    padding: 1px 5px 1px 8px;
    cursor: pointer;
    position: relative;
}
.tt_ck_sortby_sh.select{
    border:1px solid #2A9;
    border-left: 20px solid #3E4;;
    background-color: #AFECAF;
    color: #5C1B6F;
}
.helpForSortBySelectButton .arrow, .helpForRouteCheckBox .arrow{
    display: inline-block;
    position: relative;
    top: 3px;
    border-right: 8px solid #2A9;
    border-top: 8px solid transparent;
    border-bottom: 8px solid transparent;
    margin-right: 5px;
}
.helpForSortBySelectButton{
    color: #FEFEFE;
}
.helpForRouteCheckBox{
    color: #2B3D9A;
}

.timeTableTrainRouteBox{
    margin: 10px 50px 20px 50px;
    padding: 5px 0px;
    border-bottom: 2px solid #041239;
    background-color: #FFF;
}
.timeTableTrainRouteBox .header{
    display: inline-block;
    padding: 5px;
    border: 1px solid #D2E5BA;
}
.timeTableTrainRouteBox .header .sub{
    display: inline;
    margin: 3px 20px 3px 0px;
}

.timeTableTrainRouteBox .header .num{
    color: #901111;
    font-size: 14px;
}
.timeTableTrainRouteBox .header .count .val{
    color: #FF2C0E;
}
.timeTableTrainRouteBox .header .totalTime .val{
    color: #1F9C8E;
}
.timeTableTrainRouteBox .header .startTime .val, .timeTableTrainRouteBox .header .endTime .val{
    color: #1F6CFE;
}
.timeTableTrainRouteBox .header .printCanvas{
    color: #DFF2D2;
    background-color: #30201A;
    padding: 0px 5px;
    border: 1px solid #40302A;
    border-radius: 5px;
    cursor: pointer;
    font-size: 13px;
}

.timeTableTrainRouteBox .timeRouteDiv{
    position: relative;
}
.timeTableTrainRouteBox .table th{
    margin: 3px 10px;
    background-color: #B7EFF0;
    color: #2E0E1E;
    font-size: 16px;
    font-weight: 400;
    border: 2px solid #FDFDFD;
}
.timeTableTrainRouteBox .table td{
    margin: 3px 10px;
    color: #2E0E1E;
    font-size: 14px;
    font-weight: 400;
}
.timeTableTrainRouteBox .table .sect{
    min-width: 40px;
}
.timeTableTrainRouteBox .table .time{
    min-width: 70px;
}
.timeTableTrainRouteBox .table .station{
    min-width: 120px;
}
.timeTableTrainRouteBox .table .info{
    min-width: 150px;
    max-width: 150px;
}
.timeTableTrainRouteBox .table .line{
    min-width: 190px;
    max-width: 250px;
}
.timeTableTrainRouteBox .table .other{
    min-width: 80px;
}
.timeTableTrainRouteBox .table td.sect{
    color: #BD122B;
}
.timeTableTrainRouteBox .transStationVideoClick{
    display: inline-block;
    margin-left: 18px;
    padding: 0px 5px;
    color: #F0FE46;
    background-color: #202029;
    border-radius: 8px;
    cursor: pointer;
    animation-duration: 1s;
    animation-name: ccblink;
    animation-iteration-count: infinite;
    animation-direction: alternate;
    animation-timing-function: ease-in-out;
}
@keyframes ccblink{
    0%{color: #F0FE46;}
    40%{color: #A0FE66;}
    70%{color: #80FE86;}
    100%{color: #A0FE66;}
}

@media screen and (max-width: 579px) {
    .timeTableTrainRouteBox .table .info, .timeTableTrainRouteBox .table .line, .timeTableTrainRouteBox .table .other{
        display: none;
    }
}
@media screen and (min-width: 580px) and (max-width: 779px) {
    .timeTableTrainRouteBox .table .line, .timeTableTrainRouteBox .table .other{
        display: none;
    }
}
@media screen and (min-width: 780px) and (max-width: 909px) {
    .timeTableTrainRouteBox .table .other{
        display: none;
    }
}
.timeTableTrainRouteBox .timeRouteDiv.showAll .table .info, .timeTableTrainRouteBox .timeRouteDiv.showAll .table .line, .timeTableTrainRouteBox .timeRouteDiv.showAll .table .other{
    display: table-cell;
}
.timeTableTrainRouteBox .timeRouteDiv .more, .help_timeTableResultMore{
    width: 40px;
    height: 32px;
    font-size: 200%;
    color: #BBB;
    font-weight: bold;
    position: absolute;
    right: -40px;
    top: 7px;
    background-color: #DDD;
    border: 1px solid #BBB;
    overflow: hidden;
    cursor: pointer;
}
.help_timeTableResultMore{
    position: static;
    display: inline-block;
}
@media screen and (min-width: 910px) {
    .timeTableTrainRouteBox .timeRouteDiv .more{
        display: none;
    }
}
.timeTableTrainRouteBox .timeRouteDiv.showAll .more{display: none;}

.timeTableTrainRouteBox .table .timeBox .value, .timeTableTrainRouteBox .table .stationBox .value{
    min-height: 20px;
    font-size: 120%;
}
.timeTableTrainRouteBox .table .timeBox .deep, .timeTableTrainRouteBox .table .stationBox .deep{
    text-align: center;
    min-height: 50px;
}
.timeTableTrainRouteBox .table .timeBox .deep .minute{
    line-height: 50px;
    color: #8E8E8E;
}
.timeTableTrainRouteBox .table .deep .line_color{
    border: 1px solid #000000;
    width: 5px;
    height: 48px;
    overflow: hidden;
}
.timeTableTrainRouteBox .table .deep .line_color .bd{
    height: 48px;
    border-left: 5px dashed #000000;
}
.timeTableTrainRouteBox .table .deep .line_color.trtc_2, .timeTableTrainRouteBox .table .deep .line_color.trtc_2 .bd{border-color: #cb2c30;}
.timeTableTrainRouteBox .table .deep .line_color.trtc_3, .timeTableTrainRouteBox .table .deep .line_color.trtc_3 .bd{border-color: #007749;}
.timeTableTrainRouteBox .table .deep .line_color.trtc_4, .timeTableTrainRouteBox .table .deep .line_color.trtc_4 .bd{border-color: #ffa300;}
.timeTableTrainRouteBox .table .deep .line_color.trtc_5, .timeTableTrainRouteBox .table .deep .line_color.trtc_5 .bd{border-color: #005eb8;}
.timeTableTrainRouteBox .table .deep .line_color.trtc_2 .bd,
.timeTableTrainRouteBox .table .deep .line_color.trtc_3 .bd,
.timeTableTrainRouteBox .table .deep .line_color.trtc_4 .bd,
.timeTableTrainRouteBox .table .deep .line_color.trtc_5 .bd{
    border-style: solid;
}
.timeTableTrainRouteBox .table td.transStation{
    color: #9D92AB;
    border-bottom: 1px solid #CCC;
}
.timeTableTrainRouteBox .table .trtcArriveTimeInfo{
    font-size: 80%;
    color: #AA2010;
}

.editTool .tag{
    display: block;
    width: 100%;
    height: 40px;
}
.editTool .tag .tagSelect{
    /*display: inline;*/
    float: left;
    margin: 0px 10px;
    padding: 5px;
    border: 2px solid #2C2E2F;
    background-color: #EEC;
    cursor: pointer;
}
.editTool .tag .tagSelect.selected{background-color: #DCE;}
.editTool .editor{
    width: 100%;
}
.editTool .editor textarea{
    width: 90%;
    height: 400px;
}
.editTool .editor .btnDiv{
    display: inline;
    margin: 0 10px 0 0;
}

.ckWeekLoaded{
    background-color: #FF0000;
    color: #FFF;
    display: inline;
    padding: 0 10px;
}

.defineFontStyle1{
    color: #302010;
    font-weight: 500;
    background-color: #D0C0F0;
}

.mask{
    display: none;
    position: fixed;
    width: 100%;
    height: 100%;
    top: 0px;
    left: 0px;
    background-color: rgba(210,210,210,0.6);
    text-align: center;
    z-index: 105;
    -webkit-align-items: center;
    align-items: center;
    -webkit-justify-content: center;
    justify-content: center;
}
.mask .text{
    position: relative;
    font-size: 24px;
    color: #EF7879;
}
.mask.show{
    display: -webkit-flex;
    display: flex;
}
.systemButton{
    cursor: pointer;
    border: 2px solid #999;
    background-color: #DDD;
    min-height: 30px;
    line-height: 26px;
    padding: 2px 12px;
    display: inline;
    margin: 0px 5px;
}

.msg.show{
    min-width: 100px;
    max-width: 50%;
    padding: 20px;
    background-color: #2080D0;
    color: #FFF;
    position: fixed;
    opacity: 1;
    transition: opacity 0.9s ease 0.1s;
    z-index: 151;
    text-align: center;
}
.msg.show.afterEffect{opacity: 0;}

.ttWindow{
    display: inline-block;
    padding: 20px;
    background-color: #3F9EED;
    border: 2px solid #948522;
    position: absolute;
    top: 0px;
    height: 0px;
}
.ttWindow .inner{
    background-color: #F2F2F2;
    min-width: 160px;
    min-height: 100px;
}
.ttWindow .ttWindowClose, .ttMapSelector .ttWindowClose{
    width: 16px;
    height: 16px;
    line-height: 16px;
    font-size: 16px;
    font-weight: bold;
    color: #4D5F5F;
    position: absolute;
    right: 0px;
    top: 2px;
    cursor: pointer;
}

.ttMapSelector{
    display: inline-block;
    background-color: #FFF;
    background-color: rgba(255,255,255,1);
    border: none;
    position: absolute;
    top: 0px;
    left: 0px;
    min-height: 500px;
    overflow: hidden;
}
.ttMapSelector .main{
    position: relative;
    left: 0px;
}
.ttMapSelector .header{
    position: relative;
    left: 0px;
    height: 30px;
    max-height: 30px;
    overflow: hidden;
}
.ttMapSelector .header .tabName{
    float: left;
    padding: 2px 5px;
    border: 2px solid #FC98DA;
    height: 20px;
    font-size: 16px;
    color: #3D6A7B;
    line-height: 20px;
    background-color: #FDB8EC;
    cursor: pointer;
}
.ttMapSelector .header .tabName.onUse{
    border: 2px solid #98FCDA;
    color: #6A3D7B;
    background-color: #B8FDEC;
    border-bottom-color: #FFF;
    border-top-color: #28AC3A;
}
.line_selector{
    position: relative;
}
.line_selector .allLine{
    color: #FFF;
    font-size: 110%;
    width: 300px;
    max-width: 300px;
    float: left;
    left: 20px;
    top: 10px;
    overflow: hidden;
    cursor: pointer;
}
.line_selector .allLine .lineName{
    height: 24px;
    line-height: 22px;
    border-top: 0px solid transparent;
    padding-left: 10px;
}
.line_selector .allLine .lineName.select{
    border-right: 0px solid transparent;
}
.line_selector .allStation{
    color: #FFF;
    font-size: 110%;
    width: 210px;
    text-align: center;
    max-width: 210px;
    float: left;
    left: 320px;
    top: 10px;
    overflow: hidden;
    cursor: pointer;
}
.line_selector .allStation .stationName{
    border-bottom: 1px solid #FFF;
    height: 24px;
    line-height: 22px;
    margin: 0px 30px;
}
.line_selector .allStation .stationName:hover{
    background-color: rgba(255,255,255,0.4);
}
@media (-webkit-min-device-pixel-ratio: 1.25), (min-resolution: 120dpi){ 
    .line_selector .allLine, .line_selector .allStation{
        font-size: 130%;
    }
    .line_selector .allStation .stationName, .line_selector .allLine .lineName{
        height: 40px;
        line-height: 38px;
    }
}
@media (-webkit-min-device-pixel-ratio: 1.5), (min-resolution: 144dpi){ 
    .line_selector .allLine, .line_selector .allStation{
        font-size: 160%;
    }
    .line_selector .allStation .stationName, .line_selector .allLine .lineName{
        height: 50px;
        line-height: 48px;
    }
}

.transStationWalkTimeWindow .contentBox{
    margin: 10px;
}
.transStationWalkTimeWindow .buttonBox{
    margin: 10px;
}
.transStationWalkTimeWindow .buttonBox button{
    margin-right: 10px;
}
.transStationWalkTimeWindow .stationName{
    color:#307F98;
    font-weight:bold;
}
.transStationWalkTimeWindow .minute{
    width: 40px;
    text-align: right;
    font-size: 120%;
}

/* All common CSS */
.tt_display_none{display: none;}
</style>
<!--<link rel="stylesheet" type="text/css" href="x.css" />-->

<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.9.0/jquery.min.js"></script>
<script type="text/javascript">
//進度: 完成 getTRA_timeRangeByFromTo，可尋找某一時段間往來兩站的班次
//      完成 getTRA_timeRangeByFromTo 資料加上 getFromToTime , 接下來製作 TRTC 兩站時間查詢
//      完成 getTRTC_allTimeByFromTo 查全部兩站時間, 接下來製作時間範圍內查證
//      完成 getTRTC_timeRangeByFromTo 查台北捷運兩站範圍內時間 , 接下來製作跨台鐵捷運查詢
//      完成 getRoute_needRouteByFromTo 查兩站間是否需路由 , 接下來製作路由查詢正反向回傳路由
//      完成 getRoute_allRouteByFromTo 查兩站間路由 , 接下來製作路由上所有時間查詢
//      完成 getCommon_timeRangeByFromTo 查兩站間的時間 , 接下來 getCommon_timeTakeByFromTo
//      完成 getCommon_timeTakeByFromTo 對接時間內的 next prev , 接下按照 flagAD 整理每一組的最佳選擇
//      完成 getCommon_timeRangeBestByFromTo 整理最佳選擇 , 接下來 UI 印出最佳時間列車
//      完成 findTrain 與選項 UI , 接下來 printTrain 印出所有路線
//      完成 getData2JSON 及 saveDataJSON2Data 可由工具編輯 TT.data 內的資料但不含時刻表檔案
//      完成 createTrainRouteSelectBox 可勾選隱藏不想要經過的路徑
//      完成 createWeekSelect 可以選擇使用星期幾去搜尋
//      完成 getTRTC_stationOnOutArea 可查詢 TRTC 站是否在非重疊區
//      完成 classMapSelector 路線挑選器基礎視窗
//      完成 timeTableTrainRouteBox 及路線挑選器簡易的 media query 適應小寬度平台
//      完成 resetCountOfTrainRouteBox 獨立於所有 checkbox 結束後才呼叫重算 NO. 並改以獨立 ID 命名 span 加快更新速度
//      完成 getRoute_mapSystemOfFromToLine 跨出地區從系統上尋找路由
//      新增 getRoute_filterSameRoute 過濾不必要的路由 giveRoute_transStationOtherData
var TT = (function(){

    var TT = {//name space TT for TimeTable
        data: {},
        os: {}
    }
    
    TT.os = (function(){
        var ua = navigator.userAgent;
        var rt = {
            isAndroidBrowser: false
        }
        if(ua.indexOf('AppleWebKit/') != -1 && ua.indexOf('Mobile Safari/')!=-1) rt.isAndroidBrowser = true;
        return rt;
    })();
    
    TT.defined = {
        canUseLocalStorage: (function(){return (window.localStorage) ? true : false;})(),
        debugMode: false,
        defaultCrossDayTime: '04:00:00',
        defaultTRAWeekday: '2',
        defaultMaskText: 'Loading...',
        railBgcolor: 'define_rail_bgcolor_',
        stringOfCompany: {
            "tra": '台灣鐵路局',
            "trtc": '台北捷運'
        },
        stringSimpleOfCompany: {
            "tra": '台鐵',
            "trtc": '北捷'
        },
        timeHour: ['00','01','02','03','04','05','06','07','08','09','10','11','12','13','14','15','16','17','18','19','20','21','22','23'],
        timeMinSec: ['00','01','02','03','04','05','06','07','08','09','10','11','12','13','14','15','16','17','18','19','20','21','22','23','24','25','26','27','28','29',
                    '30','31','32','33','34','35','36','37','38','39','40','41','42','43','44','45','46','47','48','49','50','51','52','53','54','55','56','57','58','59'],
        weekStringAry: ['星期日','星期一','星期二','星期三','星期四','星期五','星期六'],
        programAbout: {
            "程式名稱": "接軌時刻",
            "作者": "Melix Yen (melixyen@gmail.com)",//修改後請將自己的名稱以 , 分隔加在前人後面，可帶括號標誌匿名或電子郵件等其他資訊，例如 test (test@abc.com)
            '發行單位': '<span style="background-color: #BBB;"><span style="color:blue;">極</span><span style="color:#FEFE11;">光</span><span style="color:#005530;">駭</span><span style="color:red;">客</span></span>',
            "版本": "Beta 0.4.8",
            "產生日期": "2017/01/15"
        },
        programUpdateInfo: [
                    'Beta 0.4.8: 台鐵時刻表改讀公開資訊 JSON 格式檔加速時候表載入。',
                    'Beta 0.4.7: 新增沙崙線。',
                    'Beta 0.4.6: 新增西部幹線嘉義至高雄。',
                    'Beta 0.4.5: 新增西部幹線彰化至嘉義。',
                    'Beta 0.4.4: 新增山線。',
                    'Beta 0.4.3: 過濾部分迂迴的路徑。',
                    'Beta 0.4.2: 隱藏無班車的路由，新增輸入站名搜尋功能。',
                    'Beta 0.4.1: 更新 canvas map 及新增松山站轉乘教學。',
                    'Beta 0.4: 新增台東線。',
                    'Beta 0.3.9: 調整 canvas map，增加截圖功能。',
                    'Beta 0.3.8: 新增內灣線，修正東線可直達六家線。',
                    'Beta 0.3.7: 新增新竹地區至竹南以及六家線。',
                    'Beta 0.3.6: 修正東部幹線轉捷運互相查詢後路由會失效的錯誤。',
                    'Beta 0.3.5: 修正西部大站與東部小站間使用轉乘系統。',
                    'Beta 0.3.4: 新增北迴線的轉乘查詢。',
                    'Beta 0.3.3: 更新松山站提供轉乘教學影片。',
                    'Beta 0.3.2: 新增平溪線及宜蘭線的轉乘查詢。',
                    'Beta 0.3.1: 更新南港站提供轉乘教學影片。',
                    'Beta 0.3: 新增路網圖選擇器提供北台灣軌道運輸路網站點選擇。'
        ],
        displayPri: {
                "tra": ['tra_shan','tra_liujia','tra_pingxi','tra_shalun','tra_beihui','tra_yilan','tra_xibu','tra_zhjy','tra_jygx'],
                "trtc": ['trtc_5','trtc_2','trtc_3','trtc_4','trtc_1']
        },
        GetP: (function(){
            var s = location.search, aryParam, tmpParam, rt;
            if(s.indexOf('?')!=-1){
                rt = {};
                aryParam = s.split('?')[1].split('&');
                aryParam.map(function(tmpA){
                    tmpParam = tmpA.split('=');
                    rt[tmpParam[0]] = tmpParam[1];
                });
            }
            return rt;
        })(),
        zxcv: 1
    }
    
    TT.data = {
        tra: {
        	defined: {
        		"CarClass": [
        			{"id": "1100", "name": "自強", "ename": "Tze-Chiang Limited Express", "color": "#fd7a10"},
        			{"id": "1101", "name": "自強", "ename": "Tze-Chiang Limited Express", "color": "#fd7a10"},
        			{"id": "1102", "name": "太魯閣號", "ename": "Tze-Chiang Limited Express(Tarko)", "color": "#FD8A10"},
        			{"id": "1107", "name": "普悠瑪號", "ename": "Tze-Chiang Limited Express(Puyuma)", "color": "#ff0030"},
        			{"id": "1108", "name": "自強", "ename": "Tze-Chiang Limited Express", "color": "#fd7a10"},
        			{"id": "1110", "name": "莒光", "ename": "Chu-Kuang Express", "color": "#ff1070"},
        			{"id": "1120", "name": "復興", "ename": "Fu-Hsing Semi Express", "color": "#32CFBC"},
        			{"id": "1130", "name": "電車", "ename": "Electric Multiple Unit"},
        			{"id": "1131", "name": "區間車", "ename": "Local Train"},
        			{"id": "1132", "name": "區間快", "ename": "Fast Local Train", "color": "#32CFBC"},
        			{"id": "1140", "name": "普快車", "ename": "Ordinary train"},
        			{"id": "1141", "name": "柴快車", "ename": "Disel Rail Car"},
        			{"id": "1150", "name": "柴油車", "ename": "na"}
        		]
        	},
        	sect_ary: ['pingdong','kaohsiung','tainan','chiayi','yunlin','changhua','taichung','miaoli','hsinchu','taoyuan','taipei','keelung',
                    'northeast','yilan','beihui','hualian','taidong'
            ],
            station_ary: [//big: e for big station of east(dongbu), w for big station of west(xibu), s for south link(nanhuei)
                {id:"tra_1001", name: "基隆", estring: "keelung", sect: "keelung"},
                {id:"tra_1029", name: "三坑", estring: "sankeng", sect: "keelung"},
                {id:"tra_1002", name: "八堵", estring: "badu", sect: "keelung", big: 'e'},
                {id:"tra_1003", name: "七堵", estring: "qidu", sect: "keelung", big: 'ew'},
                {id:"tra_1030", name: "百福", estring: "baifu", sect: "keelung"},
                {id:"tra_1004", name: "五堵", estring: "wudu", sect: "taipei"},
                {id:"tra_1005", name: "汐止", estring: "xizhisijhih", sect: "taipei"},
                {id:"tra_1031", name: "汐科", estring: "xikesike", sect: "taipei"},
                {id:"tra_1006", name: "南港", estring: "nangang", sect: "taipei"},
                {id:"tra_1007", name: "松山", estring: "songshan", sect: "taipei", big: 'ew', bigMaster: true},
                {id:"tra_1008", name: "台北", estring: "taipeitaibei", sect: "taipei", big: 'ew', bigMaster: true},
                {id:"tra_1009", name: "萬華", estring: "wanhua", sect: "taipei"},
                {id:"tra_1011", name: "板橋", estring: "banqiao", sect: "taipei", big: 'ew', bigMaster: true},
                {id:"tra_1032", name: "浮洲", estring: "fuzhou", sect: "taipei"},
                {id:"tra_1012", name: "樹林", estring: "shulin", sect: "taipei", big: 'e'},
                {id:"tra_1013", name: "山佳", estring: "shanjia", sect: "taipei"},
                {id:"tra_1014", name: "鶯歌", estring: "yingge", sect: "taipei"},
                {id:"tra_1015", name: "桃園", estring: "taoyuan", sect: "taoyuan", big: 'w'},
                {id:"tra_1016", name: "內壢", estring: "neili", sect: "taoyuan"},
                {id:"tra_1017", name: "中壢", estring: "zhongli", sect: "taoyuan", big: 'w'},
                {id:"tra_1018", name: "埔心", estring: "puxin", sect: "taoyuan"},
                {id:"tra_1019", name: "楊梅", estring: "yangmei", sect: "taoyuan"},
                {id:"tra_1020", name: "富岡", estring: "fugan", sect: "taoyuan"},
                {id:"tra_1033", name: "北湖", estring: "beihu", sect: "hsinchu"},
                {id:"tra_1021", name: "湖口", estring: "hukou", sect: "hsinchu"},
                {id:"tra_1022", name: "新豐", estring: "xinfeng", sect: "hsinchu"},
                {id:"tra_1023", name: "竹北", estring: "zhubei", sect: "hsinchu"},
                {id:"tra_1024", name: "北新竹", estring: "northhsinchubeixinzhu", sect: "hsinchu"},
                {id:"tra_1025", name: "新竹", estring: "hsinchuxinzhu", sect: "hsinchu", big: 'w'},
                {id:"tra_1026", name: "香山", estring: "xiangshan", sect: "hsinchu"},
                {id:"tra_1027", name: "崎頂", estring: "jidingciding", sect: "hsinchu"},
                {id:"tra_1028", name: "竹南", estring: "zhunan", sect: "hsinchu", big: 'w'},
                {id:"tra_1302", name: "造橋", estring: "zaoqiao", sect: "miaoli"},
                {id:"tra_1304", name: "豐富", estring: "fengfu", sect: "miaoli"},
                {id:"tra_1305", name: "苗栗", estring: "miaoli", sect: "miaoli", big: 'w'},
                {id:"tra_1307", name: "南勢", estring: "nanshi", sect: "miaoli"},
                {id:"tra_1308", name: "銅鑼", estring: "tongluo", sect: "miaoli"},
                {id:"tra_1310", name: "三義", estring: "sanyi", sect: "miaoli"},
                {id:"tra_1314", name: "泰安", estring: "taian", sect: "miaoli"},
                {id:"tra_1315", name: "后里", estring: "houli", sect: "taichung"},
                {id:"tra_1317", name: "豐原", estring: "fengyuan", sect: "taichung", big: 'w'},
                {id:"tra_1318", name: "潭子", estring: "tanzi", sect: "taichung"},
                {id:"tra_1323", name: "太原", estring: "taiyuan", sect: "taichung"},
                {id:"tra_1319", name: "台中", estring: "taizhongtaichung", sect: "taichung", big: 'w'},
                {id:"tra_1322", name: "大慶", estring: "daqing", sect: "taichung"},
                {id:"tra_1320", name: "烏日", estring: "wuri", sect: "taichung"},
                {id:"tra_1324", name: "新烏日", estring: "xinwuri", sect: "taichung"},
                {id:"tra_1321", name: "成功", estring: "chenggong", sect: "taichung"},
                {id:"tra_1120", name: "彰化", estring: "zhanghuachanghua", sect: "changhua", big: 'w'},
                {id:"tra_1202", name: "花壇", estring: "huatan", sect: "changhua"},
                {id:"tra_1240", name: "大村", estring: "dacundatsun", sect: "changhua"},
                {id:"tra_1203", name: "員林", estring: "yuanlin", sect: "changhua", big: 'w'},
                {id:"tra_1204", name: "永靖", estring: "yongjing", sect: "changhua"},
                {id:"tra_1205", name: "社頭", estring: "shetou", sect: "changhua"},
                {id:"tra_1206", name: "田中", estring: "tianzhong", sect: "changhua"},
                {id:"tra_1207", name: "二水", estring: "ershuei", sect: "changhua"},
                {id:"tra_1208", name: "林內", estring: "linnei", sect: "yunlin"},
                {id:"tra_1209", name: "石榴", estring: "shilioushihliou", sect: "yunlin"},
                {id:"tra_1210", name: "斗六", estring: "douliou", sect: "yunlin", big: 'w'},
                {id:"tra_1211", name: "斗南", estring: "dounan", sect: "yunlin"},
                {id:"tra_1212", name: "石龜", estring: "shigueishihguei", sect: "yunlin"},
                {id:"tra_1213", name: "大林", estring: "dalin", sect: "yunlin"},
                {id:"tra_1214", name: "民雄", estring: "minxiong", sect: "chiayi"},
                {id:"tra_1241", name: "嘉北", estring: "jiabei", sect: "chiayi"},
                {id:"tra_1215", name: "嘉義", estring: "jiayichiayi", sect: "chiayi", big: 'w'},
                {id:"tra_1217", name: "水上", estring: "shueishang", sect: "chiayi"},
                {id:"tra_1218", name: "南靖", estring: "nanjing", sect: "chiayi"},
                {id:"tra_1219", name: "後壁", estring: "houbi", sect: "tainan"},
                {id:"tra_1220", name: "新營", estring: "xinyingsinying", sect: "tainan", big: 'w'},
                {id:"tra_1221", name: "柳營", estring: "liouying", sect: "tainan"},
                {id:"tra_1222", name: "林鳳營", estring: "linfengyinglinfongying", sect: "tainan"},
                {id:"tra_1223", name: "隆田", estring: "longtian", sect: "tainan"},
                {id:"tra_1224", name: "拔林", estring: "balin", sect: "tainan"},
                {id:"tra_1225", name: "善化", estring: "shanghua", sect: "tainan"},
                {id:"tra_1244", name: "南科", estring: "nanke", sect: "tainan"},
                {id:"tra_1226", name: "新市", estring: "xinshisinshih", sect: "tainan"},
                {id:"tra_1227", name: "永康", estring: "yungkangyongkang", sect: "tainan"},
                {id:"tra_1239", name: "大橋", estring: "daqiaodaciao", sect: "tainan"},
                {id:"tra_1228", name: "台南", estring: "tainan", sect: "tainan", big: 'w'},
                {id:"tra_1229", name: "保安", estring: "baoan", sect: "tainan"},
                {id:"tra_1243", name: "仁德", estring: "rende", sect: "tainan"},
                {id:"tra_1230", name: "中州", estring: "zhongzhoujhongjhou", sect: "tainan"},
                {id:"tra_1231", name: "大湖", estring: "dahu", sect: "kaohsiung"},
                {id:"tra_1232", name: "路竹", estring: "luzhulujhu", sect: "kaohsiung"},
                {id:"tra_1233", name: "岡山", estring: "ganshan", sect: "kaohsiung", big: 'w'},
                {id:"tra_1234", name: "橋頭", estring: "qiaotou", sect: "kaohsiung"},
                {id:"tra_1235", name: "楠梓", estring: "nanzi", sect: "kaohsiung"},
                {id:"tra_1242", name: "新左營", estring: "xingzouying", sect: "kaohsiung", big: 's'},
                {id:"tra_1236", name: "左營", estring: "zouying", sect: "kaohsiung"},
                {id:"tra_1238", name: "高雄", estring: "kaohsiunggaoxung", sect: "kaohsiung", big: 'ws'},
                {id:"tra_1406", name: "屏東", estring: "pingtungpingdong", sect: "pingdong", big: 'ws', noShow: true},
                {id:"tra_1411", name: "潮州", estring: "chaozhouchaojhou", sect: "pingdong", big: 'ws', noShow: true},
                {id:"tra_1802", name: "暖暖", estring: "nuannuan", sect: "northeast"},
                {id:"tra_1803", name: "四腳亭", estring: "sijiaoting", sect: "northeast"},
                {id:"tra_1804", name: "瑞芳", estring: "ruifang", sect: "northeast", big: 'e'},
                {id:"tra_1805", name: "猴硐", estring: "houdong", sect: "northeast"},
                {id:"tra_1806", name: "三貂嶺", estring: "sandiaoling", sect: "northeast"},
                {id:"tra_1807", name: "牡丹", estring: "mudan", sect: "northeast"},
                {id:"tra_1808", name: "雙溪", estring: "shuangxi", sect: "northeast"},
                {id:"tra_1809", name: "貢寮", estring: "gongliao", sect: "northeast"},
                {id:"tra_1810", name: "福隆", estring: "fulong", sect: "northeast"},
                {id:"tra_1811", name: "石城", estring: "shicheng", sect: "yilan"},
                {id:"tra_1812", name: "大里", estring: "dali", sect: "yilan"},
                {id:"tra_1813", name: "大溪", estring: "daxidasi", sect: "yilan"},
                {id:"tra_1814", name: "龜山", estring: "gueishan", sect: "yilan"},
                {id:"tra_1815", name: "外澳", estring: "waiao", sect: "yilan"},
                {id:"tra_1816", name: "頭城", estring: "toucheng", sect: "yilan", big: 'e'},
                {id:"tra_1817", name: "頂埔", estring: "dingpu", sect: "yilan"},
                {id:"tra_1818", name: "礁溪", estring: "jiaoxijiaohsi", sect: "yilan"},
                {id:"tra_1819", name: "四城", estring: "sicheng", sect: "yilan"},
                {id:"tra_1820", name: "宜蘭", estring: "yilan", sect: "yilan", big: 'e'},
                {id:"tra_1821", name: "二結", estring: "erjie", sect: "yilan"},
                {id:"tra_1822", name: "中里", estring: "zhongli", sect: "yilan"},
                {id:"tra_1823", name: "羅東", estring: "luodong", sect: "yilan", big: 'e'},
                {id:"tra_1824", name: "冬山", estring: "dongshan", sect: "yilan"},
                {id:"tra_1825", name: "新馬", estring: "xinmasinma", sect: "yilan"},
                {id:"tra_1826", name: "蘇澳新", estring: "suaoxinsuaosin", sect: "yilan", big: 'e'},
                {id:"tra_1827", name: "蘇澳", estring: "suao", sect: "yilan"},
                {id:"tra_1703", name: "永樂", estring: "yongle", sect: "beihui"},
                {id:"tra_1704", name: "東澳", estring: "dongao", sect: "beihui"},
                {id:"tra_1705", name: "南澳", estring: "nanao", sect: "beihui", big: 'e'},
                {id:"tra_1706", name: "武塔", estring: "wuta", sect: "beihui"},
                {id:"tra_1708", name: "漢本", estring: "hanben", sect: "beihui"},
                {id:"tra_1709", name: "和平", estring: "heping", sect: "beihui"},
                {id:"tra_1710", name: "和仁", estring: "heren", sect: "beihui"},
                {id:"tra_1711", name: "崇德", estring: "chongde", sect: "hualian"},
                {id:"tra_1712", name: "新城", estring: "xinchengsincheng", sect: "hualian"},
                {id:"tra_1713", name: "景美", estring: "jingmei", sect: "hualian"},
                {id:"tra_1714", name: "北埔", estring: "beipu", sect: "hualian"},
                {id:"tra_1715", name: "花蓮", estring: "hualienhualian", sect: "hualian", big: 'e'},//sect:hualian
                {id:"tra_1602", name: "吉安", estring: "jian", sect: "hualian"},
                {id:"tra_1604", name: "志學", estring: "zhixue", sect: "hualian"},
                {id:"tra_1605", name: "平和", estring: "pinghe", sect: "hualian"},
                {id:"tra_1606", name: "壽豐", estring: "shoufeng", sect: "hualian"},
                {id:"tra_1607", name: "豐田", estring: "fengtian", sect: "hualian"},
                {id:"tra_1609", name: "南平", estring: "nanping", sect: "hualian"},
                {id:"tra_1610", name: "鳳林", estring: "fenglinfonglin", sect: "hualian"},
                {id:"tra_1611", name: "萬榮", estring: "wanrong", sect: "hualian"},
                {id:"tra_1612", name: "光復", estring: "guangfu", sect: "hualian"},
                {id:"tra_1613", name: "大富", estring: "dafu", sect: "hualian"},
                {id:"tra_1614", name: "富源", estring: "fuyuan", sect: "hualian"},
                {id:"tra_1616", name: "瑞穗", estring: "ruisui", sect: "hualian"},
                {id:"tra_1617", name: "三民", estring: "sanmin", sect: "hualian"},
                {id:"tra_1619", name: "玉里", estring: "yuli", sect: "hualian", big: 'e'},
                {id:"tra_1621", name: "東里", estring: "dongli", sect: "hualian"},
                {id:"tra_1622", name: "東竹", estring: "dongzhu", sect: "hualian"},
                {id:"tra_1623", name: "富里", estring: "fuli", sect: "hualian"},
                {id:"tra_1624", name: "池上", estring: "chishang", sect: "taidong"},
                {id:"tra_1625", name: "海端", estring: "haiduan", sect: "taidong"},
                {id:"tra_1626", name: "關山", estring: "guanshan", sect: "taidong"},
                {id:"tra_1628", name: "瑞和", estring: "ruihe", sect: "taidong"},
                {id:"tra_1629", name: "瑞源", estring: "ruiyuan", sect: "taidong"},
                {id:"tra_1630", name: "鹿野", estring: "luye", sect: "taidong"},
                {id:"tra_1631", name: "山里", estring: "shanli", sect: "taidong"},
                {id:"tra_1632", name: "台東", estring: "taitungtaidong", sect: "taidong", big: 'es'},
                {id:"tra_6103", name:"海科館", estring:"haikeguan", sect:"northeast"},
                {id:"tra_1903", name:"大華", estring:"dahua", sect:"northeast"},
                {id:"tra_1904", name:"十分", estring:"shifenshihfen", sect:"northeast"},
                {id:"tra_1905", name:"望古", estring:"wanggu", sect:"northeast"},
                {id:"tra_1906", name:"嶺腳", estring:"lingjiao", sect:"northeast"},
                {id:"tra_1907", name:"平溪", estring:"pingxipingsi", sect:"northeast"},
                {id:"tra_1908", name:"菁桐", estring:"jingtong", sect:"northeast"},
                {id:"tra_2212", name:"千甲", estring:"qianjia", sect:"hsinchu"},
                {id:"tra_2213", name:"新莊", estring:"xinzhuang", sect:"hsinchu"},
                {id:"tra_2203", name:"竹中", estring:"zhuzhong", sect:"hsinchu"},
                {id:"tra_2214", name:"六家", estring:"liujia", sect:"hsinchu"},
                {id:"tra_2204", name:"上員", estring:"shangyuan", sect:"hsinchu"},
                {id:"tra_2211", name:"榮華", estring:"ronghua", sect:"hsinchu"},
                {id:"tra_2205", name:"竹東", estring:"zhudong", sect:"hsinchu"},
                {id:"tra_2206", name:"橫山", estring:"zhuzhong", sect:"hsinchu"},
                {id:"tra_2207", name:"九讚頭", estring:"jiouzantou", sect:"hsinchu"},
                {id:"tra_2208", name:"合興", estring:"hexinghesing", sect:"hsinchu"},
                {id:"tra_2209", name:"富貴", estring:"fuguei", sect:"hsinchu"},
                {id:"tra_2210", name:"內灣", estring:"neiwan", sect:"hsinchu"},
                {id:"tra_5101", name:"長榮大學", estring:"changrongdaxuechangjungchristianuniversity", sect:"tainan"},
                {id:"tra_5102", name:"沙崙", estring:"shalun", sect:"tainan"}
            ],
            line: [
            	{
            		id: "tra_xibu",
                    name: "西部幹線(基隆-竹南)",
                    trainSect: ["keelung", "taipei", "taoyuan", "hsinchu"],
                    color: "#000050",
            		dir: "1",
                    area: 'w',
                    link: {
                        "tra_yilan": {station: "tra_1002", dir: "0"},
                        "tra_shan": {station: "tra_1028", dir: "1"},
                        "tra_liujia": {station: "tra_1025", dir: "0"}
                    },
            		station: ["tra_1001","tra_1029","tra_1002","tra_1003","tra_1030","tra_1004","tra_1005","tra_1031","tra_1006","tra_1007","tra_1008","tra_1009","tra_1011","tra_1032","tra_1012","tra_1013","tra_1014",//taipei
                        "tra_1015","tra_1016","tra_1017","tra_1018","tra_1019","tra_1020","tra_1033","tra_1021","tra_1022","tra_1023","tra_1024","tra_1025","tra_1026","tra_1027","tra_1028"]
            	}, {
            		id: "tra_shan",
                    name: "山線(竹南-彰化)",
                    trainSect: ["hsinchu", "miaoli", "taichung", "changhua"],
                    color: "#104020",
            		dir: "1",
                    area: 'w',
                    link: {
                        "tra_xibu": {station: "tra_1028", dir: "0"},
                        "tra_zhjy": {station: "tra_1120", dir: "1"}
                    },
            		station: ["tra_1028","tra_1302","tra_1304","tra_1305","tra_1307","tra_1308","tra_1310","tra_1314","tra_1315","tra_1317",
                        "tra_1318","tra_1323","tra_1319","tra_1322","tra_1320","tra_1324","tra_1321","tra_1120"]
            	}, {
            		id: "tra_zhjy",
                    name: "西部幹線(彰化-嘉義)",
                    trainSect: ["changhua", "yunlin", "chiayi"],
                    color: "#707010",
            		dir: "1",
                    area: 'w',
                    link: {
                        "tra_shan": {station: "tra_1120", dir: "0"},
                        "tra_jygx": {station: "tra_1215", dir: "1"}
                    },
            		station: ["tra_1120","tra_1202","tra_1240","tra_1203","tra_1204","tra_1205","tra_1206","tra_1207","tra_1208","tra_1209","tra_1210","tra_1211","tra_1212","tra_1213","tra_1214","tra_1241","tra_1215"]
            	}, {
            		id: "tra_jygx",
                    name: "西部幹線(嘉義-高雄)",
                    trainSect: ["chiayi", "tainan", "kaohsiung"],
                    color: "#302040",
            		dir: "1",
                    area: 'w',
                    link: {
                        "tra_zhjy": {station: "tra_1215", dir: "0"},
                        "tra_shalun": {station: "tra_1230", dir: "1"}
                    },
            		station: ["tra_1215","tra_1217","tra_1218","tra_1219","tra_1220","tra_1221","tra_1222","tra_1223","tra_1224","tra_1225","tra_1244","tra_1226","tra_1227","tra_1239","tra_1228",
                        "tra_1229","tra_1243","tra_1230","tra_1231","tra_1232","tra_1233","tra_1234","tra_1235","tra_1242","tra_1236","tra_1238"]
            	}, {
            		id: "tra_yilan",
                    name: "宜蘭線",
                    trainSect: ["taipei", "keelung", "northeast", "yilan"],
                    color: "#500000",
            		dir: "0",
                    area: 'e',
                    link: {
                        "tra_xibu": {station: "tra_1002", dir: "1"},
                        "tra_beihui": {station: "tra_1826", dir: "0"},
                        "tra_pingxi": {station: "tra_1804", dir: "0"}
                    },
                    //commonCrossLineStation: ["tra_1012","tra_1032","tra_1011","tra_1009","tra_1008","tra_1007","tra_1006","tra_1031","tra_1005","tra_1004","tra_1030","tra_1003"],
            		station: ["tra_1002","tra_1802","tra_1803","tra_1804","tra_1805","tra_1806","tra_1807","tra_1808","tra_1809","tra_1810",//taipei
                        "tra_1811","tra_1812","tra_1813","tra_1814","tra_1815","tra_1816","tra_1817","tra_1818","tra_1819","tra_1820","tra_1821","tra_1822","tra_1823","tra_1824","tra_1825","tra_1826","tra_1827"]
                }, {
            		id: "tra_beihui",
                    name: "北迴線(蘇澳-花蓮)",
                    trainSect: ["taipei", "keelung", "northeast","yilan","beihui","hualian"],
                    color: "#004060",
            		dir: "0",
                    area: 'e',
                    link: {
                        "tra_yilan": {station: "tra_1826", dir: "1"},
                        "tra_huadong": {station: "tra_1715", dir: "0"}
                    },
            		station: ["tra_1826","tra_1703","tra_1704","tra_1705","tra_1706","tra_1708","tra_1709","tra_1710","tra_1711","tra_1712","tra_1713","tra_1714","tra_1715"]
                }, {
            		id: "tra_huadong",
                    name: "台東線",
                    trainSect: ["taipei", "keelung", "northeast","yilan","beihui","hualian","taidong"],
                    color: "#605040",
            		dir: "0",
                    area: 'e',
                    link: {
                        "tra_beihui": {station: "tra_1715", dir: "1"}
                    },
            		station: ["tra_1715","tra_1602","tra_1604","tra_1605","tra_1606","tra_1607","tra_1609","tra_1610","tra_1611","tra_1612","tra_1613","tra_1614","tra_1616","tra_1617","tra_1619",
                        "tra_1621","tra_1622","tra_1623","tra_1624","tra_1625","tra_1626","tra_1628","tra_1629","tra_1630","tra_1631","tra_1632"]
                }, {
            		id: "tra_pingxi",
                    name: "平溪線",
                    trainSect: ["northeast"],
                    color: "#003030",
            		dir: "0",
                    area: 'e',
                    protectStation: ["tra_1804"],
                    link: {
                        "tra_yilan": {station: "tra_1806", dir: "1"}
                    },
            		station: ["tra_6103","tra_1804","tra_1805","tra_1806","tra_1903","tra_1904","tra_1905","tra_1906","tra_1907","tra_1908"]
                }, {
            		id: "tra_liujia",
                    name: "內灣／六家線",
                    trainSect: ["hsinchu"],
                    color: "#403090",
            		dir: "0",
                    area: 'w',
                    protectStation: ["tra_1024","tra_1025"],
                    protectStationSect: {
                        "tra_1024": "taoyuan,hsinchu"
                    },
                    subWorkingArea: {
                    	transAt: "tra_2203",
                    	transStationID: "zhuzhongtra1",
                    	station: ["tra_2204","tra_2211","tra_2205","tra_2206","tra_2207","tra_2208","tra_2209","tra_2210"]
                    },
                    link: {
                        "tra_xibu": {station: "tra_1025", dir: "1"}
                    },
            		station: ["tra_1025","tra_1024","tra_2212","tra_2213","tra_2203","tra_2214","tra_2204","tra_2211","tra_2205","tra_2206","tra_2207","tra_2208","tra_2209","tra_2210"]
                }, {
            		id: "tra_shalun",
                    name: "沙崙線",
                    trainSect: ["tainan"],
                    color: "#124060",
            		dir: "1",
                    area: 'w',
                    protectStation: ["tra_1230"],
                    link: {
                        "tra_jygx": {station: "tra_1230", dir: "0"}
                    },
            		station: ["tra_1230","tra_5101","tra_5102"]
                }
            ]
        },
        trtc: {
            station_ary: [
                //Bannan Line
                {id:"trtc_031", name: "南港展覽館", estring: "nangangzhanlanguantaipeinangangexhibitioncenter"},
                {id:"trtc_097", name: "南港", estring: "nangang"},
                {id:"trtc_096", name: "昆陽", estring: "kunyang"},
                {id:"trtc_095", name: "後山埤", estring: "houshanpi"},
                {id:"trtc_094", name: "永春", estring: "yongchun"},
                {id:"trtc_093", name: "市政府", estring: "taipeicityhallshizhengfu"},
                {id:"trtc_092", name: "國父紀念館", estring: "sunyatsenmemorialhallguofujinianguan"},
                {id:"trtc_091", name: "忠孝敦化", estring: "zhongxiaodunhua"},
                {id:"trtc_010", name: "忠孝復興", estring: "zhongxiaofuxing"},
                {id:"trtc_089", name: "忠孝新生", estring: "zhongxiaoxinsheng"},
                {id:"trtc_088", name: "善導寺", estring: "shandaosishandaotemple"},
                {id:"trtc_086", name: "西門", estring: "ximen"},
                {id:"trtc_085", name: "龍山寺", estring: "longshansilongshantemple"},
                {id:"trtc_084", name: "江子翠", estring: "jiangzicui"},
                {id:"trtc_083", name: "新埔", estring: "xinpu"},
                {id:"trtc_082", name: "板橋", estring: "banqiao"},
                {id:"trtc_081", name: "府中", estring: "fuzhong"},
                {id:"trtc_080", name: "亞東醫院", estring: "yadongyiyuanfareasternhospital"},
                {id:"trtc_079", name: "海山", estring: "haishan"},
                {id:"trtc_078", name: "土城", estring: "tucheng"},
                {id:"trtc_077", name: "永寧", estring: "yongning"},
                {id:"trtc_076", name: "頂埔", estring: "dingpu"},
                //TamsuiXinyi Line
                {id:"trtc_071", name: "淡水", estring: "danshuitamsui"},
                {id:"trtc_070", name: "紅樹林", estring: "hongshulin"},
                {id:"trtc_069", name: "竹圍", estring: "zhuwei"},
                {id:"trtc_068", name: "關渡", estring: "guandu"},
                {id:"trtc_067", name: "忠義", estring: "zhongyi"},
                {id:"trtc_066", name: "復興崗", estring: "fuxinggang"},
                {id:"trtc_064", name: "北投", estring: "beitou"},
                {id:"trtc_063", name: "奇岩", estring: "qiyan"},
                {id:"trtc_062", name: "唭哩岸", estring: "qilian"},
                {id:"trtc_061", name: "石牌", estring: "shipai"},
                {id:"trtc_060", name: "明德", estring: "mingde"},
                {id:"trtc_059", name: "芝山", estring: "zhishan"},
                {id:"trtc_058", name: "士林", estring: "shilin"},
                {id:"trtc_057", name: "劍潭", estring: "jiantan"},
                {id:"trtc_056", name: "圓山", estring: "yuanshan"},
                {id:"trtc_055", name: "民權西路", estring: "mingquanwrdmingquanxilu"},
                {id:"trtc_054", name: "雙連", estring: "shuanglian"},
                {id:"trtc_053", name: "中山", estring: "zhongshan"},
                {id:"trtc_051", name: "台北車站", estring: "taipeichezhantaipeimainstation"},
                {id:"trtc_050", name: "台大醫院", estring: "taidayiyuanntuhospital"},
                {id:"trtc_134", name: "東門", estring: "dongmen"},
                {id:"trtc_103", name: "大安森林公園", estring: "daanparkdaansenlingongyuan"},
                {id:"trtc_011", name: "大安", estring: "daan"},
                {id:"trtc_101", name: "信義安和", estring: "xinyianhe"},
                {id:"trtc_100", name: "台北101/世貿", estring: "taipei101worldtradecentertaipei101shimao"},
                {id:"trtc_099", name: "象山", estring: "xiangshan"},
                //ZhongHeXinLu Line
                {id:"trtc_048", name: "南勢角", estring: "nanshijiao"},
                {id:"trtc_047", name: "景安", estring: "jingan"},
                {id:"trtc_046", name: "永安市場", estring: "yonganshichangyonganmarket"},
                {id:"trtc_045", name: "頂溪", estring: "dingxi"},
                {id:"trtc_131", name: "行天宮", estring: "xingtiantemplexingtiangong"},
                {id:"trtc_130", name: "中山國小", estring: "zhongshanguoxiaozhongshanelementaryschool"},
                {id:"trtc_128", name: "大橋頭", estring: "daqiaotou"},
                {id:"trtc_127", name: "台北橋", estring: "taibeiqiaotaipeibridge"},
                {id:"trtc_126", name: "菜寮", estring: "cailiao"},
                {id:"trtc_125", name: "三重", estring: "sanchong"},
                {id:"trtc_124", name: "先嗇宮", estring: "xiansetemplexiansegong"},
                {id:"trtc_123", name: "頭前庄", estring: "touqianzhuang"},
                {id:"trtc_122", name: "新莊", estring: "xinzhuang"},
                {id:"trtc_121", name: "輔大", estring: "fudafujenuniversity"},
                {id:"trtc_180", name: "丹鳳", estring: "danfeng"},
                {id:"trtc_179", name: "迴龍", estring: "huilong"},
                {id:"trtc_178", name: "三重國小", estring: "sanchongguoxiaosanchongelementaryschool"},
                {id:"trtc_177", name: "三和國中", estring: "sanheguozhongsanhejuniorhighschool"},
                {id:"trtc_176", name: "徐匯中學", estring: "xuhuizhongxuestignatiushighschool"},
                {id:"trtc_175", name: "三民高中", estring: "sanmingaozhongsanminseniorhighschool"},
                {id:"trtc_174", name: "蘆洲", estring: "luzhou"},
                //SongShanXinDian Line
                {id:"trtc_111", name: "松山", estring: "songshan"},
                {id:"trtc_110", name: "南京三民", estring: "nanjingsanmin"},
                {id:"trtc_109", name: "台北小巨蛋", estring: "taipeiarenataibeixiaojudan"},
                {id:"trtc_009", name: "南京復興", estring: "nanjingfuxing"},
                {id:"trtc_132", name: "松江南京", estring: "songjiangnanjing"},
                {id:"trtc_105", name: "北門", estring: "beimen"},
                {id:"trtc_043", name: "小南門", estring: "xiaonanmen"},
                {id:"trtc_042", name: "中正紀念堂", estring: "zhongzhengjiniantangchiangkaishekmemorialhall"},
                {id:"trtc_041", name: "古亭", estring: "guting"},
                {id:"trtc_040", name: "台電大樓", estring: "taidiandaloutaipowerbuilding"},
                {id:"trtc_039", name: "公館", estring: "gongguan"},
                {id:"trtc_038", name: "萬隆", estring: "wanlong"},
                {id:"trtc_037", name: "景美", estring: "jingmei"},
                {id:"trtc_036", name: "大坪林", estring: "dapinglin"},
                {id:"trtc_035", name: "七張", estring: "qizhang"},
                {id:"trtc_034", name: "新店區公所", estring: "xindiandistrictofficexindianqugongsuo"},
                {id:"trtc_033", name: "新店", estring: "jingmei"}
            ],
            line: [
                {
                    id: "trtc_5",
                    name: "板南線(5)",
                    color: "#005eb8",
                    dir: "1",
                    outArea: [{
                        dir: "1",
                        station: "trtc_079~trtc_076",
                        transAt: "trtc_080",
                        waitingNextMinute: 4
                    }],
                    station: ["trtc_031","trtc_097","trtc_096","trtc_095","trtc_094","trtc_093","trtc_092","trtc_091","trtc_010","trtc_089","trtc_088","trtc_051","trtc_086","trtc_085","trtc_084","trtc_083","trtc_082","trtc_081","trtc_080","trtc_079","trtc_078","trtc_077","trtc_076"]
                }, {
                    id: "trtc_2",
                    name: "淡水信義線(2)",
                    color: "#cb2c30",
                    dir: "1",
                    outArea: [{
                        dir: "1",
                        station: "trtc_071~trtc_066",
                        transAt: "trtc_064",
                        waitingNextMinute: 4
                    }, {
                        dir: "1",
                        station: "trtc_101~trtc_099",
                        transAt: "trtc_011",
                        waitingNextMinute: 4
                    }],
                    station: ["trtc_071","trtc_070","trtc_069","trtc_068","trtc_067","trtc_066","trtc_064","trtc_063","trtc_062","trtc_061","trtc_060","trtc_059","trtc_058","trtc_057","trtc_056","trtc_055","trtc_054","trtc_053","trtc_051","trtc_050","trtc_042","trtc_134","trtc_103","trtc_011","trtc_101","trtc_100","trtc_099"]
                }, {
                    id: "trtc_3",
                    name: "松山新店線(3)",
                    color: "#007749",
                    dir: "1",
                    outArea: [{
                        dir: "1",
                        station: "trtc_039~trtc_033",
                        transAt: "trtc_040",
                        waitingNextMinute: 4
                    }],
                    station: ["trtc_111","trtc_110","trtc_109","trtc_009","trtc_132","trtc_053","trtc_105","trtc_086","trtc_043","trtc_042","trtc_041","trtc_040","trtc_039","trtc_038","trtc_037","trtc_036","trtc_035","trtc_034","trtc_033"]
                }, {
                    id: "trtc_4",
                    name: "中和新蘆線(4)",
                    color: "#ffa300",
                    dir: "1",
                    splitStation: ['trtc_128'],
                    outArea: [{
                        dir: "1",
                        station: "trtc_127~trtc_179",
                        transAt: "trtc_128",
                        isSubLine: true,
                        waitingNextMinute: 4
                    }, {
                        dir: "1",
                        station: "trtc_178~trtc_174",
                        transAt: "trtc_128",
                        isSubLine: true,
                        waitingNextMinute: 4
                    }],
                    station: ["trtc_048","trtc_047","trtc_046","trtc_045","trtc_041","trtc_134","trtc_089","trtc_132","trtc_131","trtc_130","trtc_055","trtc_128","trtc_127","trtc_126","trtc_125","trtc_124","trtc_123","trtc_122","trtc_121","trtc_180","trtc_179",
                        "trtc_178", "trtc_177", "trtc_176", "trtc_175", "trtc_174"]
                }
            ],
            offset_time: {
                "trtc_5": {
                    "trtc_097": {
                        "LineDir": "1", "trtc_031":-2, "trtc_097":0, "trtc_096":2, "trtc_095":4, "trtc_094":6, "trtc_093":8, "trtc_092":9, "trtc_091":11, "trtc_010":12, "trtc_089":15, "trtc_088":16, "trtc_051":18, "trtc_086":21
                            , "trtc_085":23, "trtc_084":27, "trtc_083":28, "trtc_082":30, "trtc_081":32, "trtc_080":34, "trtc_079":37, "trtc_078":39, "trtc_077":41, "trtc_076":45
                    }
                },
                "trtc_2": {
                    "trtc_071": {
                        "LineDir": "1", "trtc_071":0, "trtc_070":3, "trtc_069":6, "trtc_068":9, "trtc_067":11, "trtc_066":13, "trtc_064":16, "trtc_063":18, "trtc_062":19, "trtc_061":21, "trtc_060":23, "trtc_059":24, "trtc_058":26, "trtc_057":28, "trtc_056":31, "trtc_055":33, "trtc_054":34, "trtc_053":35, "trtc_051":37
                            , "trtc_050":39, "trtc_042":41, "trtc_134":44, "trtc_103":46, "trtc_011":47, "trtc_101":49, "trtc_100":51, "trtc_099":53
                    }
                },
                "trtc_3": {
                    "trtc_111": {
                        "LineDir": "1", "trtc_111":0, "trtc_110":3, "trtc_109":5, "trtc_009":7, "trtc_132":9, "trtc_053":11, "trtc_105":14, "trtc_086":16
                            , "trtc_043":18, "trtc_042":19, "trtc_041":21, "trtc_040":23, "trtc_039":24, "trtc_038":27, "trtc_037":29, "trtc_036":31, "trtc_035":32, "trtc_034":34, "trtc_033":36
                    }
                },
                "trtc_4": {
                    "trtc_048": {
                        "LineDir": "1", "trtc_048":0, "trtc_047":2, "trtc_046":4, "trtc_045":6, "trtc_041":10, "trtc_134":14, "trtc_089":16, "trtc_132":19, "trtc_131":20, "trtc_130":24, "trtc_055":25, "trtc_128":26
                            , "trtc_127":29, "trtc_126":31, "trtc_125":33, "trtc_124":35, "trtc_123":38, "trtc_122":39, "trtc_121":42, "trtc_180":44, "trtc_179":47
                            , "trtc_178":29, "trtc_177":32, "trtc_176":33, "trtc_175":35, "trtc_174":38
                    }
                }
            },
            station_time: {
                "trtc_3": {
                    "trtc_111": {
                        weekday: [
                            [//Xindian to SongShan
                                [],[],[],[],[],[],
                                ["07","13","19","26","30","36","40","43","19","52","57"],
                                ["00","04","07","10","13","16","19","21","24","27","30","33","36","39","42","45","48","51","54","57"],
                                ["00","03","06","09","12","15","18","21","24","27","30","33","36","39","42","45","48","51","54","57"],
                                ["00","03","06","10","12","15","18","22","24","27","30","34","38","42","46","50","54","58"],
                                ["02","06","10","14","18","22","26","30","34","38","42","46","50","54","58"],
                                ["02","06","10","14","18","22","26","30","34","38","42","46","50","54","58"],
                                ["02","06","10","14","18","22","26","30","34","38","42","46","50","54","58"],
                                ["02","06","10","14","18","22","26","30","34","38","42","46","50","54","58"],
                                ["02","06","10","14","18","22","26","30","34","38","42","46","50","54","58"],
                                ["02","06","10","14","18","22","26","30","34","38","42","46","50","54","58"],
                                ["02","06","10","14","18","22","26","30","34","38","42","46","50","54","58"],
                                ["03","06","11","15","18","21","24","27","30","33","36","39","42","45","48","51","54","57"],
                                ["03","06","09","12","15","18","21","24","27","30","33","36","39","42","45","48","51","54","57"],
                                ["00","03","06","09","12","16","19","21","24","27","30","33","37","39","42","46","48","51","54","58"],
                                ["01","05","08","11","15","19","22","26","29","33","36","40","43","47","50","54","57"],
                                ["01","04","07","11","15","18","22","25","29","32","36","39","43","46","50","53","57"],
                                ["00","04","07","11","14","18","21","25","28","32","35","39","43","48","52","55"],
                                ["00","05","11","15","24","36","48"],
                                ["00","12","24","35","42","54"]
                            ], [//SongShan to Xindian
                                [],[],[],[],[],[],
                                ["00","04","14","21","27","32","36","40","43","45","49","52","54","57"],
                                ["00","04","07","10","13","16","18","21","24","27","30","33","36","39","42","45","48","51","54","57"],
                                ["00","03","06","09","12","15","18","21","24","27","30","33","36","39","42","45","48","51","54","57"],
                                ["00","03","07","12","15","19","24","27","31","35","39","43","47","51","55","59"],
                                ["03","07","11","15","19","23","27","31","35","39","43","47","51","55","59"],
                                ["03","07","11","15","19","23","27","31","35","39","43","47","51","55","59"],
                                ["03","07","11","15","19","23","27","31","35","39","43","47","51","55","59"],
                                ["03","07","11","15","19","23","27","31","35","39","43","47","51","55","59"],
                                ["03","07","11","15","19","23","27","31","35","39","43","47","51","55","59"],
                                ["03","07","11","15","19","23","27","31","35","39","43","47","51","55","59"],
                                ["03","07","11","15","19","23","27","31","35","39","43","47","51","54","57"],
                                ["00","03","06","08","12","15","18","21","24","27","30","33","36","39","42","45","48","51","54","57"],
                                ["00","03","06","09","12","15","18","21","24","27","30","33","36","39","42","45","48","51","54","57",],
                                ["00","03","06","09","13","16","20","23","27","30","34","36","40","44","48","51","55","58"],
                                ["02","05","09","12","16","19","23","26","30","33","37","40","44","47","51","54","58"],
                                ["01","05","08","12","15","19","22","26","29","33","36","40","43","47","50","54","57"],
                                ["01","04","08","11","15","18","22","25","28","32","36","39","44","49","52","55"],
                                ["00","06","12","18","24","36","48"],
                                ["00"]
                            ]
                        ]
                    }
                }
            }
        },
        transStation: [
                {
                    id: 'taidongtra1', name: "台東",
                    changeLine: ["tra_huadong", "tra_huadong"],
                    changeStation: ['tra_1632','tra_1632'],
                    walkMinute: 4
                }, {
                    id: 'yulitra1', name: "玉里",
                    changeLine: ["tra_huadong", "tra_huadong"],
                    changeStation: ['tra_1619','tra_1619'],
                    walkMinute: 4
                }, {
                    id: 'hualiantra1', name: "花蓮",
                    changeLine: ["tra_beihui", "tra_huadong"],
                    changeStation: ['tra_1715','tra_1715'],
                    walkMinute: 4
                }, {
                    id: 'nanaotra1', name: "南澳",
                    changeLine: ["tra_beihui", "tra_beihui"],
                    changeStation: ['tra_1705','tra_1705'],
                    walkMinute: 2
                }, {
                    id: 'suaoxintra1', name: "蘇澳新",
                    changeLine: ["tra_yilan", "tra_beihui"],
                    changeStation: ['tra_1826','tra_1826'],
                    walkMinute: 4
                }, {
                    id: 'luodongtra1', name: "羅東",
                    changeLine: ["tra_yilan", "tra_yilan"],
                    changeStation: ['tra_1823','tra_1823'],
                    walkMinute: 4
                }, {
                    id: 'yilantra1', name: "宜蘭",
                    changeLine: ["tra_yilan", "tra_yilan"],
                    changeStation: ['tra_1820','tra_1820'],
                    walkMinute: 4
                }, {
                    id: 'toucheng1', name: "頭城",
                    changeLine: ["tra_yilan", "tra_yilan"],
                    changeStation: ['tra_1816','tra_1816'],
                    walkMinute: 4
                }, {
                    id: 'ruifangtra1', name: "瑞芳",
                    changeLine: ["tra_yilan", "tra_pingxi"],
                    changeStation: ['tra_1804','tra_1804'],
                    walkMinute: 4
                }, {
                    id: 'badutra1', name: "八堵",
                    changeLine: ["tra_xibu", "tra_yilan"],
                    changeStation: ['tra_1002','tra_1002'],
                    walkMinute: 3
                }, {
                    id: 'qidutra1', name: "七堵",
                    changeLine: ["tra_xibu", "tra_xibu"],
                    changeStation: ['tra_1003','tra_1003'],
                    walkMinute: 3
                }, {
                    id: 'songshantra1', name: "松山",
                    changeLine: ["tra_xibu", "tra_xibu"],
                    changeStation: ['tra_1007','tra_1007'],
                    walkMinute: 3
                }, {
                    id: 'taipeitra1', name: "台北",
                    changeLine: ["tra_xibu", "tra_xibu"],
                    changeStation: ['tra_1008','tra_1008'],
                    walkMinute: 3
                }, {
                    id: 'banqiaotra1', name: "板橋",
                    changeLine: ["tra_xibu", "tra_xibu"],
                    changeStation: ['tra_1011','tra_1011'],
                    walkMinute: 3
                }, {
                    id: 'taoyuantra1', name: "桃園",
                    changeLine: ["tra_xibu", "tra_xibu"],
                    changeStation: ['tra_1015','tra_1015'],
                    walkMinute: 3
                }, {
                    id: 'zhonglitra1', name: "中壢",
                    changeLine: ["tra_xibu", "tra_xibu"],
                    changeStation: ['tra_1017','tra_1017'],
                    walkMinute: 3
                }, {
                    id: 'northhsinchutra1', name: "北新竹",
                    changeLine: ["tra_xibu", "tra_liujia"],
                    changeStation: ['tra_1024','tra_1024'],
                    walkMinute: 4
                }, {
                    id: 'hsinchutra1', name: "新竹",
                    changeLine: ["tra_xibu", "tra_liujia"],
                    changeStation: ['tra_1025','tra_1025'],
                    walkMinute: 4
                }, {
                    id: 'zhunantra1', name: "竹南",
                    changeLine: ["tra_xibu", "tra_shan"],
                    changeStation: ['tra_1028','tra_1028'],
                    walkMinute: 3
                }, {
                    id: 'miaolitra1', name: "苗栗",
                    changeLine: ["tra_shan", "tra_shan"],
                    changeStation: ['tra_1305','tra_1305'],
                    walkMinute: 4
                }, {
                    id: 'fengyuantra1', name: "豐原",
                    changeLine: ["tra_shan", "tra_shan"],
                    changeStation: ['tra_1317','tra_1317'],
                    walkMinute: 4
                }, {
                    id: 'taizhongtra1', name: "台中",
                    changeLine: ["tra_shan", "tra_shan"],
                    changeStation: ['tra_1319','tra_1319'],
                    walkMinute: 4
                }, {
                    id: 'zhanghuatra1', name: "彰化",
                    changeLine: ["tra_shan", "tra_zhjy"],
                    changeStation: ['tra_1120','tra_1120'],
                    walkMinute: 4
                }, {
                    id: 'yuanlintra1', name: "員林",
                    changeLine: ["tra_zhjy", "tra_zhjy"],
                    changeStation: ['tra_1203','tra_1203'],
                    walkMinute: 4
                }, {
                    id: 'douliutra1', name: "斗六",
                    changeLine: ["tra_zhjy", "tra_zhjy"],
                    changeStation: ['tra_1210','tra_1210'],
                    walkMinute: 4
                }, {
                    id: 'jiayitra1', name: "嘉義",
                    changeLine: ["tra_zhjy", "tra_jygx"],
                    changeStation: ['tra_1215','tra_1215'],
                    walkMinute: 4
                }, {
                    id: 'xinyingtra1', name: "新營",
                    changeLine: ["tra_jygx", "tra_jygx"],
                    changeStation: ['tra_1220','tra_1220'],
                    walkMinute: 4
                }, {
                    id: 'tainantra1', name: "台南",
                    changeLine: ["tra_jygx", "tra_shalun"],
                    changeStation: ['tra_1228','tra_1228'],
                    walkMinute: 4
                }, {
                    id: 'zhongzhoutra1', name: "中洲",
                    changeLine: ["tra_jygx", "tra_shalun"],
                    changeStation: ['tra_1230','tra_1230'],
                    walkMinute: 4
                }, {
                    id: 'gangshantra1', name: "岡山",
                    changeLine: ["tra_jygx", "tra_jygx"],
                    changeStation: ['tra_1233','tra_1233'],
                    walkMinute: 4
                }, {
                    id: 'gaoxungtra1', name: "高雄",
                    changeLine: ["tra_jygx", "tra_jygx"],
                    changeStation: ['tra_1238','tra_1238'],
                    walkMinute: 4
                }, {
                    id: 'zhuzhongtra1', name: "竹中",
                    changeLine: ["tra_liujia", "tra_liujia"],
                    changeStation: ['tra_2203','tra_2203'],
                    walkMinute: 3
                }, {
                    id: 'nangang1', name: "南港",
                    changeLine: ["tra_xibu", "trtc_5"],
                    changeStation: ['tra_1006','trtc_097'],
                    video: {
                        "tra_1006": {width:420, height:315, src:'https://www.youtube.com/embed/AIQETgZdBKM'},
                        "trtc_097": {width:420, height:315, src:'https://www.youtube.com/embed/HNBdfyBxMa8'}
                    },
                    walkMinute: 5
                }, {
                    id: 'songshan1', name: "松山",
                    changeLine: ["tra_xibu", "trtc_3"],
                    changeStation: ['tra_1007','trtc_111'],
                    video: {
                        "tra_1007": {width:420, height:315, src:'https://www.youtube.com/embed/CFX9EdLwT9A'},
                        "trtc_111": {width:420, height:315, src:'https://www.youtube.com/embed/64ADnwMTLyQ'}
                    },
                    walkMinute: 6
                }, {
                    id: 'ximen1', name: "西門",
                    changeLine: ["trtc_5", "trtc_3"],
                    changeStation: ['trtc_086','trtc_086'],
                    walkMinute: 1
                }, {
                    id: 'zhongshan1', name: "中山",
                    changeLine: ["trtc_3", "trtc_2"],
                    changeStation: ['trtc_053','trtc_053'],
                    walkMinute: 2
                }, {
                    id: 'taipei1', name: "台北",
                    changeLine: ["tra_xibu", "trtc_5"],
                    changeStation: ['tra_1008','trtc_051'],
                    walkMinute: 7
                }, {
                    id: 'taipei2', name: "台北",
                    changeLine: ["tra_xibu", "trtc_2"],
                    changeStation: ['tra_1008','trtc_051'],
                    walkMinute: 4
                }, {
                    id: 'taipei3', name: "台北",
                    changeLine: ["trtc_5", "trtc_2"],
                    changeStation: ['trtc_051','trtc_051'],
                    walkMinute: 3
                }, {
                    id: 'cksmh1', name: "中正紀念堂",
                    changeLine: ["trtc_3", "trtc_2"],
                    changeStation: ['trtc_042','trtc_042'],
                    walkMinute: 1
                }, {
                    id: 'banqiao1', name: "板橋",
                    changeLine: ["tra_xibu", "trtc_5"],
                    changeStation: ['tra_1011','trtc_082'],
                    walkMinute: 7
                }, {
                    id: 'mqxl1', name: "民權西路",
                    changeLine: ["trtc_2", "trtc_4"],
                    changeStation: ['trtc_055','trtc_055'],
                    walkMinute: 3
                }, {
                    id: 'dongmen1', name: "東門",
                    changeLine: ["trtc_2", "trtc_4"],
                    changeStation: ['trtc_134','trtc_134'],
                    walkMinute: 1
                }, {
                    id: 'guting1', name: "古亭",
                    changeLine: ["trtc_3", "trtc_4"],
                    changeStation: ['trtc_041','trtc_041'],
                    walkMinute: 1
                }, {
                    id: 'zhongxiaoxs1', name: "忠孝新生",
                    changeLine: ["trtc_5", "trtc_4"],
                    changeStation: ['trtc_089','trtc_089'],
                    walkMinute: 2
                }, {
                    id: 'sjnanjing1', name: "松江南京",
                    changeLine: ["trtc_3", "trtc_4"],
                    changeStation: ['trtc_132','trtc_132'],
                    walkMinute: 2
                }, {
                    id: 'daqiaotou1', name: "大橋頭",
                    changeLine: ["trtc_4", "trtc_4"],
                    changeStation: ['trtc_128','trtc_128'],
                    walkMinute: 1
                }
        ],
        routeMap: [
            {
                id: 'traInnerTrans_tra_xibu,tra_jygx',
                fromToLine: ["tra_xibu","tra_jygx"],
                sect: ['keelung','taipei','taoyuan','hsinchu','chiayi','tainan','kaohsiung'],
                route: [
                    {
                        line: ["tra_xibu", "tra_jygx"],
                        transStation: ["qidutra1"]
                    },
                    {
                        line: ["tra_xibu", "tra_jygx"],
                        transStation: ["songshantra1"]
                    },
                    {
                        line: ["tra_xibu", "tra_jygx"],
                        transStation: ["taipeitra1"]
                    },
                    {
                        line: ["tra_xibu", "tra_jygx"],
                        transStation: ["banqiaotra1"]
                    },
                    {
                        line: ["tra_xibu", "tra_jygx"],
                        transStation: ["taoyuantra1"]
                    },
                    {
                        line: ["tra_xibu", "tra_jygx"],
                        transStation: ["zhonglitra1"]
                    },
                    {
                        line: ["tra_xibu", "tra_jygx"],
                        transStation: ["hsinchutra1"]
                    },
                    {
                        line: ["tra_xibu", "tra_zhjy"],
                        transStation: ["jiayitra1"]
                    },
                    {
                        line: ["tra_xibu", "tra_zhjy"],
                        transStation: ["xinyingtra1"]
                    },
                    {
                        line: ["tra_xibu", "tra_zhjy"],
                        transStation: ["tainantra1"]
                    },
                    {
                        line: ["tra_xibu", "tra_zhjy"],
                        transStation: ["gangshantra1"]
                    },
                    {
                        line: ["tra_xibu", "tra_zhjy"],
                        transStation: ["gaoxungtra1"]
                    }
                ]
            }, {
                id: 'traInnerTrans_tra_xibu,tra_zhjy',
                fromToLine: ["tra_xibu","tra_zhjy"],
                sect: ['keelung','taipei','taoyuan','hsinchu','changhua','yunlin','chiayi'],
                route: [
                    {
                        line: ["tra_xibu", "tra_zhjy"],
                        transStation: ["qidutra1"]
                    },
                    {
                        line: ["tra_xibu", "tra_zhjy"],
                        transStation: ["songshantra1"]
                    },
                    {
                        line: ["tra_xibu", "tra_zhjy"],
                        transStation: ["taipeitra1"]
                    },
                    {
                        line: ["tra_xibu", "tra_zhjy"],
                        transStation: ["banqiaotra1"]
                    },
                    {
                        line: ["tra_xibu", "tra_zhjy"],
                        transStation: ["taoyuantra1"]
                    },
                    {
                        line: ["tra_xibu", "tra_zhjy"],
                        transStation: ["zhonglitra1"]
                    },
                    {
                        line: ["tra_xibu", "tra_zhjy"],
                        transStation: ["hsinchutra1"]
                    },
                    {
                        line: ["tra_xibu", "tra_zhjy"],
                        transStation: ["zhunantra1"]
                    },
                    {
                        line: ["tra_xibu", "tra_zhjy"],
                        transStation: ["zhanghuatra1"]
                    },
                    {
                        line: ["tra_xibu", "tra_zhjy"],
                        transStation: ["yuanlintra1"]
                    },
                    {
                        line: ["tra_xibu", "tra_zhjy"],
                        transStation: ["douliutra1"]
                    },
                    {
                        line: ["tra_xibu", "tra_zhjy"],
                        transStation: ["jiayitra1"]
                    }
                ]
            }, {
                id: 'traInnerTrans_tra_xibu,tra_shan',
                fromToLine: ["tra_xibu","tra_shan"],
                sect: ['keelung','taipei','taoyuan','hsinchu','miaoli','taichung','changhua'],
                route: [
                    {
                        line: ["tra_xibu", "tra_xibu"],
                        transStation: ["qidutra1"]
                    },
                    {
                        line: ["tra_xibu", "tra_xibu"],
                        transStation: ["songshantra1"]
                    },
                    {
                        line: ["tra_xibu", "tra_xibu"],
                        transStation: ["taipeitra1"]
                    },
                    {
                        line: ["tra_xibu", "tra_xibu"],
                        transStation: ["banqiaotra1"]
                    },
                    {
                        line: ["tra_xibu", "tra_xibu"],
                        transStation: ["taoyuantra1"]
                    },
                    {
                        line: ["tra_xibu", "tra_xibu"],
                        transStation: ["zhonglitra1"]
                    },
                    {
                        line: ["tra_xibu", "tra_xibu"],
                        transStation: ["hsinchutra1"]
                    },
                    {
                        line: ["tra_xibu", "tra_shan"],
                        transStation: ["zhunantra1"]
                    },
                    {
                        line: ["tra_xibu", "tra_shan"],
                        transStation: ["miaolitra1"]
                    },
                    {
                        line: ["tra_xibu", "tra_shan"],
                        transStation: ["fengyuantra1"]
                    },
                    {
                        line: ["tra_xibu", "tra_shan"],
                        transStation: ["taizhongtra1"]
                    },
                    {
                        line: ["tra_xibu", "tra_shan"],
                        transStation: ["zhanghuatra1"]
                    }
                ]
            }, {
                id: 'traInnerTrans_tra_shan,tra_zhjy',
                fromToLine: ["tra_shan","tra_zhjy"],
                sect: ['miaoli','taichung','changhua','yunlin','chiayi'],
                route: [
                    {
                        line: ["tra_shan", "tra_shan"],
                        transStation: ["miaolitra1"]
                    },
                    {
                        line: ["tra_shan", "tra_shan"],
                        transStation: ["fengyuantra1"]
                    },
                    {
                        line: ["tra_shan", "tra_shan"],
                        transStation: ["taizhongtra1"]
                    },
                    {
                        line: ["tra_shan", "tra_zhjy"],
                        transStation: ["zhanghuatra1"]
                    },
                    {
                        line: ["tra_shan", "tra_zhjy"],
                        transStation: ["yuanlintra1"]
                    },
                    {
                        line: ["tra_shan", "tra_zhjy"],
                        transStation: ["douliutra1"]
                    },
                    {
                        line: ["tra_shan", "tra_zhjy"],
                        transStation: ["jiayitra1"]
                    }
                ]
            }, {
                id: 'traInnerTrans_tra_shan,tra_jygx',
                fromToLine: ["tra_shan","tra_jygx"],
                sect: ['miaoli','taichung','changhua','chiayi','tainan','kaohsiung'],
                route: [
                    {
                        line: ["tra_shan", "tra_shan"],
                        transStation: ["miaolitra1"]
                    },
                    {
                        line: ["tra_shan", "tra_shan"],
                        transStation: ["fengyuantra1"]
                    },
                    {
                        line: ["tra_shan", "tra_shan"],
                        transStation: ["taizhongtra1"]
                    },
                    {
                        line: ["tra_shan", "tra_jygx"],
                        transStation: ["zhanghuatra1"]
                    },
                    {
                        line: ["tra_shan", "tra_jygx"],
                        transStation: ["jiayitra1"]
                    },
                    {
                        line: ["tra_shan", "tra_jygx"],
                        transStation: ["xinyingtra1"]
                    },
                    {
                        line: ["tra_shan", "tra_jygx"],
                        transStation: ["tainantra1"]
                    },
                    {
                        line: ["tra_shan", "tra_jygx"],
                        transStation: ["gangshantra1"]
                    },
                    {
                        line: ["tra_shan", "tra_jygx"],
                        transStation: ["gaoxungtra1"]
                    }
                ]
            }, {
                id: 'traInnerTrans_tra_zhjy,tra_jygx',
                fromToLine: ["tra_zhjy","tra_jygx"],
                sect: ['changhua','yunlin','chiayi','tainan','kaohsiung'],
                route: [
                    {
                        line: ["tra_zhjy", "tra_zhjy"],
                        transStation: ["zhanghuatra1"]
                    },
                    {
                        line: ["tra_zhjy", "tra_zhjy"],
                        transStation: ["yuanlintra1"]
                    },
                    {
                        line: ["tra_zhjy", "tra_zhjy"],
                        transStation: ["douliutra1"]
                    },
                    {
                        line: ["tra_zhjy", "tra_jygx"],
                        transStation: ["jiayitra1"]
                    },
                    {
                        line: ["tra_zhjy", "tra_jygx"],
                        transStation: ["xinyingtra1"]
                    },
                    {
                        line: ["tra_zhjy", "tra_jygx"],
                        transStation: ["tainantra1"]
                    },
                    {
                        line: ["tra_zhjy", "tra_jygx"],
                        transStation: ["gangshantra1"]
                    },
                    {
                        line: ["tra_zhjy", "tra_jygx"],
                        transStation: ["gaoxungtra1"]
                    }
                ]
            }, {
                id: 'traInnerTrans_tra_yilan,tra_beihui',
                fromToLine: ["tra_yilan","tra_beihui"],
                sect: ['northeast','yilan','beihui','hualian'],
                route: [
                    {
                        line: ["tra_beihui", "tra_beihui"],
                        transStation: ["hualiantra1"]
                    },
                    {
                        line: ["tra_yilan", "tra_beihui"],
                        transStation: ["suaoxintra1"]
                    },
                    {
                        line: ["tra_yilan", "tra_yilan"],
                        transStation: ["luodongtra1"]
                    },
                    {
                        line: ["tra_yilan", "tra_yilan"],
                        transStation: ["yilantra1"]
                    },
                    {
                        line: ["tra_yilan", "tra_yilan"],
                        transStation: ["ruifangtra1"]
                    }
                ]
            }, {
                id: 'traInnerTrans_tra_yilan,tra_huadong',
                fromToLine: ["tra_yilan","tra_huadong"],
                sect: ['northeast','yilan','beihui','hualian','taidong'],
                route: [
                    {
                        line: ["tra_huadong", "tra_huadong"],
                        transStation: ["taidongtra1"]
                    },
                    {
                        line: ["tra_huadong", "tra_huadong"],
                        transStation: ["yulitra1"]
                    },
                    {
                        line: ["tra_beihui", "tra_huadong"],
                        transStation: ["hualiantra1"]
                    },
                    {
                        line: ["tra_yilan", "tra_beihui"],
                        transStation: ["suaoxintra1"]
                    },
                    {
                        line: ["tra_yilan", "tra_yilan"],
                        transStation: ["luodongtra1"]
                    },
                    {
                        line: ["tra_yilan", "tra_yilan"],
                        transStation: ["yilantra1"]
                    },
                    {
                        line: ["tra_yilan", "tra_yilan"],
                        transStation: ["ruifangtra1"]
                    }
                ]
            }, {
                id: 'traInnerTrans_tra_beihui,tra_huadong',
                fromToLine: ["tra_beihui","tra_huadong"],
                sect: ['yilan','beihui','hualian','taidong'],
                route: [
                    {
                        line: ["tra_huadong", "tra_huadong"],
                        transStation: ["taidongtra1"]
                    },
                    {
                        line: ["tra_huadong", "tra_huadong"],
                        transStation: ["yulitra1"]
                    },
                    {
                        line: ["tra_beihui", "tra_huadong"],
                        transStation: ["hualiantra1"]
                    }
                ]
            }, {
                id: 'traInnerTrans_tra_yilan,tra_pingxi',
                fromToLine: ["tra_yilan","tra_pingxi"],
                fromToLineReg: [
                	"^tra_pingxi$",
                	"^tra_yilan$|^tra_beihui$|^tra_huadong$"
                ],
                sect: ['northeast','yilan','beihui','hualian','taidong'],
                route: [
                    {
                        line: ["tra_yilan", "tra_pingxi"],
                        transStation: ["ruifangtra1"]
                    }
                ]
            }, {
                id: 'traInnerTrans_tra_xibu,tra_yilan',
                fromToLine: ["tra_xibu","tra_yilan"],
                fromToLineReg: [
                	"^tra_xibu$|^tra_shan$|^tra_zhjy$|^tra_jygx$|^tra_shalun$",
                	"^tra_yilan$|^tra_beihui$|^tra_huadong$"
                ],
                sect: ['kaohsiung','tainan','chiayi','yunlin','changhua','taichung','miaoli','hsinchu','taoyuan','taipei','keelung','northeast','yilan','beihui','hualian','taidong'],
                route: [
                    {
                        line: ["tra_xibu", "tra_yilan"],
                        transStation: ["banqiaotra1"]
                    },
                    {
                        line: ["tra_xibu", "tra_yilan"],
                        transStation: ["taipeitra1"]
                    },
                    {
                        line: ["tra_xibu", "tra_yilan"],
                        transStation: ["songshantra1"]
                    },
                    {
                        line: ["tra_xibu", "tra_yilan"],
                        transStation: ["qidutra1"]
                    },
                    {
                        line: ["tra_xibu", "tra_yilan"],
                        transStation: ["badutra1"]
                    }
                ]
            /*}, {
                id: 'traInnerTrans_tra_xibu,tra_beihui',
                fromToLine: ["tra_xibu","tra_beihui"],
                sect: ['taoyuan','taipei','keelung','northeast','yilan','beihui','hualian'],
                route: [
                    {
                        line: ["tra_xibu", "tra_beihui"],
                        transStation: ["banqiaotra1"]
                    },
                    {
                        line: ["tra_xibu", "tra_beihui"],
                        transStation: ["taipeitra1"]
                    },
                    {
                        line: ["tra_xibu", "tra_beihui"],
                        transStation: ["songshantra1"]
                    },
                    {
                        line: ["tra_xibu", "tra_beihui"],
                        transStation: ["qidutra1"]
                    },
                    {
                        line: ["tra_xibu", "tra_beihui"],
                        transStation: ["badutra1"]
                    }
                ]*/
            }, {
                id: 'traInnerTrans_tra_shan,tra_pingxi',
                fromToLine: ["tra_shan","tra_pingxi"],
                fromToLineReg: [
                	"^tra_pingxi$",
                	"^tra_shan$|^tra_zhjy$|^tra_jygx$"
                ],
                sect: ['northeast','miaoli','taichung','changhua','yunlin','chiayi','tainan','kaohsiung'],
                route: [
                    {
                        line: ["tra_shan", "tra_pingxi"],
                        transStation: ["banqiaotra1"]
                    }
                ]
            }, {
                id: 'traInnerTrans_tra_xibu,tra_pingxi',
                fromToLine: ["tra_xibu","tra_pingxi"],
                fromToLineReg: [
                	"^tra_pingxi$",
                	"^tra_xibu$|^tra_shan$|^tra_zhjy$|^tra_jygx$"
                ],
                sect: ['hsinchu','taoyuan','taipei','keelung','northeast'],
                route: [
                    {
                        line: ["tra_yilan", "tra_pingxi"],
                        transStation: ["ruifangtra1"]
                    },
                    {
                        line: ["tra_xibu", "tra_yilan" ,"tra_pingxi"],
                        transStation: ["banqiaotra1", "ruifangtra1"]
                    },
                    {
                        line: ["tra_xibu", "tra_yilan" ,"tra_pingxi"],
                        transStation: ["taipeitra1", "ruifangtra1"]
                    },
                    {
                        line: ["tra_xibu", "tra_yilan" ,"tra_pingxi"],
                        transStation: ["songshantra1", "ruifangtra1"]
                    },
                    {
                        line: ["tra_xibu", "tra_yilan" ,"tra_pingxi"],
                        transStation: ["qidutra1", "ruifangtra1"]
                    },
                    {
                        line: ["tra_xibu", "tra_yilan" ,"tra_pingxi"],
                        transStation: ["badutra1", "ruifangtra1"]
                    },
                    {
                        line: ["tra_shan", "tra_yilan" ,"tra_pingxi"],
                        transStation: ["banqiaotra1", "ruifangtra1"]
                    },
                    {
                        line: ["tra_zhjy", "tra_yilan" ,"tra_pingxi"],
                        transStation: ["banqiaotra1", "ruifangtra1"]
                    },
                    {
                        line: ["tra_jygx", "tra_yilan" ,"tra_pingxi"],
                        transStation: ["banqiaotra1", "ruifangtra1"]
                    }
                ]
            }, {
                id: 'traInnerTrans_tra_xibu,tra_liujia',
                fromToLine: ["tra_xibu","tra_liujia"],
                sect: ['hsinchu','taoyuan','taipei','keelung','northeast'],
                route: [
                    {
                        line: ["tra_xibu", "tra_liujia"],
                        transStation: ["hsinchutra1"]
                    },
                    {
                        line: ["tra_xibu", "tra_liujia"],
                        transStation: ["northhsinchutra1"]
                    }
                ]
            }, {
                id: 'traInnerTrans_tra_shan,tra_liujia',
                fromToLine: ["tra_shan","tra_liujia"],
                fromToLineReg: [
                	"^tra_liujia$",
                	"^tra_shan$|^tra_zhjy$|^tra_jygx$"
                ],
                sect: ['hsinchu','miaoli','taichung','changhua','yunlin','chiayi','tainan','kaohsiung'],
                route: [
                    {
                        line: ["tra_xibu", "tra_liujia"],
                        transStation: ["hsinchutra1"]
                    }
                ]
            }, {
                id: 'traInnerTrans_tra_yilan,tra_liujia',
                fromToLine: ["tra_yilan","tra_liujia"],
                fromToLineReg: [
                	"^tra_liujia$",
                	"^tra_yilan$|^tra_beihui$|^tra_huadong$"
                ],
                sect: ['hsinchu','yilan','northeast','beihui','hualian','taidong'],
                route: [
                    {
                        line: ["tra_yilan", "tra_xibu"],
                        transStation: ["banqiaotra1"]
                    }
                ]
            /*}, {
                id: 'traInnerTrans_tra_yilan,tra_liujia',
                fromToLine: ["tra_yilan","tra_liujia"],
                sect: ['hsinchu','yilan','northeast'],
                route: [
                    {
                        line: ["tra_yilan", "tra_xibu" ,"tra_liujia"],
                        transStation: ["banqiaotra1", "hsinchutra1"]
                    }
                ]
            }, {
                id: 'traInnerTrans_tra_beihui,tra_liujia',
                fromToLine: ["tra_beihui","tra_liujia"],
                sect: ['hsinchu','yilan','beihui','hualian'],
                route: [
                    {
                        line: ["tra_beihui", "tra_xibu" ,"tra_liujia"],
                        transStation: ["banqiaotra1", "hsinchutra1"]
                    }
                ]
            }, {
                id: 'traInnerTrans_tra_huadong,tra_liujia',
                fromToLine: ["tra_huadong","tra_liujia"],
                sect: ['hsinchu','hualian','taidong'],
                route: [
                    {
                        line: ["tra_huadong", "tra_xibu" ,"tra_liujia"],
                        transStation: ["banqiaotra1", "hsinchutra1"]
                    }
                ]*/
            }, {
                id: 'traInnerTrans_tra_jygx,tra_shalun',
                fromToLine: ["tra_jygx","tra_shalun"],
                sect: ['chiayi','tainan','kaohsiung'],
                route: [
                    {
                        line: ["tra_jygx", "tra_shalun"],
                        transStation: ["zhongzhoutra1"]
                    },
                    {
                        line: ["tra_jygx", "tra_shalun"],
                        transStation: ["tainantra1"]
                    }
                ]
            }, {
                id: 'traInnerTrans_tra_xibu,tra_shalun',
                fromToLine: ["tra_xibu","tra_shalun"],
                fromToLineReg: [
                	"^tra_shalun$",
                	"^tra_xibu$|^tra_shan$|^tra_zhjy$"
                ],
                sect: ['northeast','keelung','taipei','taoyuan','hsinchu','miaoli','taichung','changhua','yunlin','chiayi','tainan'],
                route: [
                    {
                        line: ["tra_xibu", "tra_shalun"],
                        transStation: ["tainantra1"]
                    }
                ]
            }, {//TRA sub line to sub line
                id: 'traInnerTrans_tra_pingxi,tra_liujia',
                fromToLine: ["tra_pingxi","tra_liujia"],
                sect: ['hsinchu','northeast'],
                route: [
                    {
                        line: ["tra_pingxi", "tra_xibu", "tra_yilan" ,"tra_liujia"],
                        transStation: ["ruifangtra1", "banqiaotra1", "hsinchutra1"]
                    }
                ]
            }, {
                id: 'traInnerTrans_tra_pingxi,tra_shalun',
                fromToLine: ["tra_pingxi","tra_shalun"],
                sect: ['northeast','tainan'],
                route: [
                    {
                        line: ["tra_pingxi", "tra_yilan", "tra_xibu" ,"tra_shalun"],
                        transStation: ["ruifangtra1", "banqiaotra1", "tainantra1"]
                    }
                ]
            }, {
                id: 'traInnerTrans_tra_liujia,tra_shalun',
                fromToLine: ["tra_liujia","tra_shalun"],
                sect: ['hsinchu','tainan'],
                route: [
                    {
                        line: ["tra_liujia", "tra_xibu","tra_shalun"],
                        transStation: ["hsinchutra1", "tainantra1"]
                    }
                ]
            }, {//TRA to TRTC
                id: 'tra_xibu,trtc_3',
                fromToLine: ["tra_xibu","trtc_3"],
                sect: ['taipei','keelung','taoyuan','hsinchu'],
                route: [
                    {
                        bypassStationReg: '^trtc_086$|^trtc_04[0-3]$|^trtc_03[2-9]$',
                        line: ["tra_xibu", "trtc_3"],
                        transStation: ["songshan1"]
                    },
                    {
                        bypassStationReg: '^trtc_086$|^trtc_04[0-3]$|^trtc_03[2-9]$',
                        line: ["tra_xibu", "trtc_2", "trtc_3"],
                        transStation: ["taipei2", "zhongshan1"]
                    },
                    {
                        line: ["tra_xibu", "trtc_5", "trtc_3"],
                        transStation: ["banqiao1", "ximen1"]
                    },
                    {
                        bypassStationReg: '^trtc_111$|^trtc_110$|^trtc_109$|^trtc_009$|^trtc_132$|^trtc_053$|^trtc_105$|^trtc_086$',
                        line: ["tra_xibu", "trtc_2", "trtc_3"],
                        transStation: ["taipei2", "cksmh1"]
                    }
                ]
            }, {
                id: 'tra_xibu,trtc_5',
                fromToLine: ["tra_xibu","trtc_5"],
                sect: ['taipei','keelung','taoyuan','hsinchu'],
                route: [
                    {
                        bypassStationReg: '^trtc_08[0-2]$|^trtc_07[6-9]$',
                        line: ["tra_xibu", "trtc_5"],
                        transStation: ["nangang1"]
                    },
                    {
                        line: ["tra_xibu", "trtc_5"],
                        transStation: ["taipei1"]
                    },
                    {
                        bypassStationReg: '^trtc_031$|^trtc_097$|^trtc_096$',
                        line: ["tra_xibu", "trtc_5"],
                        transStation: ["banqiao1"]
                    }
                ]
            }, {
                id: 'tra_xibu,trtc_2',
                fromToLine: ["tra_xibu","trtc_2"],
                sect: ['taipei','keelung','taoyuan','hsinchu'],
                route: [
                    {
                        line: ["tra_xibu", "trtc_2"],
                        transStation: ["taipei2"]
                    }
                ]
            }, {
                id: 'tra_xibu,trtc_4',
                fromToLine: ["tra_xibu","trtc_4"],
                sect: ['taipei','keelung','taoyuan','hsinchu'],
                route: [
                    {
                        bypassStationReg: '^trtc_089$|^trtc_13[0-2]$|^trtc_055$|^trtc_12[1-8]$|^trtc_180$|^trtc_17[4-9]$',
                        line: ["tra_xibu", "trtc_2", "trtc_4"],
                        transStation: ["taipei2", "dongmen1"]
                    },
                    {
                        bypassStationReg: '^trtc_132$|^trtc_089$|^trtc_134$|^trtc_041$|^trtc_04[5-8]$',
                        line: ["tra_xibu", "trtc_2", "trtc_4"],
                        transStation: ["taipei2", "mqxl1"]
                    },
                    {
                        bypassStationReg: '^trtc_089$|^trtc_13[0-2]$|^trtc_055$|^trtc_12[1-8]$|^trtc_180$|^trtc_17[4-9]$',
                        line: ["tra_xibu", "trtc_2", "trtc_3", "trtc_4"],
                        transStation: ["taipei2", "cksmh1", "guting1"]
                    },
                    {
                        bypassStationReg: '^trtc_132$|^trtc_089$|^trtc_134$|^trtc_041$|^trtc_04[5-8]$',
                        line: ["tra_xibu", "trtc_3", "trtc_4"],
                        transStation: ["songshan1","sjnanjing1"]
                    }
                ]
            }, {
                id: 'trtc_5,trtc_2',
                fromToLine: ["trtc_5","trtc_2"],
                sect: ['taipei'],
                route: [
                    {
                        line: ["trtc_5", "trtc_2"],
                        transStation: ["taipei3"]
                    },
                    {
                        bypassBothStationReg: '^trtc_08[8-9]$|^trtc_010$|^trtc_09[1-7]$|^trtc_031$|^trtc_05[1-9]$|^trtc_06[0-9]$|^trtc_07[0-1]$',
                        line: ["trtc_5", "trtc_3", "trtc_2"],
                        transStation: ["ximen1", "cksmh1"]
                    }
                ]
            }, {
                id: 'trtc_4,trtc_2',
                fromToLine: ["trtc_4","trtc_2"],
                sect: ['taipei'],
                route: [
                    {
                        bypassBothStationReg: '^trtc_05[0-4]$|^trtc_089$|^trtc_13[0-2]$|^trtc_055$|^trtc_12[1-8]$|^trtc_180$|^trtc_17[4-9]$',
                        line: ["trtc_4", "trtc_2"],
                        transStation: ["dongmen1"]
                    },
                    {
                        bypassBothStationReg: '^trtc_05[0-4]$|^trtc_132$|^trtc_089$|^trtc_134$|^trtc_041$|^trtc_04[5-8]$',
                        line: ["trtc_4", "trtc_2"],
                        transStation: ["mqxl1"]
                    },
                    {
                        bypassBothStationReg: '^trtc_05[0-4]$|^trtc_089$|^trtc_13[0-2]$|^trtc_055$|^trtc_12[1-8]$|^trtc_180$|^trtc_17[4-9]$',
                        line: ["trtc_4", "trtc_3", "trtc_2"],
                        transStation: ["guting1", "cksmh1"]
                    }
                ]
            }, {
                id: 'trtc_3,trtc_2',
                fromToLine: ["trtc_3","trtc_2"],
                sect: ['taipei'],
                route: [
                    {
                        bypassBothStationReg: '^trtc_105$|^trtc_132$|^trtc_009$|^trtc_11[0-1]$|^trtc_109$|^trtc_05[0-9]$|^trtc_06[0-9]$|^trtc_07[0-1]$',
                        line: ["trtc_3", "trtc_2"],
                        transStation: ["cksmh1"]
                    },
                    {
                        bypassStationReg: '^trtc_04[0-3]$|^trtc_03[2-9]$',
                        line: ["trtc_3", "trtc_2"],
                        transStation: ["zhongshan1"]
                    }
                ]
            }, {
                id: 'trtc_3,trtc_5',
                fromToLine: ["trtc_3","trtc_5"],
                sect: ['taipei'],
                route: [
                    {
                        line: ["trtc_3", "trtc_5"],
                        transStation: ["ximen1"]
                    },
                    {
                        bypassStationReg: '^trtc_07[6-9]$|^trtc_08[0-9]$|^trtc_09[1-5]$|^trtc_05[1-3]$|^trtc_010$|^trtc_03[2-9]$|^trtc_04[0-3]$|^trtc_132$',
                        line: ["trtc_3", "tra_xibu", "trtc_5"],
                        transStation: ["songshan1", "nangang1"]
                    }
                ]
            }, {
                id: 'trtc_4,trtc_5',
                fromToLine: ["trtc_4","trtc_5"],
                sect: ['taipei'],
                route: [
                    {
                        line: ["trtc_4", "trtc_5"],
                        transStation: ["zhongxiaoxs1"]
                    },
                    {
                        bypassBothStationReg: '^trtc_08[8-9]$|^trtc_010$|^trtc_09[1-7]$|^trtc_031$|^trtc_051$|^trtc_055$|^trtc_13[0-2]$|^trtc_12[1-8]$|^trtc_17[4-9]$|^trtc_180$',
                        line: ["trtc_4", "trtc_3", "trtc_5"],
                        transStation: ["guting1", "ximen1"]
                    }
                ]
            }, {
                id: 'trtc_3,trtc_4',
                fromToLine: ["trtc_3","trtc_4"],
                sect: ['taipei'],
                route: [
                    {
                        bypassBothStationReg: '^trtc_009$|^trtc_109$|^trtc_11[0-1]$|^trtc_105$|^trtc_053$|^trtc_055$|^trtc_13[0-2]$|^trtc_12[1-8]$|^trtc_17[4-9]$|^trtc_180$',
                        line: ["trtc_3", "trtc_4"],
                        transStation: ["guting1"]
                    },
                    {
                        bypassBothStationReg: '^trtc_04[5-8]$|^trtc_105$|^trtc_086$|^trtc_04[0-3]$|^trtc_03[2-9]$|^trtc_134$|^trtc_089$',
                        line: ["trtc_3", "trtc_4"],
                        transStation: ["sjnanjing1"]
                    }
                ]
            }, {
                id: 'trtc_4,trtc_4',
                fromToLine: ["trtc_4","trtc_4"],
                sect: ['taipei'],
                route: [
                    {
                        line: ["trtc_4", "trtc_4"],
                        transStation: ["daqiaotou1"]
                    }
                ]
            }
        ],
        routeSystem: [
            {
                id: 'tra_r1',
                rType: 'direct',//direct , trans 
                company: 'tra',
                big: 'e',
                lineStr: 'tra_xibu,tra_huadong,tra_beihui,tra_yilan',
                directSect: 'taipei,keeling,northeast,yilan,beihui,hualian,taidong'
            }, {
                id: 'tra_r2',
                rType: 'direct',//direct , trans 
                company: 'tra',
                big: 'w',
                lineStr: 'tra_xibu,tra_shan,tra_zhjy,tra_jygx',
                directSect: 'keeling,taipei,taoyuan,hsinchu,miaoli,taichung,chungha,yunlin,chiayi,tainan,kaohsiung'
            }, {
                id: 'tra_r4',
                rType: 'direct',//direct , trans 
                company: 'tra',
                big: 'w',
                lineStr: 'tra_huadong,tra_beihui,tra_yilan,tra_shan,tra_zhjy,tra_jygx',
                directSect: 'northeast,yilan,beihui,hualian,taidong,miaoli,taichung,chungha,yunlin,chiayi,tainan,kaohsiung'
            }, {
                id: 'tra_r5',
                rType: 'direct',//direct , trans 
                company: 'tra',
                big: 'w',
                lineStr: 'tra_liujia',
                directSect: 'hsinchu'
            }, {
                id: 'tra_r6',
                rType: 'direct',//direct , trans 
                company: 'tra',
                big: 'w',
                lineStr: 'tra_shalun,tra_jygx',
                directSect: 'tainan'
            }, {
                id: 'tra_route_line_map',
                rType: 'map',//Do not remove this route system , important
                company: 'tra',
                dir: "0",
                link:[
                    'tra_jygx,tra_zhjy,tra_shan,tra_xibu,tra_yilan,tra_pingxi',
                    'tra_jygx,tra_zhjy,tra_shan,tra_xibu,tra_yilan,tra_beihui,tra_huadong',
                    'tra_shalun,tra_jygx,tra_zhjy,tra_shan,tra_xibu,tra_yilan,tra_beihui,tra_huadong'
                ]
            }, {
                id: 'tra_west_east_trans',
                rType: 'trans',
                company: 'tra',
                routeMapID: 'traInnerTrans_tra_xibu,tra_yilan,tra_beihui,tra_huadong',
                lineInclude: [
                    ['tra_xibu','tra_shan','tra_zhjy','tra_jygx','tra_liujia','tra_shalun'],
                    ['tra_yilan','tra_beihui','tra_huadong','tra_pingxi']
                ],
                rule: [
                    {
                        line: ['tra_jygx','tra_zhjy','tra_shan','tra_yilan','tra_beihui','tra_huadong','tra_pingxi'],
                        sect: ['taoyuan','hsinchu','miaoli','taichung','changhua','yunlin','chiayi','tainan','kaohsiung','pingdong'],
                        station: ["tra_1032","tra_1012","tra_1013","tra_1014"],
                        transStation: 'banqiaotra1'
                    }, {
                        line: ['tra_yilan','tra_beihui','tra_huadong','tra_pingxi'],
                        station: ["tra_1009","tra_1006","tra_1031","tra_1005","tra_1004"],
                        transStation: 'songshantra1'
                    }, {
                        line: ['tra_yilan','tra_beihui','tra_huadong','tra_pingxi'],
                        station: ["tra_1031","tra_1005","tra_1004","tra_1030","tra_1002","tra_1029","tra_1001"],
                        transStation: 'qidutra1'
                    }, {
                        line: ['tra_yilan','tra_beihui','tra_huadong','tra_pingxi'],
                        station: ["tra_1030","tra_1003","tra_1029","tra_1001"],
                        transStation: 'badutra1'
                    }
                    
                ]
            }, {
                id: 'tra_xibu_shan_trans',
                rType: 'trans',
                company: 'tra',
                routeMapID: 'traInnerTrans_tra_xibu,tra_shan',
                lineInclude: [
                    ['tra_xibu','tra_liujia'],
                    ['tra_shan']
                ],
                rule: [
                    {
                        line: ['tra_shan'],
                        sect: ['keelung'],
                        transStation: 'qidutra1'
                    }, {
                        line: ['tra_shan'],
                        station: ["tra_1004","tra_1005","tra_1031","tra_1006"],
                        transStation: 'songshantra1'
                    }, {
                        line: ['tra_shan'],
                        station: ["tra_1009","tra_1032","tra_1012","tra_1013"],
                        transStation: 'banqiaotra1'
                    }, {
                        line: ['tra_shan'],
                        station: ["tra_1012","tra_1013","tra_1014"],
                        transStation: 'taoyuantra1'
                    }, {
                        line: ['tra_shan'],
                        station: ["tra_1016","tra_1018"],
                        transStation: 'zhonglitra1'
                    }, {
                        line: ['tra_shan'],
                        station: ["tra_1019","tra_1020"],
                        sect: ['hsinchu'],
                        transStation: 'hsinchutra1'
                    }, {
                        line: ['tra_xibu','tra_liujia'],
                        station: ["tra_1019","tra_1020"],
                        sect: ['miaoli'],
                        transStation: 'miaolitra1'
                    }, {
                        line: ['tra_xibu','tra_liujia'],
                        station: ["tra_1315","tra_1318"],
                        transStation: 'fengyuantra1'
                    }, {
                        line: ['tra_xibu','tra_liujia'],
                        sect: ['taichung'],
                        transStation: 'taizhongtra1'
                    }
                    
                ]
            }, {
                id: 'tra_xibu_zhjy_trans',
                rType: 'trans',
                company: 'tra',
                routeMapID: 'traInnerTrans_tra_xibu,tra_zhjy',
                lineInclude: [
                    ['tra_xibu','tra_liujia'],
                    ['tra_zhjy']
                ],
                rule: [
                    {
                        line: ['tra_zhjy'],
                        sect: ['keelung'],
                        transStation: 'qidutra1'
                    }, {
                        line: ['tra_zhjy'],
                        station: ["tra_1004","tra_1005","tra_1031","tra_1006"],
                        transStation: 'songshantra1'
                    }, {
                        line: ['tra_zhjy'],
                        station: ["tra_1009","tra_1032","tra_1012","tra_1013"],
                        transStation: 'banqiaotra1'
                    }, {
                        line: ['tra_zhjy'],
                        station: ["tra_1012","tra_1013","tra_1014"],
                        transStation: 'taoyuantra1'
                    }, {
                        line: ['tra_zhjy'],
                        station: ["tra_1016","tra_1018"],
                        transStation: 'zhonglitra1'
                    }, {
                        line: ['tra_zhjy'],
                        station: ["tra_1019","tra_1020"],
                        sect: ['hsinchu'],
                        transStation: 'hsinchutra1'
                    }, {
                        line: ['tra_xibu','tra_liujia'],
                        sect: ['changhua'],
                        transStation: 'zhanghuatra1'
                    }, {
                        line: ['tra_xibu','tra_liujia'],
                        station: ["tra_1208","tra_1209"],
                        sect: ['changhua'],
                        transStation: 'yuanlintra1'
                    }, {
                        line: ['tra_xibu','tra_liujia'],
                        sect: ['yunlin'],
                        transStation: 'douliutra1'
                    }, {
                        line: ['tra_xibu','tra_liujia'],
                        sect: ['chiayi'],
                        transStation: 'jiayitra1'
                    }
                    
                ]
            }, {
                id: 'tra_xibu_jygx_trans',
                rType: 'trans',
                company: 'tra',
                routeMapID: 'traInnerTrans_tra_xibu,tra_jygx',
                lineInclude: [
                    ['tra_xibu','tra_liujia'],
                    ['tra_jygx','tra_shalun']
                ],
                rule: [
                    {
                        line: ['tra_jygx','tra_shalun'],
                        sect: ['keelung'],
                        transStation: 'qidutra1'
                    }, {
                        line: ['tra_jygx','tra_shalun'],
                        station: ["tra_1004","tra_1005","tra_1031","tra_1006"],
                        transStation: 'songshantra1'
                    }, {
                        line: ['tra_jygx','tra_shalun'],
                        station: ["tra_1009","tra_1032","tra_1012","tra_1013"],
                        transStation: 'banqiaotra1'
                    }, {
                        line: ['tra_jygx','tra_shalun'],
                        station: ["tra_1012","tra_1013","tra_1014"],
                        transStation: 'taoyuantra1'
                    }, {
                        line: ['tra_jygx','tra_shalun'],
                        station: ["tra_1016","tra_1018"],
                        transStation: 'zhonglitra1'
                    }, {
                        line: ['tra_jygx','tra_shalun'],
                        station: ["tra_1019","tra_1020"],
                        sect: ['hsinchu'],
                        transStation: 'hsinchutra1'
                    }, {
                        line: ['tra_xibu','tra_liujia'],
                        sect: ['chiayi'],
                        transStation: 'jiayitra1'
                    }, {
                        line: ['tra_xibu','tra_liujia'],
                        sect: ['tainan'],
                        transStation: 'tainantra1'
                    }, {
                        line: ['tra_xibu','tra_liujia'],
                        sect: ['kaohsiung'],
                        transStation: 'gaoxungtra1'
                    }
                    
                ]
            }, {
                id: 'tra_shan_zhjy_trans',
                rType: 'trans',
                company: 'tra',
                routeMapID: 'traInnerTrans_tra_shan,tra_zhjy',
                lineInclude: [
                    ['tra_shan'],
                    ['tra_zhjy']
                ],
                rule: [
                    {
                        line: ['tra_zhjy'],
                        sect: ['miaoli'],
                        transStation: 'miaolitra1'
                    }, {
                        line: ['tra_zhjy'],
                        station: ["tra_1315","tra_1314","tra_1310"],
                        transStation: 'fengyuantra1'
                    }, {
                        line: ['tra_zhjy'],
                        sect: ['taichung'],
                        transStation: 'taizhongtra1'
                    }, {
                        line: ['tra_shan'],
                        sect: ['changhua'],
                        station: ["tra_1321","tra_1324"],
                        transStation: 'zhanghuatra1'
                    }, {
                        line: ['tra_shan'],
                        sect: ['changhua'],
                        transStation: 'yuanlintra1'
                    }, {
                        line: ['tra_shan'],
                        sect: ['yunlin'],
                        transStation: 'douliutra1'
                    }, {
                        line: ['tra_shan'],
                        sect: ['chiayi'],
                        transStation: 'jiayitra1'
                    }
                ]
            }, {
                id: 'tra_shan_jygx_trans',
                rType: 'trans',
                company: 'tra',
                routeMapID: 'traInnerTrans_tra_shan,tra_jygx',
                lineInclude: [
                    ['tra_shan'],
                    ['tra_jygx','tra_shalun']
                ],
                rule: [
                    {
                        line: ['tra_jygx','tra_shalun'],
                        sect: ['miaoli'],
                        transStation: 'miaolitra1'
                    }, {
                        line: ['tra_jygx','tra_shalun'],
                        station: ["tra_1315","tra_1314","tra_1310"],
                        transStation: 'fengyuantra1'
                    }, {
                        line: ['tra_jygx','tra_shalun'],
                        sect: ['taichung'],
                        transStation: 'taizhongtra1'
                    }, {
                        line: ['tra_jygx','tra_shalun'],
                        sect: ['changhua'],
                        station: ["tra_1321","tra_1324"],
                        transStation: 'zhanghuatra1'
                    }, {
                        line: ['tra_shan'],
                        sect: ['chiayi'],
                        transStation: 'jiayitra1'
                    }, {
                        line: ['tra_shan'],
                        sect: ['tainan'],
                        transStation: 'tainantra1'
                    }, {
                        line: ['tra_shan'],
                        sect: ['kaohsiung'],
                        transStation: 'gaoxungtra1'
                    }
                ]
            }, {
                id: 'tra_zhjy_jygx_trans',
                rType: 'trans',
                company: 'tra',
                routeMapID: 'traInnerTrans_tra_zhjy,tra_jygx',
                lineInclude: [
                    ['tra_zhjy'],
                    ['tra_jygx','tra_shalun']
                ],
                rule: [
                    {
                        line: ['tra_jygx','tra_shalun'],
                        sect: ['changhua'],
                        transStation: 'yuanlintra1'
                    }, {
                        line: ['tra_jygx','tra_shalun'],
                        sect: ['yunlin'],
                        transStation: 'douliutra1'
                    }, {
                        line: ['tra_jygx','tra_shalun'],
                        sect: ['chiayi'],
                        transStation: 'jiayitra1'
                    }, {
                        line: ['tra_zhjy'],
                        sect: ['tainan'],
                        transStation: 'tainantra1'
                    }, {
                        line: ['tra_zhjy'],
                        sect: ['kaohsiung'],
                        transStation: 'gaoxungtra1'
                    }
                ]
            }, {
                id: 'tra_yilan_beihui_trans',
                rType: 'trans',
                company: 'tra',
                routeMapID: 'traInnerTrans_tra_yilan,tra_beihui',
                lineInclude: [
                    ['tra_beihui'],
                    ['tra_yilan','tra_pingxi']
                ],
                rule: [
                    {
                        line: ['tra_beihui'],
                        station: ["tra_1802","tra_1803","tra_1805","tra_1806"],
                        transStation: 'ruifangtra1'
                    }, {
                        line: ['tra_beihui'],
                        station: ["tra_1807","tra_1808","tra_1809","tra_1810","tra_1811","tra_1812","tra_1813","tra_1814","tra_1815","tra_1816","tra_1817","tra_1818","tra_1819"],
                        transStation: 'yilantra1'
                    }, {
                        line: ['tra_beihui'],
                        station: ["tra_1821","tra_1822","tra_1824","tra_1825"],
                        transStation: 'luodongtra1'
                    }, {
                        line: ['tra_beihui'],
                        station: ["tra_1827","tra_1825","tra_1824"],
                        transStation: 'suaoxintra1'
                    }, {
                        line: ['tra_yilan','tra_pingxi'],
                        sect: ['hualian'],
                        transStation: 'hualiantra1'
                    }
                    
                ]
            }, {
                id: 'tra_yilan_huadong_trans',
                rType: 'trans',
                company: 'tra',
                routeMapID: 'traInnerTrans_tra_yilan,tra_huadong',
                lineInclude: [
                    ['tra_huadong'],
                    ['tra_yilan','tra_pingxi']
                ],
                rule: [
                    {
                        line: ['tra_huadong'],
                        station: ["tra_1802","tra_1803","tra_1805","tra_1806"],
                        transStation: 'ruifangtra1'
                    }, {
                        line: ['tra_huadong'],
                        station: ["tra_1807","tra_1808","tra_1809","tra_1810","tra_1811","tra_1812","tra_1813","tra_1814","tra_1815","tra_1816","tra_1817","tra_1818","tra_1819"],
                        transStation: 'yilantra1'
                    }, {
                        line: ['tra_huadong'],
                        station: ["tra_1821","tra_1822","tra_1824","tra_1825"],
                        transStation: 'luodongtra1'
                    }, {
                        line: ['tra_huadong'],
                        station: ["tra_1827","tra_1825","tra_1824"],
                        transStation: 'suaoxintra1'
                    }, {
                        line: ['tra_yilan','tra_pingxi'],
                        sect: ['hualian'],
                        transStation: 'hualiantra1'
                    }, {
                        line: ['tra_yilan','tra_pingxi'],
                        sect: ['hualian'],
                        station: ["tra_1624","tra_1625","tra_1626"],
                        transStation: 'yulitra1'
                    }, {
                        line: ['tra_yilan','tra_pingxi'],
                        sect: ['taidong'],
                        transStation: 'taidongtra1'
                    }
                ]
            }, {
                id: 'tra_beihui_huadong_trans',
                rType: 'trans',
                company: 'tra',
                routeMapID: 'traInnerTrans_tra_yilan,tra_huadong',
                lineInclude: [
                    ['tra_huadong'],
                    ['tra_beihui']
                ],
                rule: [
                    {
                        line: ['tra_huadong'],
                        sect: ['beihui','hualian'],
                        transStation: 'hualiantra1'
                    }
                ]
            }, {
                id: 'trtc_trans_tra_east',
                rType: 'cross',//direct , trans 
                company: ['trtc','tra'],// cross company serial
                regLine: "^trtc_1$|^trtc_2$|^trtc_3$|^trtc_4|^trtc_5$|^tra_yilan$|^tra_beihui$|^tra_huadong$|^tra_pingxi$|^tra_liujia$",
                lineIsSame: {
                    "tra_xibu": "^tra_yilan$|^tra_beihui$|^tra_huadong$|^tra_pingxi$|^tra_liujia$"
                },
                link: [
                	{
                		regLine: "^trtc_5|^tra_",
                		transStation: [
                			['banqiao1','taipei1','nangang1']
                		]
                	}, {
                		regLine: "^trtc_3$|^trtc_4|^tra_",
                		transStation: [['taipei2','songshan1']]
                	}, {
                		regLine: "^trtc_2$|^tra_",
                		transStation: [['taipei2']]
                	}
                ],
                sect: ['hsinchu','taoyuan','taipei','keeling','northeast','yilan','beihui','hualian','taidong']
            }, {
                id: 'trtc_trans_tra_west',
                rType: 'cross',//direct , trans 
                company: ['trtc','tra'],// cross company serial
                regLine: "^trtc_1$|^trtc_2$|^trtc_3$|^trtc_4|^trtc_5$|^tra_shan$|^tra_zhjy$|^tra_jygx$|^tra_shalun$",
                lineIsSame: {
                    "tra_xibu": "^tra_shan$|^tra_zhjy$|^tra_jygx$|^tra_shalun$"
                },
                link: [
                	{
                		regLine: "^trtc_5|^tra_",
                		transStation: [
                			['banqiao1','taipei1']
                		]
                	}, {
                		regLine: "^trtc_3$|^trtc_4|^tra_",
                		transStation: [['taipei2','songshan1']]
                	}, {
                		regLine: "^trtc_2$|^tra_",
                		transStation: [['taipei2']]
                	}
                ],
                sect: ['hsinchu','taoyuan','taipei','keeling','miaoli','taichung','changhua','yunlin','chiayi','tainan','kaohsiung']
            }
        ]
    }

    TT.fn = {
        checkEquaArrayStartEnd: function(ary1, ary2){
        	if(typeof(ary2[0])=='string' && typeof(ary2[1])=='string'){

            	if(ary1[0]==ary2[0] && ary1[ary1.length-1]==ary2[ary2.length-1]){
                	return true;
            	}else if(ary1[0]==ary2[ary2.length-1] && ary1[ary1.length-1]==ary2[0]){
                	return true;
            	}else{
                	return false;
            	}
        	}else if(typeof(ary2[0])=='object' && ary2[0].test){//Is regexp
        		if(ary2[0].test(ary1[0]) && ary2[ary2.length-1].test(ary1[ary1.length-1])){
        			return true;
        		}else if(ary2[ary2.length-1].test(ary1[0]) && ary2[0].test(ary1[ary1.length-1])){
                	return true;
            	}else{
                	return false;
            	}
        	}
        },
        checkEquaSectStartEnd: function(aSect, bSect, rSectAry){
        	var aFlg=false, bFlg=false;
        	rSectAry.map(function(s){
        		if(aSect==s) aFlg=true;
        		if(bSect==s) bFlg=true;
        	})
        	return aFlg && bFlg;
        },
        checkIsFunction: function(cbFn){
            return (typeof(cbFn)=='function');
        },
        checkIsError: function(str){
            var rt = false;
            if(typeof(str)=='string'){
                rt=/error|fail/ig.test(str);
            }
            return rt;
        },
        checkOnTimeRange: function(time, startTime, endTime){
            var crossDaySec = TT.fn.transTime2Sec(TT.defined.defaultCrossDayTime);
            time = TT.fn.transTime2Sec(time);
            startTime = TT.fn.transTime2Sec(startTime);
            endTime = TT.fn.transTime2Sec(endTime);
            
            if(time < crossDaySec) time+=86400;
            if(startTime < crossDaySec) startTime+=86400;
            if(endTime < crossDaySec) endTime+=86400;
            
            return (time >= startTime && time <= endTime);
        },
        checkTRA_dayTimeIsLoaded: function(w){
            if(w==null) w = TT.defined.defaultTRAWeekday;
            return (TT.data.tra.timeTable && TT.data.tra.timeTable[parseInt(w,10)]) ? true : false;
        },
        check_TRA_hasSameBigWord: function(a,b){
            a = a || '';
            b = b || '';
            for(var i=0; i<a.length; i++){
                if(b.indexOf(a.substr(i,1))!=-1) return true
            }
            return false;
        },
        checkTRTC_rnwTimeTableIsLoaded: function(){
            return (TT.data.trtc.rnwTimeTable) ? true : false;
        },
        dLog: function(st){
            if(!TT.defined.debugMode) return false;
            if(window.console) console.log(st);
        },
        findStationByString: function(str){
            if(str.length<1) return false;
            var isEng = (/^[\d|a-zA-Z]+$/.test(str));
            if(isEng) str = str.toLowerCase();
            if(!isEng) str = str.replace('臺','台');
            var allStAry = TT.fn.getAllStationArrayOnData(), rtAry = [];
            var name, idxof = -1;
            allStAry.map(function(st){
                name = (isEng) ? st.estring : st.name;
                idxof = name.indexOf(str);
                if(idxof!=-1){
                    rtAry.push($.extend({indexOfNum: idxof},st));
                }
            });
            rtAry.sort(function(a,b){
                var intA = parseInt(a.indexOfNum,10);
                var intB = parseInt(b.indexOfNum,10);
                if(intA==intB) return 0;
                if(intA < intB) return -1;
                if(intA > intB) return 1;
            });
            return rtAry;
        },
        getAllStationArrayOnData: function(needRewrite){
            if(TT.listOfStationAry && !needRewrite) return TT.listOfStationAry;
            var haveStAry = new Array();
            for(var k in TT.data){
                if(TT.data[k].station_ary){
                    haveStAry.push(TT.data[k].station_ary);
                }
            }
            var allStAry = new Array();
            haveStAry.map(function(stAry){
                allStAry = allStAry.concat(stAry);
            });
            TT.listOfStationAry = allStAry;
            return allStAry;
        },
        getDefaultDayLastTime: function(){
            return TT.fn.transSec2Time(TT.fn.transTime2Sec(TT.defined.defaultCrossDayTime)-1);
        },
        getDocumentHeight: function(){
            return document.documentElement.clientHeight;
        },
        getDocumentWidth: function(){
            return document.documentElement.clientWidth;
        },
        getCommon_allTrainStation: function(){
            var traAry = new Array(), trtcAry = new Array(), allAry = new Array(), tmpA;
            for(var i=0; i<TT.data.trtc.line.length; i++){
                for(var j=0; j<TT.data.trtc.line[i].station.length; j++){
                    tmpA = TT.fn.getTRTC_stationDataOfID(TT.data.trtc.line[i].station[j], TT.data.trtc.line[i].id);
                    trtcAry.push(tmpA);
                    allAry.push(tmpA);
                }
            }
            for(var i=0; i<TT.data.tra.line.length; i++){
                for(var j=0; j<TT.data.tra.line[i].station.length; j++){
                    tmpA = TT.fn.getTRA_stationDataOfID(TT.data.tra.line[i].station[j], TT.data.tra.line[i].id);
                    traAry.push(tmpA);
                    allAry.push(tmpA);
                }
            }
            
            return {
                traAry: traAry,
                trtcAry: trtcAry,
                allAry: allAry
            }
        },
        getCommon_lineColor: function(line){
            var cp = TT.fn.getCompanyOfLine(line);
                var lineObj = {},rt = '#000000';
                switch(cp){
                    case 'tra':
                        lineObj = TT.data.tra.line;
                    break;
                    case 'trtc':
                        lineObj = TT.data.trtc.line;
                    break;
                    default:
                        return false;
                    break;
                }
                for(var i=0; i<lineObj.length; i++){
                    if(lineObj[i].id==line){
                        rt = lineObj[i].color;
                        break;
                    }
                }
                return rt;
        },
        getCommon_lineData: function(line){
            var cp = TT.fn.getCompanyOfLine(line);
                var lineObj = {},rt = false;
                switch(cp){
                    case 'tra':
                        lineObj = TT.data.tra.line;
                    break;
                    case 'trtc':
                        lineObj = TT.data.trtc.line;
                    break;
                    default:
                        return false;
                    break;
                }
                for(var i=0; i<lineObj.length; i++){
                    if(lineObj[i].id==line){
                        rt = lineObj[i];
                        break;
                    }
                }
                return rt;
        },
        getCommon_lineName: function(line){
            var cp = TT.fn.getCompanyOfLine(line);
            var cpSimpleName = (function(){
                //switch(cp){
                    //case 'tra':
                        //return TT.defined.stringOfTRASimple;
                    //break;
                    //case 'trtc':
                        //return TT.defined.stringOfTRTCSimple;
                    //break;
                    //default:
                        //return '其他';
                    //break;
                //}
                return (TT.defined.stringSimpleOfCompany[cp]) ? TT.defined.stringSimpleOfCompany[cp] : '其他';
            })();
            var cpLineName = (function(){
                var lineObj = {},rt = '';
                switch(cp){
                    case 'tra':
                        lineObj = TT.data.tra.line;
                    break;
                    case 'trtc':
                        lineObj = TT.data.trtc.line;
                    break;
                    default:
                        return false;
                    break;
                }
                for(var i=0; i<lineObj.length; i++){
                    if(lineObj[i].id==line){
                        rt = lineObj[i].name;
                        break;
                    }
                }
                return rt;
            })();
            return '[' + cpSimpleName + '] ' + cpLineName;
        },
        getCommon_stationOnWhatLine: function(st){
            var aComp = TT.fn.getCompanyOfLine(st);
            
            switch(aComp){
                case 'tra':
                    return TT.fn.getTRA_stationOnWhatLine(st);
                break;
                case 'trtc':
                    return TT.fn.getTRTC_stationOnWhatLine(st);
                break;
            }
            return false;
        },
        getCommon_theTransRouteByFromTo: function(a, b){
            var objR = TT.fn.getRoute_allRouteByFromTo(a, b);
            var rt = new Array();
            if(objR.isRoute){
                var routeT = objR.getAllTakeMethod();
            /*}else if(objR.isDirect){
                var routeT = new Array();
                    routeT.push([{
                        company: TT.fn.getCompanyOfStation(a),
                        line: objR.displayLine,
                        takeRange: [a,b]
                    }]);*/
            }else{
                var routeT = new Array();
                for(var i=0; i<objR.length; i++){
                    routeT.push([{
                        company: TT.fn.getCompanyOfStation(a),
                        line: objR[i],
                        takeRange: [a,b]
                    }]);
                    if(objR[i]=='tra_liujia'){
                        var lineData = TT.fn.getCommon_lineData(objR[i]);
                        var atFlag = false, btFlag = false;
                        lineData.subWorkingArea.station.map(function(st){
                        			if(st==a) atFlag = true;
                        			if(st==b) btFlag = true;
                        });
                        if((atFlag && !btFlag) || (!atFlag && btFlag)){
                        	var tsid = lineData.subWorkingArea.transStationID;
                        	routeT.push([{
                        		company: TT.fn.getCompanyOfStation(a),
                        		line: objR[i],
                        		takeRange: [a,lineData.subWorkingArea.transAt],
                        		transStation: TT.fn.getRoute_transStationById(tsid),
                        		transStationID: tsid
                        	}, {
                        		company: TT.fn.getCompanyOfStation(a),
                        		line: objR[i],
                        		takeRange: [lineData.subWorkingArea.transAt,b]
                        	}])
                        }
                    }
                }
            }
            return routeT;
        },
        getCommon_timeRangeBestByFromTo: function(a, b, startTime, endTime, flagAD, w){
            if(flagAD===undefined) flagAD = true;
            var aryRouteAll = TT.fn.getCommon_timeTakeByFromTo(a, b, startTime, endTime, flagAD, w);
            var aryP = new Array(), rt = new Array();
            
            function getBest(routeA){
                var trainBest = new Array(), trainM, pointer;
                if(flagAD==true){
                    var routeB = routeA[0];
                    for(var i=0; i<routeB.formatTimeTable.length; i++){
                        if(routeB.formatTimeTable[i].onTimeRange==true && routeB.formatTimeTable[i].bestStart){
                            trainBest.push(routeB.formatTimeTable[i]);
                        }else if(routeB.formatTimeTable[i].onTimeRange==true && i==routeB.formatTimeTable.length-1 && routeB.formatTimeTable[i].nextPointer>0){
                            trainBest.push(routeB.formatTimeTable[i]);
                        }
                    }
                }else{
                    var routeB = routeA[routeA.length-1];
                    var flagFirstAlready = false;
                    for(var i=0; i<routeB.formatTimeTable.length; i++){
                        if(!flagFirstAlready && routeA.length>1 && routeB.formatTimeTable[i].onTimeRange==true){
                            flagFirstAlready = true;
                            trainBest.push(routeB.formatTimeTable[i]);
                        }else if(routeB.formatTimeTable[i].onTimeRange==true && routeB.formatTimeTable[i].bestEnd){
                            trainBest.push(routeB.formatTimeTable[i]);
                        }
                    }
                }
                return trainBest;
            }
            
            function getLink(routeA, trainBest){
                var aryT = new Array();
                if(flagAD==true){
                    for(var tb=0; tb<trainBest.length; tb++){
                        aryT.push(new Array());
                        for(var i=0; i<routeA.length; i++){
                            if(i==0){
                                aryT[tb][i] = trainBest[tb];
                            }else{
                                aryT[tb][i] = (aryT[tb][i-1]) ? routeA[i].formatTimeTable[aryT[tb][i-1].nextPointer] : null;
                            }
                        }
                    }
                }else{
                    for(var tb=0; tb<trainBest.length; tb++){
                        aryT.push(new Array());
                        for(var i=routeA.length-1; i>=0; i--){
                            if(i==routeA.length-1){
                                aryT[tb][i] = trainBest[tb];
                            }else{
                                aryT[tb][i] = (aryT[tb][i+1]) ? routeA[i].formatTimeTable[aryT[tb][i+1].prevPointer] : null;
                            }
                        }
                    }
                }
                return aryT;
            }
            
            function matchBestTrain(routeA, bestAry){
                for(var i=0; i<routeA.length; i++){
                    routeA[i].bestTrain = new Array();
                    routeA[i].bestLink = new Array();
                    for(var j=0; j<bestAry.length; j++){
                        routeA[i].bestTrain.push(bestAry[j][i]);
                        routeA[i].bestLink.push(bestAry[j]);
                    }
                    //If only 1 route direct just use on time range for best
                    if(routeA.length==1 && bestAry.length==0){
                        for(var j=0; j<routeA[i].formatTimeTable.length; j++){
                            if(routeA[i].formatTimeTable[j].onTimeRange){
                                routeA[i].bestTrain.push(routeA[i].formatTimeTable[j]);
                                routeA[i].bestLink.push([routeA[i].formatTimeTable[j]]);
                            }
                        }
                    }
                }
                return routeA;
            }
            
            for(var i=0; i<aryRouteAll.length; i++){
                aryP[i] = getLink(aryRouteAll[i], getBest(aryRouteAll[i]));
                aryRouteAll[i] = matchBestTrain(aryRouteAll[i], aryP[i]);
            }
            
            return aryRouteAll;
            //return rt;
        },
        getCommon_timeTakeByFromTo: function(a, b, startTime, endTime, flagAD, w){
            if(flagAD===undefined) flagAD = true;
            if(!startTime) startTime = TT.defined.defaultCrossDayTime;
            if(!endTime) endTime = TT.fn.getDefaultDayLastTime();
            var sendStartTime = startTime, sendEndTime = endTime, keyFrom, keyTo;
            if(flagAD==true){
                sendEndTime = TT.fn.getDefaultDayLastTime();
            }else{
                sendStartTime = TT.defined.defaultCrossDayTime;
            }
            var aryRouteAll = TT.fn.getCommon_timeRangeByFromTo(a, b, sendStartTime, sendEndTime, flagAD, w);
            //Use TT.fn.checkOnTimeRange to get which train on time range 
            
            function giveOnTimeRange(routeA){
                var tmpTime;
                if(flagAD==true){
                    var routeB = routeA[0];
                    for(var i=0; i<routeB.formatTimeTable.length; i++){
                        tmpTime = routeB.formatTimeTable[i].time[0];
                        routeB.formatTimeTable[i].onTimeRange = TT.fn.checkOnTimeRange(tmpTime, startTime, endTime);
                    }
                    routeA[0] = routeB;
                }else{
                    var routeB = routeA[routeA.length-1];
                    for(var i=0; i<routeB.formatTimeTable.length; i++){
                        tmpTime = routeB.formatTimeTable[i].time[1];
                        routeB.formatTimeTable[i].onTimeRange = TT.fn.checkOnTimeRange(tmpTime, startTime, endTime);
                    }
                    routeA[routeA.length-1] = routeB;
                }
                return routeA;
            }
            
            for(var i=0; i<aryRouteAll.length; i++){
                aryRouteAll[i] = giveOnTimeRange(aryRouteAll[i]);
            }
            
            return aryRouteAll;
        },
        getCommon_timeRangeByFromTo: function(a, b, startTime, endTime, flagAD, w){
            if(flagAD===undefined) flagAD = true;
            var routeAry = TT.fn.getCommon_theTransRouteByFromTo(a,b);
            var tmpRouteTime, rt = new Array();
            
            function getFormatTime(company, routeB){
                var ary = new Array(), objA = {}
                switch(company){
                    case 'tra':
                        for(var i=0; i<routeB.timeTable.length; i++){
                            objA = {
                                time: routeB.timeTable[i].getFromToTime(),
                                info: routeB.timeTable[i]
                            }
                            ary.push(objA);
                        }
                    break;
                    case 'trtc':
                        for(var i=0; i<routeB.timeTable.length; i++){
                            objA = {
                                time: routeB.timeTable[i],
                                info: {}
                            }
                            ary.push(objA);
                        }
                    break;
                }
                routeB.formatTimeTable = ary;
                return routeB;
            }
            
            function getRouteTime(routeA){
                var startT = startTime, endT = endTime, routeB;
                if(flagAD==true){
                    for(var i=0; i<routeA.length; i++){
                        routeB = routeA[i];             
                        switch(routeB.company){
                            case 'tra':
                                routeB.timeTable = TT.fn.getTRA_timeRangeByFromTo(routeB.takeRange[0], routeB.takeRange[1], startT, endT, flagAD, w);      
                                //if(routeB.timeTable[0]) startT = routeB.timeTable[0].getFromToTime(routeB.takeRange[0],routeB.takeRange[1])[1];
                                //if(routeB.timeTable[routeB.timeTable.length-1]) endT = routeB.timeTable[routeB.timeTable.length-1].getFromToTime(routeB.takeRange[0],routeB.takeRange[1])[1];
                            break;
                            case 'trtc':
                                routeB.timeTable = TT.fn.getTRTC_timeRangeByFromTo(routeB.takeRange[0], routeB.takeRange[1], startT, endT, flagAD, routeB.line, w);
                                //if(routeB.timeTable[0]) startT = routeB.timeTable[0][1];
                                //if(routeB.timeTable[routeB.timeTable.length-1]) endT = routeB.timeTable[routeB.timeTable.length-1][1];
                            break;
                        }
                        routeB = getFormatTime(routeB.company, routeB);
                        if(routeB.transStation){
                                    startT = TT.fn.transSec2Time(TT.fn.transTime2Sec(startT) + routeB.transStation.walkMinute*60);
                                    //endT = TT.fn.transSec2Time(TT.fn.transTime2Sec(endT) + routeB.transStation.walkMinute*60);
                        }
                        routeA[i] = routeB;
                    }
                }else{
                    for(var i=routeA.length-1; i>=0; i--){
                        routeB = routeA[i];
                        switch(routeB.company){
                            case 'tra':
                                routeB.timeTable = TT.fn.getTRA_timeRangeByFromTo(routeB.takeRange[0], routeB.takeRange[1], startT, endT, flagAD, w);
                                //startT = routeB.timeTable[0].getFromToTime(routeB.takeRange[0],routeB.takeRange[1])[0];
                                if(routeB.timeTable[routeB.timeTable.length-1]) endT = routeB.timeTable[routeB.timeTable.length-1].getFromToTime(routeB.takeRange[0],routeB.takeRange[1])[0];
                            break;
                            case 'trtc':
                                routeB.timeTable = TT.fn.getTRTC_timeRangeByFromTo(routeB.takeRange[0], routeB.takeRange[1], startT, endT, flagAD, routeB.line, w);
                                //startT = routeB.timeTable[0][0];
                                if(routeB.timeTable[routeB.timeTable.length-1]) endT = routeB.timeTable[routeB.timeTable.length-1][0];
                            break;
                        }
                        routeB = getFormatTime(routeB.company, routeB);
                        if(routeB.transStation){
                                    startT = TT.fn.transSec2Time(TT.fn.transTime2Sec(startT) - routeB.transStation.walkMinute*60);
                                    endT = TT.fn.transSec2Time(TT.fn.transTime2Sec(endT) - routeB.transStation.walkMinute*60);
                        }
                        routeA[i] = routeB;
                    }
                }
                return routeA;
            }
            
            function getNextPointer(routeA){
                var routeB1, routeB2, crossOffsetSec, pointerA = -1, b1EndTime, b2StartTime, b2idx = 0;
                var crossDaySec = TT.fn.transTime2Sec(TT.defined.defaultCrossDayTime), offset1Day = 86400;
                for(var tc=0; tc<routeA.length; tc++){
                    if(routeA[tc].transStation && routeA[tc+1]){//Have next trans
                        routeB1 = routeA[tc]; routeB2 = routeA[tc+1];
                        crossOffsetSec = routeB1.transStation.walkMinute*60;
                        pointerA = -1;
                        b2idx = 0;
                        
                        for(var i=0; i<routeB1.formatTimeTable.length; i++){
                            b1EndTime = routeB1.formatTimeTable[i].time[1];
                            b1EndTime = TT.fn.transTime2Sec(b1EndTime) + crossOffsetSec;
                            if(b1EndTime < crossDaySec) b1EndTime += offset1Day;
                            for(var j=b2idx; j<routeB2.formatTimeTable.length; j++){
                                b2StartTime = TT.fn.transTime2Sec(routeB2.formatTimeTable[j].time[0]);
                                if(b2StartTime < crossDaySec) b2StartTime += offset1Day;
                                pointerA = -1;
                                if(!flagAD) b2idx = j;
                                routeB2.formatTimeTable[j].prevPointer = i-1;
                                routeB2.formatTimeTable[j].myPointer = j;
                                if(routeB1.doNotTakeTrain){routeB2.formatTimeTable[j].bestEnd = true;}
                                if(b2StartTime >= b1EndTime){
                                    pointerA = j;
                                    routeB2.formatTimeTable[j].prevPointer = i;
                                    routeB2.formatTimeTable[j].bestEnd = true;
                                    break;
                                }
                            }
                            if(routeB1.formatTimeTable[i-1] && routeB2.doNotTakeTrain){routeB1.formatTimeTable[i-1].bestStart = true;}
                            if(routeB1.formatTimeTable[i-1] && routeB1.formatTimeTable[i-1].nextPointer != pointerA){
                                routeB1.formatTimeTable[i-1].bestStart = true;
                            }
                            routeB1.formatTimeTable[i].nextPointer = pointerA;
                            routeB1.formatTimeTable[i].myPointer = i;
                            if(routeB1.formatTimeTable.length==1 && i==0 && routeB1.formatTimeTable[i].nextPointer>=0){
                                routeB1.formatTimeTable[i].bestStart = true;
                            }
                        }
                        //routeA[tc] = routeB1;
                    }
                }
                return routeA;
            }
            
            for(var i=0; i<routeAry.length; i++){
                tmpRouteTime = getRouteTime(routeAry[i]);
                tmpRouteTime = getNextPointer(tmpRouteTime);
                rt.push(tmpRouteTime);
            }
            
            return rt;
        },
        getCommon_stationDataOfID: function(stid){
            var cmp = TT.fn.getCompanyOfStation(stid);
            switch(cmp){
                case 'tra':
                    return TT.fn.getTRA_stationDataOfID(stid);
                break;
                case 'trtc':
                    return TT.fn.getTRTC_stationDataOfID(stid);
                break;
            }
            return false;
        },
        getCommon_transStationByID: function(tsid){
            var tsAry = TT.data.transStation;
            for(var i=0; i<tsAry.length; i++){
                if(tsAry[i].id==tsid){
                    return tsAry[i];
                }
            }
            return false;
        },
        getCommon_transStationBySameChangeStation: function(st){
        	var ts = TT.data.transStation;
        	for(var i=0; i<ts.length; i++){
        		if(ts[i].changeStation[0]==st && ts[i].changeStation[1]==st) return ts[i];
        	}
        	return false;
        },
        getCompanyOfLine: function(st){
            return TT.fn.getCompanyOfStation(st);
        },
        getCompanyOfStation: function(st){
            if(!st) return false;
            if(st.indexOf('trtc_')==0) return 'trtc';
            if(st.indexOf('tra_')==0) return 'tra';
            return false;
        },
        getData2JSON: function(node){
            var obj = {}
            switch(node){
                case 'tra':
                    for(var k in TT.data.tra){
                        if(k!='timeTable'){
                            obj[k] = TT.data.tra[k];
                        }
                    }
                break;
                case 'trtc':
                    for(var k in TT.data.trtc){
                        if(k!='rnwTimeTable'){
                            obj[k] = TT.data.trtc[k];
                        }
                    }
                break;
                default:
                            obj = TT.data[node];
                break;
            }
            return JSON.stringify(obj, undefined, 4);
        },
        saveDataJSON2Data: function(node, str){
            var obj = JSON.parse(str);
            //if(node=='tra' || node=='trtc'){
                for(var k in TT.data[node]){
                    if(obj[k]){
                        TT.data[node][k] = obj[k];
                    }
                }
            //}else{
                //TT.data[node] = obj;
            //}
        },
        getEncodeStationID: function(sid, comp){
            return comp + '_' + sid;
        },
        getXML_Attribute2Obj: function(xt){
            var jo = {}, nName = '', nText = '';
            for(var i=0; i<xt.attributes.length; i++){
                nName = xt.attributes[i].name;
                nText = xt.attributes[i].value;
                jo[nName] = nText;
            }
            return jo;
        },
        getRoute_allRouteByFromTo: function(a,b){
            var aComp = TT.fn.getCompanyOfStation(a),
                bComp = TT.fn.getCompanyOfStation(b),
                aLine = TT.fn.getCommon_stationOnWhatLine(a),
                bLine = TT.fn.getCommon_stationOnWhatLine(b);
            
            function giveRouteTakeRange(t){
                if(t.length==0) return t;
                for(var i=0; i<t.route.length; i++){
                    var ary = new Array();
                    var rr = t.getRouteAt(i);
                    if(!rr || rr.length==0){
                        t.route[i].takeRange = [t.fromStation, t.toStation];
                        continue;
                    }
                    for(var j=0; j<rr.length; j++){
                        if(j==0){
                            ary.push([t.fromStation, rr[j].changeStation[0]]);
                        }else{
                            ary.push([rr[j-1].changeStation[1], rr[j].changeStation[0]]);
                        }
                    }
                    ary.push([rr[rr.length-1].changeStation[1], t.toStation]);
                    t.route[i].takeRange = ary;
                }
                
                t.getTakeMethod = function(ro){
                    if(!ro) ro=0;
                    var routeT = t.route[ro];
                    if(!routeT) return false;
                    var rt = new Array(), tmpJ = {};
                    for(var i=0; i<routeT.line.length; i++){
                        tmpJ = {
                            line: routeT.line[i],
                            takeRange: routeT.takeRange[i],
                            company: TT.fn.getCompanyOfLine(routeT.line[i])
                        };
                        if(routeT.takeRange[i][0]==routeT.takeRange[i][1]) tmpJ.doNotTakeTrain=true;
                        if(routeT.transStation && routeT.transStation[i]){
                            tmpJ.transStationID = routeT.transStation[i];
                            tmpJ.transStation = TT.fn.getCommon_transStationByID(routeT.transStation[i]);
                        }
                        rt.push(tmpJ);
                    }
                    return rt;
                }
                
                t.getAllTakeMethod = function(){
                    var rt = new Array();
                    for(var i=0; i<t.route.length; i++){
                        rt.push(t.getTakeMethod(i));
                    }
                    return rt;
                }
                return t;
            }
            
            function procRoute(tmpA, tkLen){
                        tmpA.fromStation = a;
                        tmpA.toStation = b;
                        tmpA = giveRouteTakeRange(tmpA);
                        for(var m=0; m<tmpA.route.length; m++){//Check if any first or last station on takeRange is same station
                            tkLen = tmpA.route[m].takeRange.length;
                            if(tmpA.route[m].takeRange[tkLen-2] && tmpA.route[m].takeRange[tkLen-2][1]==tmpA.route[m].takeRange[tkLen-1][1]){
                                tmpA.route.splice(m,1);
                                m--;
                            }else if(tmpA.route[m].takeRange[1] && tmpA.route[m].takeRange[1][0]==tmpA.route[m].takeRange[0][0]){
                                tmpA.route.splice(m,1);
                                m--;
                            }
                        }
                        return tmpA;
            }
            
            var notMainLineOfStation = {
                "tra_pingxi": /^tra_1804$|^tra_1805$|^tra_1806$/,
                "tra_shan": /^tra_1028$/,
                "tra_zhjy": /^tra_1120$/,
                "tra_jygx": /^tra_1215$/,
                "tra_yilan": /^tra_1002$/,
                "tra_beihui": /^tra_1826$/,
                "tra_huadong": /^tra_1715$/
            }
            
            if(TT.fn.getRoute_needRouteByFromTo(a,b)){
                var rt = new Array(),tkLen, ckSame = new Array();
                //var regSameRouteDiffLineName = /^tra_pingxi$|tra_
                for(var i=0; i<aLine.length; i++){
                    for(var j=0; j<bLine.length; j++){
                        if(aLine[i] != bLine[j]){
                            if(notMainLineOfStation[aLine[i]] && notMainLineOfStation[aLine[i]].test(a)) continue;
                            if(notMainLineOfStation[bLine[j]] && notMainLineOfStation[bLine[j]].test(b)) continue;
                        }
                        //continue if ever add same route but different line name
                        var tmpA = TT.fn.getRoute_mapOfFromToLine(aLine[i],bLine[j],a,b);
                        if(!tmpA.route) break;
                        var tmpA = TT.fn.getRoute_filterSameRoute(a,b,tmpA,aLine[i],bLine[j]);
                        if(aComp=='tra' && bComp=='tra'){
                        	tmpA = TT.fn.getTRA_mayUseBoneTrans(a,b,aLine[i],bLine[j],tmpA);
                        }
                        tmpA = TT.fn.getRoute_specialTrans(tmpA, a, b);
                        tmpA = procRoute(tmpA, tkLen);
                        tmpA = TT.fn.getRoute_removeTortuousRoute(a,b,tmpA,aLine[i],bLine[j]);
                        if(tmpA !== false){
                            rt.push(tmpA);
                        }
                    }
                }
                
                //Check if a to b maybe directly
                var bMayDirect = (aComp=='tra' && bComp=='tra');
                var everAddList = new Array();
                //if(bMayDirect) rt.length = 0;
                //console.info(bMayDirect);
                
                if(rt.length < 1 || bMayDirect){
                    //Need Route System link different route
                    for(var i=0; i<aLine.length; i++){
                        for(var j=0; j<bLine.length; j++){
                            if(aLine[i] != bLine[j]){
                                if(notMainLineOfStation[aLine[i]] && notMainLineOfStation[aLine[i]].test(a)) continue;
                                if(notMainLineOfStation[bLine[j]] && notMainLineOfStation[bLine[j]].test(b)) continue;
                            }
                            //continue if ever add same route but different line name
                            var tmpA = TT.fn.getRoute_mapSystemOfFromToLine(aLine[i],bLine[j], a, b, everAddList);
                            //console.info($.extend({},tmpA));
                            if(tmpA.length==0) continue;
                            if(tmpA.isDirect){
                                rt.push(tmpA);
                            }else{
                                tmpA = procRoute(tmpA, tkLen);
                                if(tmpA !== false){
                                    rt.push(tmpA);
                                }
                            }
                        }
                    }
                }
                
                if(rt.length > 1){
                    var tmpRoute = new Array();
                    for(var i=0; i<rt.length; i++){
                        if(rt[i].isDirect){
                            tmpRoute.push({
                                line: [rt[i].displayLine],
                                takeRange: [[a,b]]
                            });
                        }else if(rt[i].route){
                            for(var j=0; j<rt[i].route.length; j++){
                                tmpRoute.push(rt[i].route[j]);
                            }
                        }
                    }
                    rt[0].route = tmpRoute; 
                }else if(rt.length<1){
                    //NO Route System link different route
                    rt[0] = false;
                }
                
                return rt[0];
            }else{
                switch(aComp){
                    case 'tra':
                        return TT.fn.getTRA_stationOnSameLine(a,b);
                    break;
                    case 'trtc':
                        return TT.fn.getTRTC_stationOnSameLine(a,b);
                    break;
                }
            }
        },
        getRoute_directionByFromToLine: function(a,b, routeOM){
            var routeM = $.extend({},routeOM);
        	var fsFlag = true;
        	//testObj = (routeMap[i].fromToLineReg) ? routeMap[i].fromToLineReg : routeMap[i].fromToLine;
        	if(routeM.fromToLineReg){
                var fromToLineReg = new Array();
                routeM.fromToLineReg.map(function(tm){
                    fromToLineReg.push(new RegExp(tm));
                });
        		if(fromToLineReg[0].test(a) && fromToLineReg[1].test(b)){
        			fsFlag = true;
        		}else if(fromToLineReg[0].test(b) && fromToLineReg[1].test(a)){
                	fsFlag = false;
            	}else{
                	return false;
            	}
        	}else{//Is regexp
	            if(routeM.fromToLine[0]==a && routeM.fromToLine[1]==b){
	                fsFlag = true;
	            }else if(routeM.fromToLine[0]==b && routeM.fromToLine[1]==a){
	                fsFlag = false;
	            }else{
	                return false;
	            }
        	}

        	if(fsFlag){
        		return routeM
        	}else{
        		routeM.fromToLine = routeM.fromToLine.reverse();
	                for(var i=0; i<routeM.route.length; i++){
	                        routeM.route[i].line = routeM.route[i].line.reverse();
	                        routeM.route[i].transStation = routeM.route[i].transStation.reverse();
	                }
	                return routeM;
        	}
        },
        getRoute_mainTransStationByFromToLine: function(aLine, bLine){
            var routeMap = TT.data.routeMap;
            var ts = '';
            routeMap.map(function(t){
                if((t.fromToLine[0]==aLine && t.fromToLine[1]==bLine) || (t.fromToLine[1]==aLine && t.fromToLine[0]==bLine)){
                    var numA = (t.mainRouteNumber) ? t.mainRouteNumber : 0;
                    ts = t.route[numA].transStation[0];
                }
            });
            return ts;
        },
        getRoute_removeTortuousRoute: function(a,b,tmpA,aLine,bLine){
            var aComp = TT.fn.getCompanyOfStation(a),
                bComp = TT.fn.getCompanyOfStation(b),
                aObj = TT.fn.getCommon_stationDataOfID(a),
                bObj = TT.fn.getCommon_stationDataOfID(b);
            var regA, removeFlag = false;
            var route = tmpA.route.slice();
            for(var i=0; i<route.length; i++){
                removeFlag = false;
                if(route[i].bypassStationReg){
                    regA = new RegExp(route[i].bypassStationReg);
                    if(regA.test(a) || regA.test(b)) removeFlag = true;
                }
                if(route[i].bypassBothStationReg){
                    regA = new RegExp(route[i].bypassBothStationReg);
                    if(regA.test(a) && regA.test(b)) removeFlag = true;
                }
                if(route[i].bypassSectReg){
                    regA = new RegExp(route[i].bypassSectReg);
                    if(regA.test(aObj.sect) || regA.test(bObj.sect)) removeFlag = true;
                }
                if(removeFlag){
                    route.splice(i,1);
                    i--;
                }
            }
            tmpA.route = route;
            return tmpA;
        },
        getRoute_specialTrans: function(tmpA, a ,b){
        	//routeT = [[{company:"",line:"",takeRange:["",""],transStation:{},transStationID:""}]];
        	var rt = new Array(), sindex = 0, lineObj, sbwa, aIsSub = false, bIsSub = false;

        	function checkIsSubWorkingArea(line,st){
        				lineObj = TT.fn.getCommon_lineData(line);
        				if(lineObj.subWorkingArea){
        					sbwa = lineObj.subWorkingArea;
        					for(var i=0; i<sbwa.station.length; i++){
        						if(st==sbwa.station[i]) return sbwa;
        					}
        				}
        				return false;
        	}
        	if(tmpA.route && tmpA.route.length>0){
        		tmpA.route.map(function(routeB, idxB){
        			var tLine = routeB.line.slice();
        			var tTS = routeB.transStation.slice();
        			if(routeB.line[0]=='tra_liujia'){
        				aIsSub = checkIsSubWorkingArea(routeB.line[0],a);
        				if(aIsSub){
        					tLine.splice(0,0,routeB.line[0]);
        					tTS.splice(0,0,aIsSub.transStationID);
        					tmpA.route.push({
        						line: tLine,
        						transStation: tTS
        					})
        				}

        			}else if(routeB.line[routeB.line.length-1]=='tra_liujia'){
        				bIsSub = checkIsSubWorkingArea(routeB.line[routeB.line.length-1],b);
        				if(bIsSub){
        					tLine.push(routeB.line[routeB.line.length-1]);
        					tTS.push(bIsSub.transStationID);
        					tmpA.route.push({
        						line: tLine,
        						transStation: tTS
        					})
        				}
        			}
        			
        		})
        	}

        	//if(rt.length==0) rt = false;
        	return tmpA;
        },
        getRoute_systemOfTrans: function(cfg){
            cfg = cfg || {}
            var rs = TT.data.routeSystem.filter(function(item){
                if(cfg.company && item.company){
                    return ((item.company==cfg.company) && (item.rType=='trans')) ? true : false;
                }else{
                    return ((item.rType=='trans')) ? true : false;
                }
            });
            
            if(cfg.line && cfg.line.length==2){
                var line0, line1;
                rs = rs.filter(function(item){
                    if(item.lineInclude){
                        line0 = false, line1 = false;
                        item.lineInclude[0].map(function(lineID){
                            if(lineID==cfg.line[0]) line0 = true;
                        });
                        item.lineInclude[1].map(function(lineID){
                            if(lineID==cfg.line[1]) line1 = true;
                        });
                        if(line0==false || line1==false){
                            line0 = false, line1 = false;
                            item.lineInclude[0].map(function(lineID){
                                if(lineID==cfg.line[1]) line0 = true;
                            });
                            item.lineInclude[1].map(function(lineID){
                                if(lineID==cfg.line[0]) line1 = true;
                            });
                        }
                        return (line0 && line1);
                    }else{
                        return true;
                    }
                });
            }
            
            return rs;
        },
        getRoute_filterSameRoute: function(a,b,routeM,aLine,bLine){
            var aComp = TT.fn.getCompanyOfStation(a),
                bComp = TT.fn.getCompanyOfStation(b),
                aObj = TT.fn.getCommon_stationDataOfID(a),
                bObj = TT.fn.getCommon_stationDataOfID(b);
            var route = routeM.route;
            aLine = (aLine) ? aLine : TT.fn.getCommon_stationOnWhatLine(a)[0];
            bLine = (bLine) ? bLine : TT.fn.getCommon_stationOnWhatLine(b)[0];
            var aLineData = TT.fn.getCommon_lineData(aLine);
            var bLineData = TT.fn.getCommon_lineData(bLine);
            
            if(aComp=='tra' && bComp=='tra'){
                var aArea = aLineData.area, bArea=bLineData.area;
                if(aObj.sect=='taipei' || aObj.sect=='keelung') aArea = 'ew';
                if(bObj.sect=='taipei' || bObj.sect=='keelung') bArea = 'ew';
                var dir = TT.fn.getTRA_LineDirByFromTo(a,b);
                if(aObj.big && bObj.big && TT.fn.check_TRA_hasSameBigWord(aObj.big,bObj.big)){
                    route.length = 0;
                }else{
                    var protectTransStation = new Array();
                    if(aLineData.protectStation && aLineData.protectStation.length>0){
                        aLineData.protectStation.map(function(st){
                            if(!aLineData.protectStationSect || !aLineData.protectStationSect[st] || aLineData.protectStationSect[st].indexOf(bObj.sect)!=-1){
                                protectTransStation.push(st);
                            }
                        });
                    }
                    if(bLineData.protectStation && bLineData.protectStation.length>0){
                        bLineData.protectStation.map(function(st){
                            if(!bLineData.protectStationSect || !bLineData.protectStationSect[st] || bLineData.protectStationSect[st].indexOf(aObj.sect)!=-1){
                                protectTransStation.push(st);
                            }
                        });
                    }
                    var rs = TT.fn.getRoute_systemOfTrans({
                        line: [aLine, bLine],
                        station: [a,b],
                        company: aComp
                    });
                    if(rs[0]){
                        var rst = rs[0], transStAry = new Array();
                        rst.rule.map(function(ru){
                            var regexA = {}, retA = false, retB = false;
                                regexA.line = (ru.line) ? new RegExp(ru.line.join('|')) : /gdfhghdfhf/;
                                regexA.sect = (ru.sect) ? new RegExp(ru.sect.join('|')) : /gdfhghdfhf/;
                                regexA.station = (ru.station) ? new RegExp(ru.station.join('|')) : /gdfhghdfhf/;
                        
                        	if(regexA.line.test(aLine) || regexA.sect.test(aObj.sect) || regexA.station.test(aObj.id)) retA = true;
                        	if(regexA.line.test(bLine) || regexA.sect.test(bObj.sect) || regexA.station.test(bObj.id)) retB = true;
                        	if(retA && retB){
                            	protectTransStation.push(TT.fn.getRoute_transStationById(ru.transStation).changeStation[0]);
                        	}
                        });
                    }
                    
                    //Use protectTransStation to filter no-in station
                    //console.info(protectTransStation);
                    if(protectTransStation.length > 0){
                        var regPTS = new RegExp(protectTransStation.join('|'));
                        var tsFlag;
                        var newRoute = new Array();
                        route.map(function(rr){
                            tsFlag = true;
                            rr.transStation.map(function(rst){
                                if(!regPTS.test(TT.fn.getCommon_transStationByID(rst).changeStation[0])){
                                    tsFlag = false;
                                }
                            });
                            if(tsFlag) newRoute.push(rr);
                        });
                        route = newRoute;
                        routeM.route = newRoute;
                    }else{
                        routeM.route.length = 0;
                        TT.fn.dLog('getRoute_filterSameRoute: filter all trans station.');
                    }
                }
            }
            
            return routeM;
        },
        getRoute_mapOfFromToLine: function(a,b,aStation,bStation){
            var routeMap = $.extend(true,[],TT.data.routeMap);//TT.data.routeMap;
            var aObj = TT.fn.getCommon_stationDataOfID(aStation);
            var bObj = TT.fn.getCommon_stationDataOfID(bStation);
            var testObj;
            for(var i=0; i<routeMap.length; i++){
                if(routeMap[i].fromToLineReg){
                    testObj = new Array();
                    routeMap[i].fromToLineReg.map(function(tm){
                        testObj.push(new RegExp(tm));
                    });
                }else{
                    testObj = routeMap[i].fromToLine;
                }
            	if(TT.fn.checkEquaArrayStartEnd([a,b], testObj) && TT.fn.checkEquaSectStartEnd(aObj.sect,bObj.sect,routeMap[i].sect)){
                    var tmpA = TT.fn.getRoute_directionByFromToLine(a,b,routeMap[i]);
                    tmpA = TT.fn.giveRoute_mapTool(tmpA);
                    return tmpA;
                }
            }
            return false;
        },
        getRoute_mapSystemOfFromToLine: function(aLine, bLine, a, b, everAddList){
            var routeSystem = $.extend([],TT.data.routeSystem),
                aComp = TT.fn.getCompanyOfLine(aLine),
                bComp = TT.fn.getCompanyOfLine(bLine);
            var regexA, regexB, lineS;
            var displayPri = TT.defined.displayPri;
            var rt = new Array();;
            
            if(aComp==bComp){
                routeSystem.map(function(rs){
                    regexA = new RegExp(aLine);
                    regexB = new RegExp(bLine);
                    if(regexA.test(rs.lineStr) && regexB.test(rs.lineStr)){
                        if(rs.rType=='direct'){
                            var strA = '';
                            for(var i=0; i<displayPri[aComp].length; i++){
                                lineS = displayPri[aComp][i];
                                if(aLine==lineS || bLine==lineS){
                                    strA = lineS;
                                    break;
                                }
                            };
                            rt = {
                                fromToLine: [aLine, bLine],
                                displayLine: strA,
                                isDirect: true
                            }
                        }
                    }
                });
            }else{
                routeSystem.map(function(rs){
                    if(rs.rType=='cross'){
                        var rsRegLine = new RegExp(rs.regLine), objARegLine;
                    	if(rsRegLine.test(aLine) && rsRegLine.test(bLine)){
                            var aObj, bObj, tmpRoute = {}, rtAry = new Array();
                            var aryCompany = $.extend([],rs.company), aryTS;
                            if(bComp==rs.company[0]) aryCompany = aryCompany.reverse();
                            rs.link.map(function(objA){
                                objARegLine = new RegExp(objA.regLine);
                            	if(objARegLine.test(aLine) && objARegLine.test(bLine)){
                            		aryTS = $.extend([],objA.transStation);
                            		if(bComp==rs.company[0]) aryTS = aryTS.reverse();
                            	}
                            });
                            
                            var aryFullRoute = new Array(),
                                aryFullTakeRange = new Array(),
                                aryFullTS = new Array();
                            aryTS.map(function(tsAry,idx){
                            	var aCmbTS = new Array(), bCmbTS = new Array();
                                aryFullTakeRange[idx] = new Array();
                                aryFullTS[idx] = new Array();
                            	if(idx==0){
                            		tsAry.map(function(ts,tidx){
                            			ts = TT.fn.getRoute_transStationById(ts);
                            			if(TT.fn.getCompanyOfStation(ts.changeStation[0])==aComp){
                                            aryFullTakeRange[idx].push([a,ts.changeStation[0]]);
                            			}else{
                                            aryFullTakeRange[idx].push([a,ts.changeStation[1]]);
                            			}
                                        aCmbTS.push(ts);
                                        aryFullTS[idx].push(ts);
                            		});
                            	}
                                
                                if(idx>0){
                                    tsAry.map(function(ts,tidx){
                            			ts = TT.fn.getRoute_transStationById(ts);
                            			if(TT.fn.getCompanyOfStation(ts.changeStation[0])==TT.fn.getCompanyOfStation(aryFullTakeRange[idx-1][1])){
                                            aryFullTakeRange[idx].push([ts.changeStation[0],ts.changeStation[1]]);
                            			}else{
                                            aryFullTakeRange[idx].push([ts.changeStation[1],ts.changeStation[0]]);
                            			}
                                        aryFullTS[idx].push(ts);
                            		});
                                }
                                
                                if(idx==aryTS.length-1){
                                    aryFullTakeRange[idx+1] = new Array();
                            		tsAry.map(function(ts,tidx){
                            			ts = TT.fn.getRoute_transStationById(ts);
                            			if(TT.fn.getCompanyOfStation(ts.changeStation[0])==bComp){
                                            aryFullTakeRange[idx+1].push([ts.changeStation[0],b]);
                            			}else{
                                            aryFullTakeRange[idx+1].push([ts.changeStation[1],b]);
                            			}
                                        bCmbTS.push(ts);
                                        //aryFullTS[idx].push(ts);
                            		});
                            	}
                            });
                            
                                            //console.info(aryFullTakeRange);console.info(aryFullTS);
                            var ttkrg, ttTS, ttRot;
                            for(var te=0; te<aryFullTakeRange.length; te++){
                                aryFullRoute[te] = new Array();
                                ttkrg = aryFullTakeRange[te];
                                for(var i=0; i<ttkrg.length; i++){
                                    aryFullRoute[te][i] = TT.fn.getCommon_theTransRouteByFromTo(ttkrg[i][0], ttkrg[i][1]);
                                    if(te < aryFullTakeRange.length-1){
                                        ttTS = aryFullTS[te][i];
                                        ttRot = aryFullRoute[te][i];
                                        ttRot.map(function(dmf){
                                            dmf[dmf.length-1].transStation = ttTS;
                                            dmf[dmf.length-1].transStationID = ttTS.id;
                                        });
                                    }
                                }
                            }
                            
                            //combine all map
                            //console.info($.extend([],aryFullRoute));
                            var aryTotalRoute = new Array();
                            if(aryFullTS.length==1){ //Just a combine b
                                var tmpAryT1Route = new Array(), tmpSAryT1Route = new Array(), aryR1 = new Array(), tmpC, tmpCRTS, includeFlag;
                                aryFullRoute[0].map(function(t1,t1idx){
                                    var tsObj = aryFullTS[0][t1idx];
                                    tmpSAryT1Route[t1idx] = new Array();
                                    t1.map(function(t2,t2idx){
                                        includeFlag = false;
                                        if(t2[t2.length-1].line != tsObj.changeLine[0] && t2[t2.length-1].line != tsObj.changeLine[1]){
                                            //console.log(t2[t2.length-1].line + ',' + tsObj.changeLine[0] + ',' + tsObj.changeLine[1]);
                                            if(rs.lineIsSame){
                                                if(rs.lineIsSame[tsObj.changeLine[0]] && new RegExp(rs.lineIsSame[tsObj.changeLine[0]]).test(t2[t2.length-1].line)) includeFlag = true;
                                                if(rs.lineIsSame[tsObj.changeLine[1]] && new RegExp(rs.lineIsSame[tsObj.changeLine[1]]).test(t2[t2.length-1].line)) includeFlag = true;
                                            }
                                        }else{
                                            includeFlag = true;
                                        }
                                        
                                        if(includeFlag){
                                            tmpAryT1Route.push(t2);
                                            tmpSAryT1Route[t1idx].push(t2);
                                        }
                                    });
                                });
                                aryFullRoute[1].map(function(t1,t1idx){
                                    aryR1[t1idx] = $.extend([],tmpSAryT1Route[t1idx]);
                                    t1.map(function(t2, t2idx){
                                        aryR1[t1idx].map(function(tr1,trIdx){
                                            tmpC = $.extend([],aryR1[t1idx][trIdx]);
                                            tmpCRTS = tmpC[tmpC.length-1].transStation;
                                            for(var i=0; i<t2.length; i++){
                                                if(i==0 && tmpCRTS && tmpCRTS.changeLine[0]!=t2[i].line && tmpCRTS.changeLine[1]!=t2[i].line){
                                                    includeFlag = false;
                                                    if(rs.lineIsSame){
                                                        if(rs.lineIsSame[tmpCRTS.changeLine[0]] && new RegExp(rs.lineIsSame[tmpCRTS.changeLine[0]]).test(t2[i].line)) includeFlag = true;
                                                        if(rs.lineIsSame[tmpCRTS.changeLine[1]] && new RegExp(rs.lineIsSame[tmpCRTS.changeLine[1]]).test(t2[i].line)) includeFlag = true;
                                                    }
                                                    if(!includeFlag) return false;
                                                }
                                                tmpC.push(t2[i]);
                                            }
                                            aryTotalRoute.push(tmpC);
                                        });
                                    });
                                });
                                //console.info(aryTotalRoute);
                            }
                            //console.info(aryTotalRoute);
                            
                            //Trans combine map to route
                            tmpRoute = (function(){
                                var rtA = new Array();
                                aryTotalRoute.map(function(ro){
                                    var s_ln = new Array(), s_tkRg = new Array(), s_ts = new Array();
                                    for(var i=0; i<ro.length; i++){
                                        s_ln.push(ro[i].line);
                                        s_tkRg.push(ro[i].takeRange);
                                        if(ro[i].transStationID) s_ts.push(ro[i].transStationID);
                                    }
                                    var writeFlag = writeEverAddList(s_ln , s_ts);
                                    if(writeFlag){
                                        rtA.push({
                                            line: s_ln,
                                            takeRange: s_tkRg,
                                            transStation: s_ts
                                        });
                                    }
                                });
                                return rtA;
                            })();
                            
                            rt = {
                                fromToLine: [aLine, bLine],
                                id: aLine + ',' + bLine,
                                isRoute: true,
                                route: tmpRoute,
                                sect: rs.sect
                            };
                            
                            rt = TT.fn.giveRoute_mapTool(rt);
                        }
                    }
                });
            }
            
            function writeEverAddList(s_ln , s_ts){
                if(!everAddList) return true;
                var ws = a + ',' + b, rs = '';
                rs = ws + ':' + s_ln.join() + s_ts.join();
                for(var i=0; i<everAddList.length; i++){
                    if(rs==everAddList[i]) return false;
                }
                everAddList.push(rs);
                return true;
            }
            
            return rt;
        },
        getRoute_needRouteByFromTo: function(a,b){
            var aComp = TT.fn.getCompanyOfStation(a);
            var bComp = TT.fn.getCompanyOfStation(b);
            
            if(aComp==bComp){
                switch(aComp){
                    case 'tra':
                        var ary = TT.fn.getTRA_stationOnSameLine(a,b), lineData;
                        if(ary){
                            return false;
                        }else{
                            return true;
                        }
                    break;
                    case 'trtc':
                        var ary = TT.fn.getTRTC_stationOnSameLine(a,b), lineData;
                        if(TT.fn.getTRTC_stationOnSameLine(a,b)){
                            for(var i=0; i<ary.length; i++){
                                lineData = TT.fn.getTRTC_lineData(ary[i]);
                                if(lineData.splitStation && lineData.splitStation.length>0){
                                    if(TT.fn.getTRTC_stationOnDiffSplitOutArea(a,b,lineData.id)) return true;
                                }
                            }
                            return false;
                        }else{
                            return true;
                        }
                    break;
                }
            }else{
                return true;
            }
        },
        getRoute_systemById: function(id){
            var d = TT.data.routeSystem;
            for(var i=0; i<d.length; i++){
                if(d[i].id==id) return d[i];
            }
            return false;
        },
        getRoute_transStationById: function(id){
            var d = TT.data.transStation;
            for(var i=0; i<d.length; i++){
                if(d[i].id==id) return d[i];
            }
            return false;
        },
        giveRoute_transStationOtherData: function(t, aLine, bLine){
            var tmp = $.extend({},TT.fn.getCommon_transStationByID(t));
                    tmp.fromLine = aLine;
                    tmp.fromCompany = TT.fn.getCompanyOfLine(tmp.fromLine);
                    tmp.toLine = bLine;
                    tmp.toCompany = TT.fn.getCompanyOfLine(tmp.toLine);
                    if(tmp.fromLine!=tmp.changeLine[0] && tmp.toLine!=tmp.changeLine[1]){
                        TT.fn.dLog('giveRoute_transStationOtherData: aLine and bLine are different of route');
                        tmp.changeLine.reverse();
                        tmp.changeStation.reverse();
                    }
            return tmp;
        },
        giveRoute_mapTool: function(t){
            t.isRoute = true;
            
            t.getRouteAt = function(ro){
                if(!ro) ro=0;
                var route = t.route[ro], tmp;
                var rAry = new Array();
                for(var i=0; i<route.transStation.length; i++){
                    if(!route.transStation[i]){
                        route.transStation[i] = TT.fn.getRoute_mainTransStationByFromToLine(route.line[i], route.line[i+1]);
                        TT.fn.dLog('giveRoute_mapTool: original data without transStation data');
                    }
                    //tmp = TT.fn.getCommon_transStationByID(route.transStation[i]);
                    //tmp.fromLine = route.line[i];
                    //tmp.fromCompany = TT.fn.getCompanyOfLine(tmp.fromLine);
                    //tmp.toLine = route.line[i+1];
                    //tmp.toCompany = TT.fn.getCompanyOfLine(tmp.toLine);
                    //if(tmp.fromLine==tmp.changeLine[1]){
                        //tmp.changeLine.reverse();
                        //tmp.changeStation.reverse();
                    //}
                    tmp = TT.fn.giveRoute_transStationOtherData(route.transStation[i], route.line[i], route.line[i+1]);
                    rAry.push(tmp);
                }
                return rAry;
            }
            return t;
        },
        //TRA Function
        getTRA_allTimeByFromTo: function(a,b,timeTable){
            var dir = TT.fn.getTRA_LineDirByFromTo(a,b);
            if(!timeTable){
                timeTable = TT.fn.getTRA_dayTimeTable();
            }else if(typeof(timeTable)=='string'){
                timeTable = TT.fn.getTRA_dayTimeTable(timeTable);
            }
            
            var aryTime = new Array();
            for(var i=0; i<timeTable.length; i++){
                var timeInfo = timeTable[i].TimeInfo;
                var aST = TT.fn.getTRA_stationIsOnThisTime(a, timeInfo);
                var bST = TT.fn.getTRA_stationIsOnThisTime(b, timeInfo);
                var pTimeTable;
                if(aST!==false && bST!==false && timeTable[i].LineDir==dir){
                    if(aST > bST) continue;
                    pTimeTable = $.extend({},timeTable[i]);
                    pTimeTable = TT.fn.giveTRA_timeTableTool(pTimeTable);
                    pTimeTable.fromStation = a;
                    pTimeTable.toStation = b;
                    aryTime.push(pTimeTable);
                }
            }
            return aryTime;
        },
        getTRA_infoOfCar: function(car, timeTable){
            if(!timeTable){
                timeTable = TT.fn.getTRA_dayTimeTable();
            }else if(typeof(timeInfo)=='string'){
                timeTable = TT.fn.getTRA_dayTimeTable(timeTable);
            }
            
            for(var i=0; i<timeTable.length; i++){
                if(timeTable[i].Train==car){
                    return timeTable[i];
                }
            }
            return false;
        },
        getTRA_mayUseBoneTrans: function(a, b, aLine, bLine, routeM){
        	//{line: ['1','2','3'], transStation: ['t1','t2']}
        	var route = routeM.route, tmpR, aTS, bTS, asIndex, bsIndex,
        		rt = new Array(),
        		sectAry = TT.data.tra.sect_ary,
        		dir = TT.fn.getTRA_LineDirByFromTo(a,b),
        		aNear = TT.fn.getTRA_nearBigStation(a, aLine),
        		bNear = TT.fn.getTRA_nearBigStation(b, bLine),
                aObj = TT.fn.getCommon_stationDataOfID(a),
                bObj = TT.fn.getCommon_stationDataOfID(b);
        	
            function getNearBig(st, stObj, nearAry){
                    if(nearAry.length>1){
                        if(dir==TT.fn.getTRA_LineDirByFromTo(a,b) && st==b) nearAry.reverse();
                        var anst = (dir=='1') ? nearAry[0] : nearAry[1];
                    }
                    if(st=='tra_1032' || st=='tra_1013' || st=='tra_1014') anst = 'tra_1011';
        			if(!anst) anst = nearAry[0];
                    return anst;
            }
            
        	route.map(function(ro){
        		rt.push(ro);
        		aTS = TT.fn.getCommon_stationDataOfID(TT.fn.getCommon_transStationByID(ro.transStation[0]).changeStation[0]);
        		bTS = TT.fn.getCommon_stationDataOfID(TT.fn.getCommon_transStationByID(ro.transStation[ro.transStation.length-1]).changeStation[0]);
        		asIndex = TT.fn.getTRA_sectAB(aObj,aTS);
        		bsIndex = TT.fn.getTRA_sectAB(bObj,bTS);
        		var lineAry = new Array(), tAry = new Array();
        		ro.line.map(function(tl){lineAry.push(tl);});
        		ro.transStation.map(function(tl){tAry.push(tl);});
        		var pushFlag = false;
        		if(asIndex>1 && a!=aNear[0]){
        			var pushFlag = true;
        			lineAry.splice(0,0,aLine);
                    var anst = getNearBig(a, aObj, aNear);
        			tAry.splice(0,0,TT.fn.getCommon_transStationBySameChangeStation(anst).id);
        		}
        		if(bsIndex>1 && b!=bNear[0]){
        			var pushFlag = true;
        			lineAry.push(bLine);
                    var bnst = getNearBig(b, bObj, bNear);
        			tAry.push(TT.fn.getCommon_transStationBySameChangeStation(bnst).id);
        		}
        		if(pushFlag) rt.push({line:lineAry, transStation: tAry});
        	});
            
            if(route.length==0 && (!aObj.big || !bObj.big) && (TT.fn.getTRA_sectAB(aObj, bObj)>1)){
                if(!aObj.big){
                    var anst = getNearBig(a, aObj, aNear);
                    rt.push({line:[aLine,bLine], transStation: [TT.fn.getCommon_transStationBySameChangeStation(anst).id]});
                }else if(!bObj.big){
                    var bnst = getNearBig(b, bObj, bNear);
                    rt.push({line:[aLine,bLine], transStation: [TT.fn.getCommon_transStationBySameChangeStation(bnst).id]});
                }
            }
            if(rt.length==0){
                rt.push({line:[aLine,bLine], transStation: []});
            }
            //filter same route of bone
            var boneMisAry = new Array(), tmpString;
            for(var i=0; i<rt.length; i++){
                tmpString = rt[i].line.join() + rt[i].transStation.join();
                for(var j=0; j<boneMisAry.length; j++){
                    if(tmpString==boneMisAry[j]){
                        tmpString = 'xxxx';
                        break;
                    }
                }
                if(tmpString=='xxxx'){
                    rt.splice(i,1);
                    i--;
                }else{
                    boneMisAry.push(tmpString);
                }
            }
			routeM.route = rt;
        	return routeM;
        },
        getTRA_nearBigStation: function(st, line, area){
            var stObj = TT.fn.getCommon_stationDataOfID(st);
            var lineData = TT.fn.getCommon_lineData(line);
            if(area && TT.fn.check_TRA_hasSameBigWord(stObj.big,area)) return [st];
            if(!area && stObj.big) return [st];
            
            var tmpST, rt = new Array(), ast, bst, cflag=false;
            if(lineData.dir=='0'){var stationAry = lineData.station}else{
                var stationAry = new Array();
                lineData.station.map(function(ggh){stationAry.push(ggh);});
                stationAry.reverse();
            }
            for(var i=0; i<stationAry.length; i++){
                if(stationAry[i]==st) cflag = true;
                tmpST = TT.fn.getCommon_stationDataOfID(stationAry[i]);
                if(area){
                    if(TT.fn.check_TRA_hasSameBigWord(tmpST.big,area)){
                        if(!cflag){
                            ast = stationAry[i];
                        }else{
                            bst = stationAry[i];
                            break;
                        }
                    }
                }else{
                    if(tmpST.big){
                        if(!cflag){
                            ast = stationAry[i];
                        }else{
                            bst = stationAry[i];
                            break;
                        }
                    }
                }
            }
            if(ast) rt.push(ast);
            if(bst) rt.push(bst);
            return rt;
        },
        getTRA_sectIndex: function(st){
        	if(typeof(st)=='string') st = TT.fn.getCommon_stationDataOfID(st);
        	var sectAry = TT.data.tra.sect_ary;
        	for(var i=0; i<sectAry.length; i++){
        		if(st.sect==sectAry[i]) return i;
        	}
        },
        getTRA_sectAB: function(a,b){
        	var ai = TT.fn.getTRA_sectIndex(a);
        	var bi = TT.fn.getTRA_sectIndex(b);
        	return Math.abs(ai-bi);
        },
        getTRA_timeOfStationOnCar: function(stationID, carTime){
            stationID = TT.fn.getTRA_stationID(stationID);
            if(carTime.TimeInfo){
                for(var i=0; i<carTime.TimeInfo.length; i++){
                    if(carTime.TimeInfo[i].Station==stationID){
                        var rt = carTime.TimeInfo[i];
                        rt.carInfo = carTime;
                        return rt;
                    }
                }
            }
            return false;
        },
        getTRA_timeRangeByFromTo: function(a,b,startTime,endTime,flagAD,timeTable){
            if(!startTime) startTime = 0;
            if(!endTime) endTime = 60*60*24-1;
            timeTable = TT.fn.getTRA_allTimeByFromTo(a,b,timeTable);
            if(flagAD===undefined) flagAD = true;//true 為出發，false 為到達
            if(typeof(startTime)!='number') startTime = TT.fn.transTime2Sec(startTime);
            if(typeof(endTime)!='number') endTime = TT.fn.transTime2Sec(endTime);
            var crossDaySec = TT.fn.transTime2Sec(TT.defined.defaultCrossDayTime),
                offset1Day = 86400;
            
            function cpTime(ttb){
                var insEnd = endTime;
                var time, dept, arrt;
                if(flagAD){
                    var stationTime = TT.fn.getTRA_timeOfStationOnCar(a,ttb);
                    if(stationTime){
                        dept = stationTime.DEPTime || stationTime.DepTime;
                        time = TT.fn.transTime2Sec(dept);
                    }
                }else{
                    var stationTime = TT.fn.getTRA_timeOfStationOnCar(b,ttb);
                    arrt = stationTime.ARRTime || stationTime.ArrTime;
                    if(stationTime){
                        time = TT.fn.transTime2Sec(arrt);
                    }
                }
                
                if(insEnd < startTime && insEnd < crossDaySec){
                    insEnd = insEnd + offset1Day;
                    if(time < crossDaySec){
                        time = time + offset1Day;
                    }
                }
                
                if(time && time >= startTime && time <= insEnd){
                    ttb.tt_sortTime = time;
                    return ttb;
                }else{
                    return false;
                }
            }
            
            var aryTime = new Array(),
                cpT;
            for(var i=0; i<timeTable.length; i++){
                cpT = cpTime(timeTable[i]);
                if(cpT !== false){
                    aryTime.push(cpT);
                }
            }
            aryTime = aryTime.sort(TT.fn.getTRA_sortByTTSortTime);
            return aryTime;
        },
        getTRA_dayTimeTable: function(w){
            if(w==null) w = TT.defined.defaultTRAWeekday;
            if(!TT.fn.checkTRA_dayTimeIsLoaded(w)){
                return false;
            }
            
            return TT.data.tra.timeTable[parseInt(w,10)];
        },
        getTRA_LineDirReverseNum: function(dir){
            if(dir=='1') return '0';
            if(dir=='0') return '1';
        },
        getTRA_LineDirByFromTo: function(a,b){
            if(TT.fn.getTRA_stationOnSameLine(a,b)){
                for(var i=0; i<TT.data.tra.line.length; i++){
                    var Line = TT.data.tra.line[i];
                    var aIndex = TT.fn.getTRA_stationIsOnThisLine(a, Line);
                    var bIndex = TT.fn.getTRA_stationIsOnThisLine(b, Line);
                    if(aIndex!==false && bIndex!==false){
                        if(aIndex < bIndex){
                            return Line.dir;
                        }else{
                            return TT.fn.getTRA_LineDirReverseNum(Line.dir);
                        }
                    }
                }
            }else{
                var tmsb = TT.fn.getTRA_stationOnWhatLine(b)[0];
                var tmsa = TT.fn.getTRA_stationOnWhatLine(a)[0];
                var objA = TT.fn.getCommon_lineData(tmsa);
                var rtDir;
                
                if(!objA.link[tmsb]){
                    var rs = TT.data.routeSystem;
                    rs.map(function(kdd){
                        if(kdd.id=='tra_route_line_map'){
                            kdd.link.map(function(tr){
                                if(tr.indexOf(tmsa)!=-1 && tr.indexOf(tmsb)!=-1){
                                    if(tr.indexOf(tmsa)<tr.indexOf(tmsb)){
                                        rtDir = kdd.dir;
                                    }else{
                                        rtDir = TT.fn.reverseDir(kdd.dir);
                                    }
                                }
                            });
                        }
                    });
                    return rtDir;
                }else{
                    return objA.link[tmsb].dir;
                }
            }
        },
        getTRA_LineRouteReverse: function(Line){
            var ary;
            ary = Line.station;
            Line.dir = TT.fn.getTRA_LineDirReverseNum(Line.dir);
            Line.station = ary;
            return Line;
        },
        getTRA_stationDataOfID: function(id, lineID){
            var ary=TT.data.tra.station_ary;
            for(var i=0; i<ary.length; i++){
                if(ary[i].id==id){
                    if(lineID){
                        return $.extend({byLine: lineID}, ary[i]);
                    }
                    return ary[i];
                }
            }
            return false;
        },
        getTRA_stationIsOnThisLine: function(stationID, Line){
            for(var i=0; i<Line.station.length; i++){
                if(stationID==Line.station[i]) return i;
            }
            return false;
        },
        getTRA_stationIsOnThisTime: function(stationID, timeInfo){
            stationID = TT.fn.getTRA_stationID(stationID);
            for(var i=0; i<timeInfo.length; i++){
                if(stationID==timeInfo[i].Station) return i;
            }
            return false;
        },
        getTRA_stationID: function(sid){
            if(sid.indexOf('tra_')==0){
                sid = sid.replace('tra_','');
            }
            return sid;
        },
        getTRA_stationIsOnTimeInfo: function(stationID, timeInfo){
            stationID = TT.fn.getTRA_stationID(stationID);
            for(var i=0; i<timeInfo.length; i++){
                if(timeInfo[i].Station==stationID){
                    return timeInfo[i];
                    break;
                }
            }
            return false;
        },
        getTRA_stationOnSameLine: function(a,b){
            var rt = new Array();
            var aLine = TT.fn.getTRA_stationOnWhatLine(a);
            var bLine = TT.fn.getTRA_stationOnWhatLine(b);
            for(var i=0; i<aLine.length; i++){
                for(var j=0; j<bLine.length; j++){
                    if(bLine[j]==aLine[i]){
                        rt.push(bLine[j]);
                        break;
                    }
                }
            }
            
            if(rt.length==0) rt = false;
            return rt;
        },
        getTRA_stationOnWhatLine: function(st){
            //return ['tra_xibu'];
            var rt = new Array(),
                line = TT.data.tra.line;
            for(var i=0; i<line.length; i++){
                for(var j=0; j<line[i].station.length; j++){
                    if(line[i].station[j]==st){
                        rt.push(line[i].id);
                        break;
                    }
                }
            }
            return rt;
        },
        getTRA_stationTime: function(stationID, dir, w){
            if(w==null) w = TT.defined.defaultTRAWeekday;
            if(dir==null) dir = '1';
            if(!TT.fn.checkTRA_dayTimeIsLoaded(w)){
                return false;
            }
            
            stationID = TT.fn.getTRA_stationID(stationID);
            var dayTimeTable = TT.fn.getTRA_dayTimeTable(w);
            var stationDayTimeAry = new Array();
            for(var i=0; i<dayTimeTable.length; i++){
                var timeInfoOfStation = TT.fn.getTRA_stationIsOnTimeInfo(stationID, dayTimeTable[i].TimeInfo);
                if(timeInfoOfStation && dayTimeTable[i].LineDir==dir){
                    timeInfoOfStation.CarInfo = dayTimeTable[i];
                    stationDayTimeAry.push(timeInfoOfStation);
                }
            }
            return stationDayTimeAry;
        },
        getTRA_sortByTimeInfoOrder: function(a,b){
            var intA = parseInt(a.Order,10);
            var intB = parseInt(b.Order,10);
            if(intA==intB) return 0;
            if(intA < intB) return -1;
            if(intA > intB) return 1;
        },
        getTRA_sortByTTSortTime: function(a,b){
            var intA = parseInt(a.tt_sortTime,10);
            var intB = parseInt(b.tt_sortTime,10);
            if(intA==intB) return 0;
            if(intA < intB) return -1;
            if(intA > intB) return 1;
        },
        getTRA_JSON_by_TRA_JSON: function(json){
            var rt = json.TrainInfos;
            var timeInfo = false;
            for(var i=0; i<rt.length; i++){
                rt[i].TimeInfo = rt[i].TimeInfos;
                rt[i].TimeInfo.sort(TT.fn.getTRA_sortByTimeInfoOrder);
            }
            return rt;
        },
        getTRA_JSON: function(url, successFn, errorFn){
            $.ajax({
                url: url,
                type: 'GET',
                dataType: 'json',
                success: function(xml) {
                    if(typeof(successFn)=='function'){
                        successFn(xml);
                    }
                },
                error: function(){
                    if(typeof(errorFn)=='function'){
                        errorFn();
                    }
                }
            });
        },
        getTRA_weekJSON: function(w, cbFn){
            if(!w) w = TT.defined.defaultTRAWeekday;
            var url = 'w' + w + '.json';
            TT.ui.mask();
            TT.ui.printStatus('讀取台鐵' + TT.ui.transWeekToString(w) + ' JSON 時刻表中...');
            
            function successFn(json){
                    TT.ui.printStatus('讀取台鐵' + TT.ui.transWeekToString(w) + ' JSON 時刻表完成。');
                    TT.ui.unmask();
                    TT.a1 = json;
                    if(TT.fn.checkIsFunction(cbFn)){
                        cbFn(w, json);
                    }
                    TT.ui.updateCenter('home');
            }
            
            function errorFn(){
                    TT.msg.show('讀取台鐵' + TT.ui.transWeekToString(w) + ' JSON 時刻表失敗！');
                    TT.ui.printStatus('讀取台鐵' + TT.ui.transWeekToString(w) + ' JSON 時刻表失敗！');
                    TT.ui.unmask();
                    TT.ui.updateCenter('home');
                    if(TT.fn.checkIsFunction(cbFn)){
                        cbFn('error');
                    }
            }
            setTimeout(function(){
                TT.fn.getTRA_JSON(url, successFn, errorFn);
            },100);
        },
        getTRA_JSON_by_TRA_XML: function(xml){
            var aryTRA_Cars = xml.getElementsByTagName('TrainInfo');
            var rt = new Array();
            
            for(var i=0; i<aryTRA_Cars.length; i++){
                var xt = aryTRA_Cars[i];
                var jo = TT.fn.getXML_Attribute2Obj(xt);
                jo.TimeInfo = new Array();
                var timeInfo = xt.getElementsByTagName('TimeInfo');
                for(var j=0; j<timeInfo.length; j++){
                    var timext = timeInfo[j];
                    var timejo = TT.fn.getXML_Attribute2Obj(timext);
                    jo.TimeInfo.push(timejo);
                    jo.TimeInfo.sort(TT.fn.getTRA_sortByTimeInfoOrder);
                }
                rt.push(jo);
            }
            return rt;
        },
        getTRA_XML: function(url, successFn, errorFn){
            $.ajax({
                url: url,
                type: 'GET',
                dataType: 'xml',
                success: function(xml) {
                    if(typeof(successFn)=='function'){
                        successFn(xml);
                    }
                },
                error: function(){
                    if(typeof(errorFn)=='function'){
                        errorFn();
                    }
                }
            });
        },
        getTRA_weekXML: function(w, cbFn){
            if(!w) w = TT.defined.defaultTRAWeekday;
            var url = 'w' + w + '.xml';
            TT.ui.mask();
            TT.ui.printStatus('讀取台鐵' + TT.ui.transWeekToString(w) + '時刻表中...');
            
            function successFn(xml){
                    TT.ui.printStatus('讀取台鐵' + TT.ui.transWeekToString(w) + '時刻表完成。');
                    TT.ui.unmask();
                    if(TT.fn.checkIsFunction(cbFn)){
                        cbFn(w, xml);
                    }
                    TT.ui.updateCenter('home');
            }
            
            function errorFn(){
                    TT.msg.show('讀取台鐵' + TT.ui.transWeekToString(w) + '時刻表失敗！');
                    TT.ui.printStatus('讀取台鐵' + TT.ui.transWeekToString(w) + '時刻表失敗！');
                    TT.ui.unmask();
                    TT.ui.updateCenter('home');
                    if(TT.fn.checkIsFunction(cbFn)){
                        cbFn('error');
                    }
            }
            setTimeout(function(){
                TT.fn.getTRA_XML(url, successFn, errorFn);
            },100);
        },
        getTRA_TimeTable2Data: function(weekString, cbFn){
            if(weekString==null) weekString = '0123456';//0 for sunday
            if(!TT.data.tra.timeTable) TT.data.tra.timeTable = new Array();
            var countW = -1;
            function writeFn(w, xml){
                if(TT.fn.checkIsError(w)){
                    return false;
                }
                //var dayJo = TT.fn.getTRA_JSON_by_TRA_XML(xml);
                var dayJo = TT.fn.getTRA_JSON_by_TRA_JSON(xml);
                TT.data.tra.timeTable[parseInt(w,10)] = dayJo;
                nextDay();
            }
            
            function nextDay(){
                countW++;
                if(countW >= 7){
                    if(TT.fn.checkIsFunction(cbFn)){
                        cbFn();
                    }
                    return true;
                }
                var w = countW.toString();
                if(TT.data.tra.timeTable[countW] || weekString.indexOf(w)==-1){
                    nextDay();
                    return false;
                }
                //TT.fn.getTRA_weekXML(w, writeFn);
                TT.fn.getTRA_weekJSON(w, writeFn);
            }
            nextDay();
        },
        getTRA_carClassName: function(val, cfg){
            cfg = cfg || {};
            var data = TT.data.tra.defined["CarClass"], rt = '';
            for(var i=0; i<data.length; i++){
                if(data[i].id==val){
                    if(cfg.eng){
                        rt = data[i].ename;
                    }else{
                        rt = data[i].name;
                    }
                    if(cfg.color){
                        if(data[i].color){
                            rt = '<span style="color:' + data[i].color + ';">' + rt + '</span>';
                        }
                    }
                    return rt;
                }
            }
        },
        giveTRA_tool_getFromToTime: function(a,b,ttb){
                if(!a) a = ttb.fromStation;
                if(!b) b = ttb.toStation;
                a = TT.fn.getTRA_stationID(a);
                b = TT.fn.getTRA_stationID(b);
                var timeInfo = ttb.TimeInfo;
                var rt = new Array();
                var arrt = false, dept = false;
                for(var i=0; i<timeInfo.length; i++){
                    arrt = timeInfo[i].ARRTime || timeInfo[i].ArrTime;
                    dept = timeInfo[i].DEPTime || timeInfo[i].DepTime;
                    if(timeInfo[i].Station==a) rt[0] = dept;
                    if(timeInfo[i].Station==b) rt[1] = arrt;
                }
                return rt;
        },                        
        giveTRA_timeTableTool: function(ttb){
            ttb.getFromToTime = function(a,b){
                return TT.fn.giveTRA_tool_getFromToTime(a,b,ttb);
            }
            return ttb;
        },
        //TRTC Function
        getTRTC_lineNum2Id: function(num){
            if(typeof(num)=='string'){
                num = parseInt(num.replace('trtc_',''),10);
            }
            return 'trtc_' + num;
        },
        getTRTC_stationDataOfID: function(id, lineID){
            var ary=TT.data.trtc.station_ary;
            for(var i=0; i<ary.length; i++){
                if(ary[i].id==id){
                	var rt = $.extend({sect: 'taipei'}, ary[i]);
                    if(lineID){
                        //return $.extend({byLine: lineID}, rt);
                        rt.byLine = lineID;
                    }
                    return rt;
                }
            }
            return false;
        },
        getTRTC_stationOnWhatLine: function(st){
            var rt = new Array(),
                line = TT.data.trtc.line;
            for(var i=0; i<line.length; i++){
                for(var j=0; j<line[i].station.length; j++){
                    if(line[i].station[j]==st){
                        rt.push(line[i].id);
                        break;
                    }
                }
            }
            return rt;
        },
        getTRTC_stationOnSameLine: function(a,b){
            var rt = new Array();
            var aLine = TT.fn.getTRTC_stationOnWhatLine(a);
            var bLine = TT.fn.getTRTC_stationOnWhatLine(b);
            for(var i=0; i<aLine.length; i++){
                for(var j=0; j<bLine.length; j++){
                    if(bLine[j]==aLine[i]){
                        rt.push(bLine[j]);
                        break;
                    }
                }
            }
            
            if(rt.length==0) rt = false;
            return rt;
        },
        getTRTC_stationTime: function(stationID, line, dir, w){
            var rnwTime = TT.fn.getTRTC_rnw_stationTime(stationID, line, dir, w);
            if(rnwTime!=false){
                return rnwTime;
            }
            if(rnwTime==false && stationID == 'trtc_071'){//No Tamsui Timetable
                var hslTime = TT.fn.getTRTC_rnw_stationTime('trtc_070', line, dir, w);
                return offsetTimeFn(hslTime, -3);
            }
            if(rnwTime==false && stationID == 'trtc_048'){//No Nanshijiao Timetable
                var hslTime = TT.fn.getTRTC_rnw_stationTime('trtc_047', line, dir, w);
                return offsetTimeFn(hslTime, -2);
            }
            if(rnwTime==false && stationID == 'trtc_076'){//No Dingpu Timetable
                var hslTime = TT.fn.getTRTC_rnw_stationTime('trtc_077', line, dir, w);
                return offsetTimeFn(hslTime, -3);
            }
            if(!w) w = TT.defined.defaultTRAWeekday;
            w = parseInt(w);
            if(!line){
                line = TT.fn.getTRTC_stationOnWhatLine(stationID)[0];
            }
            line = TT.fn.getTRTC_lineNum2Id(line);
            if(!dir){
                dir=0;
            }
            dir = parseInt(dir);
            
            var ww = '';
            switch(w){
                case 0:
                    ww = 'sunday';
                break;
                case 1:
                case 2:
                case 3:
                case 4:
                case 5:
                    ww = 'weekday';
                break;
                case 6:
                    ww = 'saturday';
                break;
            }
            
            
            function offsetTimeFn(timeTB, offsetMin){
                var tmpTime, spliceNum=0, rt=new Array();
                for(var i=0; i<timeTB.length; i++){
                    tmpTime = TT.fn.transTime2Sec(timeTB[i]);
                    tmpTime = tmpTime + (offsetMin*60);
                    if(tmpTime < 0) tmpTime+=86400;
                    if(tmpTime > (3600*4) && tmpTime < (3600*6)) spliceNum++;
                    timeTB[i] = TT.fn.transSec2Time(tmpTime);
                }
                if(spliceNum>0) timeTB.splice(0,spliceNum);
                return timeTB;
            }
            
            function formatTimeFn(ary){
                var rt = new Array();
                var tmpA = '', tmpH = '', tmpM = '', tmpS = '00';
                for(var i=0; i<ary.length; i++){
                    tmpH = TT.fn.transNum2StrA(i%24);
                    for(var j=0; j<ary[i].length; j++){
                        tmpM = TT.fn.transNum2StrA(ary[i][j]);
                        tmpA = tmpH + ':' + tmpM + ':' + tmpS;
                        rt.push(tmpA);
                    }
                }
                return rt;
            }
            
            var lineTime = TT.data.trtc.station_time[line];
            var stOffset = 0;
            if(lineTime){
                var stTime = lineTime[stationID];
            }else{
                return false;
            }
            
            if(!stTime){
                if(line=='trtc_5'){
                    stTime = lineTime['trtc_097'];
                    stOffset = TT.data.trtc.offset_time['trtc_5']['trtc_097'][stationID];
                    if(dir.toString() != TT.data.trtc.offset_time['trtc_5']['trtc_097']['LineDir']) stOffset = 0-stOffset;
                }
                if(line=='trtc_2'){
                    stTime = lineTime['trtc_071'];
                    stOffset = TT.data.trtc.offset_time['trtc_2']['trtc_071'][stationID];
                    if(dir.toString() != TT.data.trtc.offset_time['trtc_2']['trtc_071']['LineDir']) stOffset = 0-stOffset;
                }
                if(line=='trtc_3'){
                    stTime = lineTime['trtc_111'];
                    stOffset = TT.data.trtc.offset_time['trtc_3']['trtc_111'][stationID];
                    if(dir.toString() != TT.data.trtc.offset_time['trtc_3']['trtc_111']['LineDir']) stOffset = 0-stOffset;
                }
                if(line=='trtc_4'){
                    stTime = lineTime['trtc_048'];
                    stOffset = TT.data.trtc.offset_time['trtc_4']['trtc_048'][stationID];
                    if(dir.toString() != TT.data.trtc.offset_time['trtc_4']['trtc_048']['LineDir']) stOffset = 0-stOffset;
                }
                if(stOffset != 0){
                }else{
                    return false;
                }
            }
            
            if(stTime){
                var wTime = stTime[ww];
            }else{
                return false;
            }
            
            if(wTime){
                var formatTimeTable = formatTimeFn(wTime[dir]);
                if(stOffset != 0){
                    return offsetTimeFn(formatTimeTable, stOffset);
                }else{
                    return formatTimeTable;
                }
            }else{
                return false;
            }
            
        },
        getTRTC_rnw_stationTime: function(stationID, line, dir, w){
            if(!w) w = TT.defined.defaultTRAWeekday;
            var chk = TT.fn.checkTRTC_rnwTimeTableIsLoaded();
            if(!chk) return false;
            
            var tmpObj = TT.data.trtc.rnwTimeTable, rt=false, st;
            if(TT.data.trtc.rnwTimeTable && TT.data.trtc.rnwTimeTable[line] && TT.data.trtc.rnwTimeTable[line][stationID]){
                st = TT.data.trtc.rnwTimeTable[line][stationID];
                for(var i=0; i<st.length; i++){
                    if(st[i].dir==dir && st[i].week.indexOf(w)>=0){
                        rt = st[i].time;
                        break;
                    }
                }
            }
            return rt;
        },
        getTRTC_timeTable2Data: function(cbFn){
            function doBack(json){
                if(typeof(json)=='string' && json=='error'){
                    return false;
                }
                //Process to TT.data.trtc.rnwTimeTable.line.station{week, time}
                var tb = {}, tmpObj;
                for(var i=0; i<json.length; i++){
                    tmpObj = json[i];
                    if(!tb[tmpObj.line]) tb[tmpObj.line] = {}
                    if(!tb[tmpObj.line][tmpObj.id]) tb[tmpObj.line][tmpObj.id] = new Array();
                    tb[tmpObj.line][tmpObj.id].push({
                        week: tmpObj.week,
                        dir: tmpObj.dir,
                        time: tmpObj.time
                    });
                }
                TT.data.trtc.rnwTimeTable = tb;
                if(TT.fn.checkIsFunction(cbFn)){
                    cbFn();
                }
            }
            
            TT.fn.getTRTC_rnw_timeTableJSON('ronnywang_trtc.json', doBack);
        },
        getTRTC_rnw_timeTableJSON: function(url, cbFn){
            if(!url) url = 'ronnywang_trtc.json';
            TT.ui.mask();
            TT.ui.printStatus('讀取台北捷運時刻表中...');
            
            function formatRNW_JSON(json){//Format some data
                var tj, timeData, weekData, tmpName, dirData, lineData;
                for(var i=0; i<json.length; i++){
                    tj = json[i];
                    if(tj["時間"]){
                        timeData = tj["時間"].split(' ');
                        json[i].time = timeData;
                    }
                    if(tj["中文班次別"]){
                        switch(tj["中文班次別"]){
                            case '平常日(週一至週四)':
                                weekData = '1234';
                            break;
                            case '平常日(週一至週五)':
                                weekData = '12345';
                            break;
                            case '平常日(週五)':
                                weekData = '5';
                            break;
                            case '週六':
                                weekData = '6';
                            break;
                            case '週日':
                                weekData = '0';
                            break;
                        }
                        json[i].week = weekData;
                    }
                    if(tj["方向名稱"]){
                        tmpName = tj["方向名稱"];
                        if(/亞東醫院|頂埔/.test(tmpName)){
                            lineData = 'trtc_5';
                            dirData = '1';
                        }else if(/南港展覽館/.test(tmpName)){
                            lineData = 'trtc_5';
                            dirData = '0';
                        }else if(/大安|象山/.test(tmpName)){
                            lineData = 'trtc_2';
                            dirData = '1';
                        }else if(/北投|淡水/.test(tmpName)){
                            lineData = 'trtc_2';
                            dirData = '0';
                        }else if(/新店|台電大樓/.test(tmpName)){
                            lineData = 'trtc_3';
                            dirData = '1';
                        }else if(/松山/.test(tmpName)){
                            lineData = 'trtc_3';
                            dirData = '0';
                        }else if(/蘆洲|迴龍/.test(tmpName)){
                            lineData = 'trtc_4';
                            dirData = '1';
                        }else if(/南勢角/.test(tmpName)){
                            lineData = 'trtc_4';
                            dirData = '0';
                        }
                        json[i].line = lineData;
                        json[i].dir = dirData;
                    }
                    if(tj["車站代碼"]){
                        json[i].id = 'trtc_' + tj["車站代碼"];
                    }
                    if(tj["車站名稱"]){
                        json[i].name = tj["車站名稱"];
                    }
                    //json[i] = tj;
                }
                return json;
            }
            
            function successFn(json){
                    TT.ui.printStatus('讀取台北捷運時刻表完成。');
                    TT.ui.unmask();
                    json = formatRNW_JSON(json);
                    if(TT.fn.checkIsFunction(cbFn)){
                        cbFn(json);
                    }
                    TT.ui.updateCenter('home');
            }
            
            function errorFn(){
                    TT.ui.printStatus('讀取台北捷運時刻表失敗！');
                    TT.ui.unmask();
                    TT.ui.updateCenter('home');
                    if(TT.fn.checkIsFunction(cbFn)){
                        cbFn('error');
                    }
            }
            
            TT.fn.getTRTC_timeTableJSON(url, successFn, errorFn);
        },
        getTRTC_timeTableJSON: function(url, successFn, errorFn){
            $.ajax({
                url: url,
                type: 'GET',
                dataType: 'json',
                success: function(json) {
                    if(typeof(successFn)=='function'){
                        successFn(json);
                    }
                },
                error: function(){
                    if(typeof(errorFn)=='function'){
                        errorFn();
                    }
                }
            });
        },
        getTRTC_lineCheckOrDefault: function(a, b, line){
            var ary1 = TT.fn.getTRTC_stationOnSameLine(a,b);
            if(ary1){
                if(line){
                    var ckFlag = false;
                    for(var i=0; i<ary1.length; i++){
                        if(line==ary1[i]) ckFlag = true; 
                    }
                    if(!ckFlag) return false;
                }else{
                    line = ary1[0];
                }
            }else{
                //fetaure add cross line function
                return false;
            }
            return line;
        },
        getTRTC_needTimeBySameLineFromTo: function(a, b, line){
            line = TT.fn.getTRTC_lineCheckOrDefault(a, b, line);
            if(line){
                var baseStation = '';
                if(line=='trtc_2') baseStation = 'trtc_071';
                if(line=='trtc_3') baseStation = 'trtc_111';
                if(line=='trtc_4') baseStation = 'trtc_048';
                if(line=='trtc_5') baseStation = 'trtc_097';
                var lineA = TT.data.trtc.offset_time[line][baseStation];
                var aOffset = lineA[a];
                var bOffset = lineA[b];
                return Math.abs(aOffset-bOffset);
            }else{
                return false;
            }
        },
        getTRTC_overStringStationAry: function(str, line, dir){
            var lineObj = TT.fn.getTRTC_lineData(line);
            //TT.data.trtc.line.map(function(obj){
                //if(obj.id == line) lineObj = obj;
            //});
            if(!lineObj) return false;
            if(!dir) dir = lineObj.dir;
            
            var stAry = lineObj.station;
            var rt = new Array(), st, ary, flag=0;
            if(str.indexOf('~')>=0){
                ary = str.split('~');
                if(dir != lineObj.dir) ary = ary.reverse();
                if(ary[0]==null || ary[0]=='') ary[0] = stAry[0];
                if(ary[1]==null || ary[1]=='') ary[1] = stAry[stAry.length-1];
                for(var i=0; i<stAry.length; i++){
                    st = stAry[i];
                    if(st==ary[0]) flag=1;
                    if(flag==1){
                        rt.push(st);
                    }
                    if(st==ary[1]) flag=2;
                    if(flag==2){
                        break;
                    }
                }
            }
            return rt;
        },
        getTRTC_stationOnDiffSplitOutArea: function(a, b, line){
            var lineObj = TT.fn.getTRTC_lineData(line);
            if(!lineObj) return false;
            
            var brt = false, art = false, bStationAry, aStationAry, rt = false, tmpAry;
            if(lineObj.outArea && lineObj.outArea.length > 0){
                lineObj.outArea.map(function(obj){
                    tmpAry = TT.fn.getTRTC_overStringStationAry(obj.station, line);
                    for(var i=0; i<tmpAry.length; i++){
                        if(b==tmpAry[i]){
                            brt = obj;
                            bStationAry = tmpAry;
                        }
                        if(a==tmpAry[i]){
                            art = obj;
                            aStationAry = tmpAry;
                        }
                    }
                });
                if(art.station!=brt.station && art.transAt==brt.transAt){
                    rt = {
                        line: line,
                        splitStation: art.transAt,
                        transStationID: art.transStationID,
                        takeRange: [a,b],
                        stationAry:[aStationAry,bStationAry]
                    };
                }
            }
            return rt;
        },
        getTRTC_stationOnOutArea: function(a, b, line){
            var lineObj = TT.fn.getTRTC_lineData(line);
            if(!lineObj) return false;
            
            var rt = false, art = false, tmpAry;
            if(lineObj.outArea && lineObj.outArea.length > 0){
                lineObj.outArea.map(function(obj){
                    tmpAry = TT.fn.getTRTC_overStringStationAry(obj.station, line);
                    for(var i=0; i<tmpAry.length; i++){
                        if(b==tmpAry[i] && a!=obj.transAt){
                            rt = obj;
                        }
                        if(b==tmpAry[i] && a==obj.transAt && obj.isSubLine){
                            rt = obj;
                        }
                        if(a==tmpAry[i] && !(obj.isSubLine && a==obj.transAt)){
                            art = obj;
                        }
                    }
                });
                if(art) rt = false;//Both a and b on out area
            }
            return rt;
        },
        getTRTC_allTimeByFromTo: function(a, b, line, w){
            if(!w) w = TT.defined.defaultTRAWeekday;
            var dir = TT.fn.getTRTC_dirByFromTo(a, b);
            line = TT.fn.getTRTC_lineCheckOrDefault(a, b, line);
            if(dir===false){
                //fetaure add cross line function
                return false;
            }
            var aTime = TT.fn.getTRTC_stationTime(a, line, dir, w);
            var offsetTime = TT.fn.getTRTC_needTimeBySameLineFromTo(a, b, line);
            var outArea=TT.fn.getTRTC_stationOnOutArea(a, b, line);
            //var outAreaOffsetSec = (outArea) ? outArea.waitingNextMinute*60 : 0;
            var aryFromToTime = new Array();
            var tmpBTime, tmpATime, tmpANTime;
            for(var i=0; i<aTime.length; i++){
                /*if(outAreaOffsetSec > 0){
                    if(aTime[i+1]){
                        tmpATime = TT.fn.transTime2Sec(aTime[i], true);
                        tmpANTime = TT.fn.transTime2Sec(aTime[i+1], true);
                        outAreaOffsetSec = tmpANTime - tmpATime;
                    }
                }*/
                tmpBTime = (TT.fn.transTime2Sec(aTime[i]) + (offsetTime*60))%86400;// + outAreaOffsetSec;
                tmpBTime = TT.fn.transSec2Time(tmpBTime);
                aryFromToTime.push([aTime[i], tmpBTime]);
            } 
            return aryFromToTime;
        },
        getTRTC_timeRangeByFromTo: function(a, b, startTime, endTime, flagAD, line, w){
            if(flagAD===undefined) flagAD = true;
            if(!w) w = TT.defined.defaultTRAWeekday;
            
            if(!startTime) startTime = 0;
            if(!endTime) endTime = 60*60*24-1;
            var timeTable = TT.fn.getTRTC_allTimeByFromTo(a, b, line, w);
            if(typeof(startTime)!='number') startTime = TT.fn.transTime2Sec(startTime);
            if(typeof(endTime)!='number') endTime = TT.fn.transTime2Sec(endTime);
            var crossDaySec = TT.fn.transTime2Sec(TT.defined.defaultCrossDayTime),
                offset1Day = 86400;
            
            function cpTime(ttb){
                var insEnd = endTime;
                var time = (flagAD===true) ? TT.fn.transTime2Sec(ttb[0]) : TT.fn.transTime2Sec(ttb[1]);
                
                if(insEnd < startTime && insEnd < crossDaySec){
                    insEnd = insEnd + offset1Day;
                    if(time < crossDaySec){
                        time = time + offset1Day;
                    }
                }
                
                if(insEnd > startTime && insEnd > crossDaySec && time < crossDaySec) return false;
                
                if(time && time >= startTime && time <= insEnd){
                    return ttb;
                }else{
                    return false;
                }
            }
            
            var aryTime = new Array(),
                cpT;
            for(var i=0; i<timeTable.length; i++){
                cpT = cpTime(timeTable[i]);
                if(cpT !== false){
                    aryTime.push(cpT);
                }
            }
            aryTime = aryTime.sort(TT.fn.getTRTC_sortByABTime);
            return aryTime;
        },
        getTRTC_sortByABTime: function(a,b){
            var intA = TT.fn.transTime2Sec(a[0]);
            var intB = TT.fn.transTime2Sec(b[0]);
            var crossDaySec = TT.fn.transTime2Sec(TT.defined.defaultCrossDayTime);
            if(intA < crossDaySec) intA += 86400;
            if(intB < crossDaySec) intB += 86400;
            
            if(intA==intB) return 0;
            if(intA < intB) return -1;
            if(intA > intB) return 1;
        },
        getTRTC_dirByFromTo: function(a, b, line){
            line = TT.fn.getTRTC_lineCheckOrDefault(a, b, line);
            
            if(line){
                var lineData = TT.fn.getTRTC_lineData(line);
                for(var i=0; i<lineData.station.length; i++){
                    if(lineData.station[i]==a) return lineData.dir;
                    if(lineData.station[i]==b) return TT.fn.reverseDir(lineData.dir);
                }
                return false;
            }else{
                return false;
            }
        },
        getTRTC_lineData: function(line){
            for(var i=0; i<TT.data.trtc.line.length; i++){
                if(TT.data.trtc.line[i].id==line){
                    return TT.data.trtc.line[i];
                }
            }
            return false;
        },
        localData: {
            getItem: function(name){
                if(TT.defined.canUseLocalStorage){
                    return window.localStorage.getItem(name);
                }
            },
            setItem: function(name, val){
                if(TT.defined.canUseLocalStorage){
                    return window.localStorage.setItem(name, val);
                }
            },
            list: function(){
                if(TT.defined.canUseLocalStorage) return window.localStorage;
            }
        },
        mixAllRoute: function(aryRoute, flagAD, sortBy){
            var fRouteAry = new Array(), routeA, routeS, routeP, bestLink;
            sortBy = (sortBy) ? sortBy : '';
            for(var tc=0; tc<aryRoute.length; tc++){
                routeA = aryRoute[tc];
                bestLink = routeA[0].bestLink;
                var totalMinute = 0, fastestMinute = 9999;
                for(var i=0; i<bestLink.length; i++){
                    routeP = {
                        linkTime: bestLink[i],
                        routeIndex: tc,
                        routeMap: new Array()
                    }
                    if(!routeP.linkTime[0]) continue;
                    if(!routeP.linkTime[routeP.linkTime.length-1]) continue;
                    for(var j=0; j<routeA.length; j++){
                        if(!bestLink[i][j]) continue;
                        routeS = {
                            company: routeA[j].company,
                            line: routeA[j].line,
                            takeRange: routeA[j].takeRange,
                            origPointer: bestLink[i][j].myPointer,
                            info: bestLink[i][j].info,
                            time: bestLink[i][j].time
                        }
                        if(routeA[j].transStation){
                            routeS.transStation = routeA[j].transStation;
                            routeS.transStationID = routeA[j].transStationID;
                        }
                        if(routeA[j].doNotTakeTrain) routeS.doNotTakeTrain = routeA[j].doNotTakeTrain;
                        routeP.routeMap.push(routeS);
                    }
                    var intSortTime;
                    if(flagAD){
                        intSortTime = TT.fn.transTime2Sec(routeP.linkTime[0].time[0]);
                        if(routeP.linkTime[routeP.linkTime.length-1]) intSortTime = TT.fn.transTime2Sec(routeP.linkTime[routeP.linkTime.length-1].time[1]); //If sort always use arr time, open this
                        if(intSortTime < TT.fn.transTime2Sec(TT.defined.defaultCrossDayTime)) intSortTime += 86400;
                        routeP.tt_sortTime = intSortTime;
                    }else{
                        intSortTime = TT.fn.transTime2Sec(routeP.linkTime[routeP.linkTime.length-1].time[1]);
                        if(intSortTime < TT.fn.transTime2Sec(TT.defined.defaultCrossDayTime)) intSortTime += 86400;
                        routeP.tt_sortTime = intSortTime;
                    }
                    routeP.travelStartTime = routeP.linkTime[0].time[0];
                    if(routeP.routeMap[0].doNotTakeTrain && routeP.linkTime[1]){
                        routeP.travelStartTime = routeP.linkTime[1].time[0];
                        routeP.travelStartTime = TT.fn.transSec2Time(TT.fn.transTime2Sec(routeP.travelStartTime) - (routeP.routeMap[0].transStation.walkMinute*60));
                    }
                    routeP.travelEndTime = routeP.linkTime[routeP.linkTime.length-1].time[1];
                    if(routeP.routeMap[routeP.linkTime.length-1].doNotTakeTrain && routeP.linkTime[routeP.linkTime.length-2]){
                        routeP.travelEndTime = routeP.linkTime[routeP.linkTime.length-2].time[1];
                        routeP.travelEndTime = TT.fn.transSec2Time(TT.fn.transTime2Sec(routeP.travelEndTime) + (routeP.routeMap[routeP.routeMap.length-2].transStation.walkMinute*60));
                    }
                    
                    routeP.travelMinute = (function(){
                        var st = TT.fn.transTime2Sec(routeP.travelStartTime);
                        var ed = TT.fn.transTime2Sec(routeP.travelEndTime);
                        if(ed < st) ed = ed + 86400;
                        return Math.ceil((ed-st)/60);
                    })();
                    if(sortBy=='travelMinute') routeP.tt_sortTime = routeP.travelMinute;
                    if(sortBy=='transCount') routeP.tt_sortTime = routeP.linkTime.length;
                    if(routeP.travelMinute < fastestMinute) fastestMinute = routeP.travelMinute;
                    totalMinute += routeP.travelMinute;
                    fRouteAry.push(routeP);
                }
                routeA[0].total_fastestMinute = fastestMinute;
                routeA[0].total_avgMinute = Math.ceil(totalMinute/bestLink.length);
            }
            fRouteAry = fRouteAry.sort(TT.fn.getTRA_sortByTTSortTime);
            return fRouteAry;
        },
        reverseDir: function(dir){
            if(dir=="1" || dir==1) return "0";
            if(dir=="0" || dir==0) return "1";
        },
        transTime2HM: function(val){
            if(typeof(val)=='number') val = TT.fn.transSec2Time(val);
            var ary = val.split(':');
            return ary[0] + ':' + ary[1];
        },
        transNum2StrA: function(intA){
            intA = parseInt(intA,10);
            if(intA <= 9){
                return '0' + intA;
            }else{
                return intA.toString();
            }
        },
        transTime2Sec: function(str,offsetTomorrow){
            if (str == null || str == '') {
                str = '0';
            }
            var aryA = str.split(':'), rt;
            if (aryA.length <= 1) {
                rt = parseInt(str,10);
            } else if (aryA.length == 2) {
                rt = parseInt(aryA[0],10) * 3600 + parseInt(aryA[1],10) * 60;
            } else if (aryA.length == 3) {
                rt = parseInt(aryA[0],10) * 3600 + parseInt(aryA[1],10) * 60 + parseInt(aryA[2],10);
            }
            
            if(offsetTomorrow && rt < TT.fn.transTime2Sec(TT.fn.getDefaultDayLastTime())){
                rt = rt + 86400;
            }
            return rt;
        },
        transSec2Time: function(sec){
            var tid = 0,
                tih = 0,
                tim = 0,
                tis = 0;

            if((sec === '')){
                return '';
            }else if(parseInt(sec,10) < 0){
                sec = 86400 + sec;
            }
            
            sec = parseInt(sec,10);
            tis = sec % 60;
            sec = sec - tis;
            sec = sec / 60;
            tim = sec % 60;
            sec = sec - tim;
            sec = sec / 60
            tih = sec;
            

            tih = (tih < 10) ? '0' + tih : tih;
            tim = (tim < 10) ? '0' + tim : tim;
            tis = (tis < 10) ? '0' + tis : tis;

            if (tih == 0) {
                return tih + ':' + tim + ':' + tis;
            } else {
                return tih + ':' + tim + ':' + tis;
            }
        }
    }
    
    function classWindow(ucfg){
        ucfg = ucfg || {};
        var defaultCfg = {
            mask: false,
            height: 'auto',
            width: 'auto',
            baseClass: ' ttWindow',
            cls: '',
            id: TT.ui.genRandomId(),
            div: '',
            items: [],
            html: '',
            renderTo: 'body',
            onShow: function(){},
            zIndex: '120'
        }
        var cfg = $.extend(defaultCfg, ucfg);
        if(typeof(cfg.width)=='number') cfg.width = cfg.width + 'px';
        if(typeof(cfg.height)=='number') cfg.height = cfg.height + 'px';
        var me = this;
        
        me.el = document.createElement('div');
        me.el.className = cfg.baseClass + ' ' + cfg.cls;
        me.el.id = cfg.id;
        me.el.style.zIndex = cfg.zIndex;
        me.el.style.width = cfg.width;
        me.el.style.height = cfg.height;
        me.el.innerHTML = '<div class="inner" id="' + cfg.id + '_inner"></div><div class=" ttWindowClose" closeID="' + cfg.id + '">X</div>';
        
        me.getInner = function(){
            return document.getElementById(cfg.id + '_inner');
        }
        me.setInnerHTML = function(html){
            document.getElementById(cfg.id + '_inner').innerHTML = html;
        }
        
        me.init = function(){
            if(!document.getElementById(cfg.id)){
                if(cfg.renderTo=='body'){
                    document.body.appendChild(me.el);
                }else{
                    document.getElementById(cfg.renderTo).appendChild(me.el);
                }
                me.inner = me.getInner();
                if(typeof(cfg.div)=='string'){
                    me.inner.innerHTML = cfg.div;
                }else{
                    me.inner.appendChild(cfg.div);
                }
                
                if(cfg.html != ''){me.inner.innerHTML = cfg.html;}
                for(var i=0; i<cfg.items.length; i++){
                    me.inner.appendChild(cfg.items[i]);
                }
            }
            me.el.style.display = 'none';
        }
        
        me.addClass = function(cls){
            var ary = me.el.className.split(' ');
            for(var i=0; i<ary.length; i++){
                if(ary[i]==cls) return me.el.className;
            }
            me.el.className = me.el.className + ' ' + cls;
            return me.el.className;
        }
        me.removeClass = function(cls){
            var ary = me.el.className.split(' '), rt = '';;
            for(var i=0; i<ary.length; i++){
                if(ary[i]!=cls){
                    rt += ' ' + ary[i];
                }
            }
            me.el.className = rt;
            return rt;
        }
        
        me.resetPosition = function(){
            var dh = TT.fn.getDocumentHeight(), dw = TT.fn.getDocumentWidth();
            var wh = me.el.clientHeight, ww = me.el.clientWidth;
            
            var top = Math.ceil((dh-wh)/2);
            var left = Math.ceil((dw-ww)/2);
            
            if(top < 0) top = 0;
            if(left < 0) left = 0;
            
            me.setPosition(top, left);
        }
        me.setPosition = function(top,left){
            me.el.style.top = top + 'px';
            me.el.style.left = left + 'px';
        }
        
        me.show = function(){
            if(me.isShow) return false;
            me.isShow = true;
            me.init();
            me.el.style.display = '';
            me.resetPosition();
            if(cfg.mask){
                TT.ui.mask(' ');
            }
            cfg.onShow(me);
        }
        
        me.close = function(){
            me.el.style.display = 'none';
            TT.ui.unmask();
            me.isShow = false;
        }
        me.clickFn = function(e){
            if(e.target.className.indexOf('ttWindowClose')>=0){
                var id = e.target.attributes.getNamedItem('closeID');
                me.close();
            }
        }
        me.el.addEventListener('click', me.clickFn, false);
    }
    function classMapSelector(ucfg){
        ucfg = ucfg || {};
        var defaultCfg = {
            mask: false,
            height: 'auto',
            width: 'auto',
            autoScroll: false,
            baseClass: ' ttMapSelector',
            cls: '',
            id: TT.ui.genRandomId(),
            items: [],
            html: '',
            isRendered: false,
            onShow: function(){},
            zIndex: '132'
        }
        var cfg = $.extend(defaultCfg, ucfg);
        if(typeof(cfg.width)=='number') cfg.width = cfg.width + 'px';
        if(typeof(cfg.height)=='number') cfg.height = cfg.height + 'px';
        var me = this;
        
        me.el = document.createElement('div');
        me.el.className = cfg.baseClass + ' ' + cfg.cls;
        me.el.id = cfg.id;
        me.el.style.zIndex = cfg.zIndex;
        me.el.style.width = cfg.width;
        me.el.style.height = cfg.height;
        if(cfg.overflowStyle) me.el.style.overflow = cfg.overflowStyle;
        me.el.innerHTML = '<div class="header" id="' + cfg.id + '_header"></div>' + 
            '<div class="main" id="' + cfg.id + '_main"></div><div class=" ttWindowClose" closeID="' + cfg.id + '">X</div>';
        
        me.init = function(){
            if(!document.getElementById(cfg.id)){
                document.body.appendChild(me.el);
                me.isRendered = true;
                var tmpD;
                for(var i=0; i<cfg.items.length; i++){
                    tmpD = '<div class="tabName">' + cfg.items[i].headerText + '</div>';
                    document.getElementById(cfg.id+ '_header').innerHTML += tmpD;
                    document.getElementById(cfg.id+ '_main').appendChild(cfg.items[i]);
                }
                me.itemSwitch(cfg.items[0].headerText);
            }
            me.el.style.display = 'none';
        }
        
        me.itemSwitch = function(val){
            var dm = document.getElementById(cfg.id + '_header');
            for(var i=0; i<dm.childNodes.length; i++){
                dm.childNodes[i].className = dm.childNodes[i].className.replace(' onUse','');
                cfg.items[i].style.zIndex = '2';
                cfg.items[i].style.opacity = '0.2';
                if(val==dm.childNodes[i].innerHTML){
                    dm.childNodes[i].className = dm.childNodes[i].className + ' onUse';
                    cfg.items[i].style.opacity = '1';
                    cfg.items[i].style.zIndex = '5';
                    me.itemActiveString = val;
                }
            }
        }
        
        me.addClass = function(cls){
            var ary = me.el.className.split(' ');
            for(var i=0; i<ary.length; i++){
                if(ary[i]==cls) return me.el.className;
            }
            me.el.className = me.el.className + ' ' + cls;
            return me.el.className;
        }
        me.removeClass = function(cls){
            var ary = me.el.className.split(' '), rt = '';;
            for(var i=0; i<ary.length; i++){
                if(ary[i]!=cls){
                    rt += ' ' + ary[i];
                }
            }
            me.el.className = rt;
            return rt;
        }
        
        me.resetPosition = function(){
            var dh = TT.fn.getDocumentHeight(), dw = TT.fn.getDocumentWidth();
            var wh = me.el.clientHeight, ww = me.el.clientWidth;
            
            var top = 0;
            var left = 0;//Math.ceil((dw*0.025));
            
            me.setPosition(top, left);
            //resize window
            if(cfg.autoScroll){
                me.el.style.width = (dw-20) + 'px';
                me.el.style.height = (dh-20) + 'px';
                var domMain = document.getElementById(cfg.id + '_main');
                domMain.style.width = me.el.style.width;
                domMain.style.height = (dh-50) + 'px';
                domMain.style.overflow = 'auto';
            }
        }
        me.setPosition = function(top,left){
            me.el.style.top = top + 'px';
            me.el.style.left = left + 'px';
        }
        
        me.show = function(scfg){
            if(me.isShow) return false;
            if(typeof(domA)=='string') domA = document.getElementById(domA);
            TT.ui.bodyScroll(0);
            me.isShow = true;
            me.init();
            me.el.style.display = '';
            me.resetPosition();
            TT.ui.mask(' ');
            cfg.onShow(me, cfg, scfg);
        }
        
        me.close = function(){
            me.el.style.display = 'none';
            TT.ui.unmask();
            me.isShow = false;
        }
        me.clickFn = function(e){
            if(e.target.className.indexOf('ttWindowClose')>=0){
                var id = e.target.attributes.getNamedItem('closeID');
                me.close();
            }
            if(e.target.className.indexOf('tabName')!=-1){
                me.itemSwitch(e.target.innerHTML);
            }
        }
        me.el.addEventListener('click', me.clickFn, false);
    }
    TT.lib = {
        classWindow: classWindow,
        classMapSelector: classMapSelector
    }
    
    TT.ui = {
        randomIdNum: 0,
        bodyScroll: function(val){
            var sysTop;
            if(document.documentElement && document.documentElement.scrollTop>0){
                if(val || val===0) document.documentElement.scrollTop = val;
                sysTop = document.documentElement.scrollTop;
            }else if(document.body && document.body.scrollTop>0){
                if(val || val===0) document.body.scrollTop = val;
                sysTop = document.body.scrollTop;
            }
            return sysTop;
        },
        centerScroll: function(val, isDirect){
            var sysTop;
            if(val || val===0){
                if(isDirect){
                    $(TT.ui.centerDiv).scrollTop(val);
                }else{
                    $(TT.ui.centerDiv).animate({ scrollTop: val }, 400);
                }
            }
            sysTop = document.body.scrollTop;
            return sysTop;
        },
        centerTimeTableDisplayDivClear: function(){
            TT.ui.center.timeTable.displayDiv.trainDiv.innerHTML = '';
            TT.ui.center.timeTable.displayDiv.routeDiv.innerHTML = '';
        },
        createDiv: function(id, cls, appendT){
            var dom = document.createElement('div');
            if(id && id=='_gen') id = TT.ui.genRandomId();
            if(id) dom.id = id;
            if(cls) dom.className = cls;
            if(appendT){
                if(appendT == 'body'){
                    document.body.appendChild(dom);
                }else{
                    document.getElementById(appendT).appendChild(dom);
                }
            }
            return dom;
        },
        createBaseDiv: function(){
            TT.ui.maskDiv = TT.ui.createDiv('tt_mask', 'mask', 'body');
            TT.ui.maskText = TT.ui.createDiv('tt_mask_text', 'text', 'tt_mask');
            TT.ui.maskText.innerHTML = 'Loading...';
            
            TT.ui.centerDiv = TT.ui.createDiv('tt_center', 'center', 'body');
            TT.ui.center = {};
        },
        createHome: function(){
            TT.ui.center.home = TT.ui.createDiv('tt_home', 'centerPage home', TT.ui.centerDiv.id);
            
            //HELP Frame
            TT.ui.center.home.help = TT.ui.createDiv('tt_home_help', 'frameA help', TT.ui.center.home.id);
            var helpDiv = TT.ui.center.home.help;
            helpDiv.divTitle = TT.ui.createDiv(helpDiv.id + '_title', 'title', helpDiv.id);
            helpDiv.divTitle.innerHTML = '說明';
            helpDiv.divText1 = TT.ui.createDiv(helpDiv.id + '_text1', 'text', helpDiv.id);
            helpDiv.divText1.innerHTML = '<p>' + '一般使用者進行查詢請使用時刻表功能，研究使用者要調整各項參數與路由可從工具內調整。' + '</p>' +
                '<p>' + '有關時刻表功能之簡單說明如下' + '</p>' +
                '<ul>' +
                    '<li><b>我在每個轉乘站的步行時間：</b>可依個人步行速度或預期誤點可能性調整轉車預留時間。</li>' +
                    '<li><b>出發站、到達站：</b>可從下拉選單中選擇一個車站，或者從右邊的<div class="help_selectStationByLine">選擇車站</div>中依照路線選擇車站。</li>' +
                    '<li><b>從這個時間開始、到這個時間為止：</b>調整預計搭車的時間，假設 08:00 後才出發可以設定 08:00 到 09:00 之間，建議間隔不要超過三小時避免搜尋出來的資料過多。</li>' +
                    '<li><b>出發的列車：</b>設定為出發的列車將會以出發站的時間來做計算。</li>' +
                    '<li><b>到達的列車：</b>設定為到達的列車將會以到達站的時間來做計算，例如 08:50 前要到市政府站可以設定時間 07:50 開始到 08:50 為止去做查詢。</li>' +
                '</ul>' +
                '<p>' + '有關搜尋出結果之簡單說明如下' + '</p>' +
                '<ul>' +
                    '<li><b>排序：</b>可依個人需求調整排序的方式，像是越早抵達、花費時間越短之類的需求。</li>' +
                    '<li><b>路徑：</b>搜尋完會將系統上所有可以轉車的方式列出來，並附有花費時間作參考，可以勾選清除不想看的路徑，例如花費時間太長的或轉車次數太多的。</li>' +
                    '<li><b>怎麼路徑上有<div class="tt_ck_route_filterPri">1</div><div class="tt_ck_route_filterPri">2</div><div class="tt_ck_route_filterPri">3</div>？</b>那是快速切換只看最快(1)到前三快(3)轉乘路徑。</li>' +
                    '<li><b>螢幕不夠寬怎麼看全部資訊？</b>網頁部分資訊採用 RWD　呈現，當螢幕不夠寬會隱藏部分資訊，想看完整資訊可點右邊的<div class="help_timeTableResultMore">&gt;&gt;</div>。</li>' +
                    '<li><b>搜尋完後網址變了？</b>在支援 HTML5 history 功能的瀏覽器上，網址會自動帶上搜尋參數，複製網址給別人連進來可以自動搜尋你當初搜尋的條件。</li>' +
                '</ul>';
            //HELP Frame
            TT.ui.center.home.update = TT.ui.createDiv('tt_home_update', 'frameA update', TT.ui.center.home.id);
            var updateDiv = TT.ui.center.home.update;
            updateDiv.divTitle = TT.ui.createDiv(updateDiv.id + '_title', 'title', updateDiv.id);
            updateDiv.divTitle.innerHTML = '更新';
            updateDiv.divText1 = TT.ui.createDiv(updateDiv.id + '_text1', 'text', updateDiv.id);
            updateDiv.divText1.innerHTML = '' +
                '<div style="height: 80px; overflow-y:scroll; overflow-x:hidden;"><ul>' +
                (function(){ return '<li>' + TT.defined.programUpdateInfo.join('</li><li>') + '</li>'; })() +
                '</ul><div>';
            
            //TRA Frame
            TT.ui.center.home.tra = TT.ui.createDiv('tt_home_tra', 'frameA tra', TT.ui.center.home.id);
            TT.ui.center.home.tra.divTitle = TT.ui.createDiv('tt_home_tra_title', 'title', TT.ui.center.home.tra.id);
            TT.ui.center.home.tra.divTitle.innerHTML = '台鐵 TRA';
            TT.ui.center.home.tra.divText1 = TT.ui.createDiv('tt_home_tra_text1', 'text', TT.ui.center.home.tra.id);
            TT.ui.center.home.tra.divText1.innerHTML = '<p>台鐵時刻表載入自政府資料開放平台之鐵路時刻表。</p>' +
                '<p>下載開發者替換時刻表檔案請在網頁同目錄下儲存w0.xml ~ w6.xml，w0為星期日。</p>';
            TT.ui.center.home.tra.divCkWeek = TT.ui.createDiv('tt_home_tra_ckWeek', 'option', TT.ui.center.home.tra.id);
            TT.ui.center.home.tra.divCkWeek.innerHTML = '<ul>' +
                '<li><input type="checkbox" id="tt_home_tra_ckWeek_1" class="ckWeek">讀取星期一<div id="tt_home_tra_ckWeekLoaded_1" class="ckWeekLoaded">已讀取</div></li>' +
                '<li><input type="checkbox" id="tt_home_tra_ckWeek_2" class="ckWeek">讀取星期二<div id="tt_home_tra_ckWeekLoaded_2" class="ckWeekLoaded">已讀取</div></li>' +
                '<li><input type="checkbox" id="tt_home_tra_ckWeek_3" class="ckWeek">讀取星期三<div id="tt_home_tra_ckWeekLoaded_3" class="ckWeekLoaded">已讀取</div></li>' +
                '<li><input type="checkbox" id="tt_home_tra_ckWeek_4" class="ckWeek">讀取星期四<div id="tt_home_tra_ckWeekLoaded_4" class="ckWeekLoaded">已讀取</div></li>' +
                '<li><input type="checkbox" id="tt_home_tra_ckWeek_5" class="ckWeek">讀取星期五<div id="tt_home_tra_ckWeekLoaded_5" class="ckWeekLoaded">已讀取</div></li>' +
                '<li><input type="checkbox" id="tt_home_tra_ckWeek_6" class="ckWeek">讀取星期六<div id="tt_home_tra_ckWeekLoaded_6" class="ckWeekLoaded">已讀取</div></li>' +
                '<li><input type="checkbox" id="tt_home_tra_ckWeek_0" class="ckWeek">讀取星期日<div id="tt_home_tra_ckWeekLoaded_0" class="ckWeekLoaded">已讀取</div></li>' +
            '</ul>';
            TT.ui.center.home.tra.buttonReadWeekTimeTable = TT.ui.createSystemButton({
                id: 'tt_home_tra_btnReadWeekTimeTable', 
                text: '手動讀取時刻表',
                appendT: TT.ui.center.home.tra.id,
                clickFn: function(e){
                    var aryCkWeek = $('.center .home .frameA.tra input.ckWeek');
                    var ws = '';
                    aryCkWeek.each(function(e,t){
                        var w = t.id.replace('tt_home_tra_ckWeek_','');
                        if(t.checked==true){
                            ws += w;
                        }
                    });
                    TT.fn.getTRA_TimeTable2Data(ws);
                }
            });
            
            //TRTC Frame
            TT.ui.center.home.trtc = TT.ui.createDiv('tt_home_trtc', 'frameA trtc', TT.ui.center.home.id);
            TT.ui.center.home.trtc.divTitle = TT.ui.createDiv('tt_home_trtc_title', 'title', TT.ui.center.home.trtc.id);
            TT.ui.center.home.trtc.divTitle.innerHTML = '台北捷運 TRTC';
            TT.ui.center.home.trtc.divText1 = TT.ui.createDiv('tt_home_trtc_text1', 'text', TT.ui.center.home.trtc.id);
            TT.ui.center.home.trtc.divText1.innerHTML = '<p>因沒有台北捷運如台鐵的每列班車資訊，目前台北捷運的資料以網友ronnywang自台北捷運官網轉換出來的csv檔轉成json後匯入，沒有時刻表的車站會以站間行駛時間做相對計算。<span style="color:#FF4020;">台北捷運無法查詢新北投線、小碧潭線、文湖線</span>，行車時間均以台北捷運官方網站查詢之<span style="color:#1FB020;">站間行駛時間相加或相減於南港站、松山站、淡水站及南勢角站</span>，故時間上可能與真正的到站時刻有一兩分鐘的誤差。</p>' +
                '<p>替換時刻表檔案請在網頁同目錄下儲存 <a target="_new" href="ronnywang_trtc.json">ronnywang_trtc.json</a> </p>';
            
            //Program Frame
            TT.ui.center.home.prog = TT.ui.createDiv('tt_home_prog', 'frameA prog', TT.ui.center.home.id);
            TT.ui.center.home.prog.divTitle = TT.ui.createDiv('tt_home_prog_title', 'title', TT.ui.center.home.prog.id);
            TT.ui.center.home.prog.divTitle.innerHTML = '接軌時刻 Web APP 概述';
            TT.ui.center.home.prog.divText1 = TT.ui.createDiv('tt_home_prog_text1', 'text', TT.ui.center.home.prog.id);
            TT.ui.center.home.prog.divText1.innerHTML = '<p>接軌時刻是建立台灣的跨營運系統間轉乘時間查詢程式，便於研究有效率的轉乘路徑。</p>' +
                '<p>接軌時刻的授權原則' +
                    '<ul>' +
                        '<li>任何使用均可 E-Mail 原作者取得授權，但修改網頁後執行於網頁伺服器上請加註作者名稱於取得版本的作者之後，以區別為個人化版本，版本、發行單位、日期可自由調整。</li>' +
                        '<li>台北捷運時刻表 JSON 資料轉換自網友 <a target="_new" href="https://sheethub.com/ronnywang/%E5%8F%B0%E5%8C%97%E6%8D%B7%E9%81%8B%E7%8F%AD%E6%AC%A1%E6%99%82%E5%88%BB%E8%A1%A8">ronnywang 網站</a>，相關授權請洽詢他本人</li>' +
                    '</ul>' +
                '</p>' +
                /*'<p>前導網頁的開發原則' +
                    '<ul>' +
                        //'<li>除非必要，否則不使用jQuery基本版以外的套件，網頁上的元件盡量以 HTML 原生元件操作以維持相容性並避免其他 library 授權問題，前導網頁不特別要求元件外觀與整體美觀，簡單易讀方便操作修改為原則。</li>' +
                        '<li>使用 HTML、Javascript、CSS構成，不使用任何伺服器端技術與資料庫，保持未來移植其他平台離線使用可能性。</li>' +
                        '<li>時刻表與路由資料原則採離線運作，所需要之台鐵或捷運公司時刻表下載後存放在網頁同目錄下讀取。</li>' +
                       // '<li>為方便由本機進行 Ajax 存取，本機開發需相容 Firefox 瀏覽器，在伺服器線上時必需相容 Chrome，其餘瀏覽器(如 Safari、Opera、IE)相容性在前導網頁不特別要求。</li>' +
                        //'<li>時刻表或大型資料以搜尋運用時才讀取為原則，加快進入網頁速度。</li>' +
                        //'<li>有更新開發進度時可以簡單寫一行在 Javascript 開頭的註解區。</li>' +
                        '<li>軌道的運轉方向與台鐵接近平行者採相同為原則，其餘視點由北往南、由東向西，若相近於逆時針時 dir 為 1，相近於順時針時 dir 為 0。</li>' +
                        '<li>不使用網路上或它處取得的圖檔以避免圖像授權問題，自行製作的圖檔盡量以 base64 編碼後存於 CSS 來利用。</li>' +
                        //'<li>前導網頁的 HTML、Javascript、CSS 存放於單一網頁檔內，不使用任何壓縮 code 或 Build 方式才運作，轉為正式版時才進行分拆作業。</li>' +
                        '<li>Name Space 為 TT，進入點為 TT.initFn()，底層演算法和工具存放於 TT.fn 下，與網頁外觀顯示相關存放於 TT.ui 下，基礎資料存放於 TT.data 下，基本定義存放於 TT.defined 下，當次搜尋結果存放於 TT.now 下。</li>' +
                        //'<li>HTML CODE 的 BODY 保持內容乾淨，UI以 createElement 的方式附加上去，元件內容則可以 innerHTML 直接設計。</li>' +
                        '<li>轉乘步行時間存在 TT.data.transStation 下各站的 walkMinute，理論上每一種轉乘方式都要建立一個轉乘站，例如台北站台鐵捷運之間就要建立台鐵至板南線、台鐵至淡水信義線、板南線至淡水信義線，分別存放步行時間並成為該種路線的路由點。</li>' +
                        '<li>轉乘路由方式存在 TT.data.routeMap 下，目前以人工方式整理可能的路由。</li>' +
                        //'<li>下拉上背景色，當車站下拉選單超過兩百個選項以上時需著手進行車站選擇器的新 UI 調整，不適合再使用單純的 SELECT 元件。</li>' +
                        //'<li></li>' +
                    '</ul>' +
                '</p>' +*/
                '<p>接軌時刻的運作現況' +
                    '<ul>' +
                        '<li><span style="color:#FE2010;">搜尋時間間隔超過三小時可能造成計算過久。</span></li>' +
                        '<li>台鐵部分目前只開放基隆至中壢站。</li>' +
                        '<li>台北捷運的部分目前僅建立部分車站資料台北捷運說明框內敘述。</li>' +
                        '<li>台北捷運無台鐵般詳細的每列車到站與離站資訊，時間上均採用相對計算方式於台北捷運說明框內敘述。</li>' +
                        '<li>因為將資料載入到前端做計算，好處是連續查詢都在前端完成不用跑伺服器速度快，壞處是在運算效能低落的裝置上計算較慢。</li>' +
                    '</ul>' +
                '</p>' +
                '<p>關於' +
                    (function(){
                        var rt = '';
                        for(var k in TT.defined.programAbout){
                            rt += '<li>' + k + ': ' + TT.defined.programAbout[k] + '</li>';
                        }
                        return '<ul>' + rt + '</ul>';
                    })() +
                '</p>' +
                '<p></p>' +
            '';
            
        },
        createTimeTable: function(){
            if(TT.ui.center.timeTable){
                TT.ui.center.timeTable.innerHTML = '';
            }else{
                TT.ui.center.timeTable = TT.ui.createDiv('tt_timeTable', 'centerPage timeTable', TT.ui.centerDiv.id);
            }
            var localDataFn = TT.fn.localData;
            
            //Control Frame
            TT.ui.center.timeTable.controlDiv = TT.ui.createDiv('tt_timeTable_control', 'frameA control', TT.ui.center.timeTable.id);
            TT.ui.center.timeTable.controlDiv.preSettingDiv = TT.ui.createPreSetting({id: 'ttc_preSetting', renderID: 'tt_timeTable_control'});
            TT.ui.center.timeTable.controlDiv.stationSelectDiv = TT.ui.createTakeStation({id: 'ttc_stationSelect', renderID: 'tt_timeTable_control'});
            TT.ui.center.timeTable.controlDiv.timeSelectDiv = TT.ui.createTakeTimeSelect({id: 'ttc_timeSelect', renderID: 'tt_timeTable_control'});
            TT.ui.center.timeTable.controlDiv.weekSelectDiv = TT.ui.createWeekSelect({id: 'ttc_weekSelect', renderID: 'tt_timeTable_control'});
            TT.ui.center.timeTable.controlDiv.depArrDiv = TT.ui.createTakeTimeFindDepArr({id: 'ttc_ADSelect', renderID: 'tt_timeTable_control'});
            TT.ui.center.timeTable.controlDiv.findButtonDiv = TT.ui.createTakeFindButton({id: 'ttc_findButton', renderID: 'tt_timeTable_control'});
            //Set default param
            var defaultFromStation = (localDataFn.getItem('defaultFromStation')) ? localDataFn.getItem('defaultFromStation') : 'tra_1005',
                defaultToStation = (localDataFn.getItem('defaultToStation')) ? localDataFn.getItem('defaultToStation') : 'trtc_093',
                defaultSearchDay = new Date().getDay(),
                defaultStartTime = (localDataFn.getItem('defaultStartTime')) ? localDataFn.getItem('defaultStartTime') : '07:00',
                defaultEndTime = (localDataFn.getItem('defaultEndTime')) ? localDataFn.getItem('defaultEndTime') : '09:00';
            //Use Get param
            var GetP = TT.defined.GetP;
            if(GetP){
                if(GetP['a']) defaultFromStation = GetP['a'];
                if(GetP['b']) defaultToStation = GetP['b'];
                if(GetP['w']) defaultSearchDay = GetP['w'];
                if(GetP['startTime']) defaultStartTime = decodeURIComponent(GetP['startTime']);
                if(GetP['endTime']) defaultEndTime = decodeURIComponent(GetP['endTime']);
            }
            TT.ui.center.timeTable.controlDiv.stationSelectDiv.fnSetStart(defaultFromStation);
            TT.ui.center.timeTable.controlDiv.stationSelectDiv.fnSetEnd(defaultToStation);
            TT.ui.center.timeTable.controlDiv.timeSelectDiv.fnSetStartTime(defaultStartTime);
            TT.ui.center.timeTable.controlDiv.timeSelectDiv.fnSetEndTime(defaultEndTime);
            TT.ui.center.timeTable.controlDiv.weekSelectDiv.fnSetDay(defaultSearchDay);
            
            //Display Frame
            TT.ui.center.timeTable.displayDiv = TT.ui.createDiv('tt_timeTable_display', 'ttbDisplay', TT.ui.center.timeTable.id);
            TT.ui.center.timeTable.displayDiv.routeDiv = TT.ui.createDiv('tt_timeTable_d_route', 'route', TT.ui.center.timeTable.displayDiv.id);
            TT.ui.center.timeTable.displayDiv.trainDiv = TT.ui.createDiv('tt_timeTable_d_train', 'train', TT.ui.center.timeTable.displayDiv.id);
            
            //Window
            TT.ui.createTransStationWalkTimeWindow();
        },
        createTool: function(){
            TT.ui.center.tool = TT.ui.createDiv('tt_tool', 'centerPage tool', TT.ui.centerDiv.id);
            
            //DATA Frame
            TT.ui.center.tool.dataDiv = TT.ui.createDiv('tt_tool_data', 'frameA trtc', TT.ui.center.tool.id);
            TT.ui.center.tool.dataDiv.divTitle = TT.ui.createDiv('tt_tool_data_title', 'title', TT.ui.center.tool.dataDiv.id);
            TT.ui.center.tool.dataDiv.divTitle.innerHTML = '1. TT.data 編輯工具';
            TT.ui.center.tool.dataDiv.divText1 = TT.ui.createDiv('tt_tool_data_text1', 'text', TT.ui.center.tool.dataDiv.id);
            TT.ui.center.tool.dataDiv.divText1.innerHTML = '<p>請由下方選擇要編輯的 TT.data 子節點，資料以 JSON 格式編輯。如果編輯的資料需要重新產生時刻表的選單，例如車站，請儲存完後再按右邊的<span style="color:orange">[重新產生時刻表 UI]</span> 按鈕。</p>';
            
            TT.ui.center.tool.dataDiv.divEditTool = (function(dv){
                var tagDiv = TT.ui.createDiv('tt_tool_data_edit_tag', 'tag');
                var tagSelect1 = '';
                for(var k in TT.data){
                    tagSelect1 += '<div class="tagSelect ' + k + '" tttag="' + k + '">' + k + '</div>';
                }
                tagDiv.innerHTML = tagSelect1;
                
                var editorDiv = TT.ui.createDiv('tt_tool_data_edit_editor', 'editor');
                editorDiv.innerHTML = '<textarea class="textarea" id="' + editorDiv.id + '_textarea"></textarea>' +
                    '<div class="btnDiv"><button class="btnSaveTTDataEditTool">儲存編輯完成的資料</button></div>' +
                    '<div class="btnDiv"><button class="btnRebuildTimeTableUI">重新產生時刻表 UI</button></div>';
                
                var rtDiv = TT.ui.createDiv('tt_tool_data_edit', 'edit', dv.id);
                rtDiv.className = 'editTool';
                rtDiv.fnUpdateTag = function(){
                    var ts = $('.center .editTool .tag .tagSelect');
                    ts.each(function(m){
                        ts[m].className = ts[m].className.replace(' selected','');
                    });
                    var nowTs = $('.center .editTool .tag .tagSelect.' + TT.editToolTagOn)[0];
                    nowTs.className = nowTs.className + ' selected';
                };
                rtDiv.addEventListener('click', function(e){
                    var tcls = e.target.className; 
                    
                    if(tcls.indexOf('tagSelect')>=0){
                        tttag = e.target.attributes.getNamedItem('tttag').value;
                        TT.editToolTagOn = tttag;
                        document.getElementById(editorDiv.id + '_textarea').value = TT.fn.getData2JSON(tttag);
                        rtDiv.fnUpdateTag();
                    }
                    if(tcls.indexOf('btnSaveTTDataEditTool')>=0){
                        TT.fn.saveDataJSON2Data(TT.editToolTagOn, document.getElementById(editorDiv.id + '_textarea').value);
                        TT.msg.show('已更新 TT.data.' + TT.editToolTagOn + ' 的資料');
                    }
                    if(tcls.indexOf('btnRebuildTimeTableUI')>=0){
                        TT.ui.createTimeTable();
                    }
                }, false);
                
                rtDiv.appendChild(tagDiv);
                rtDiv.tagDiv = tagDiv;
                rtDiv.appendChild(editorDiv);
                rtDiv.editorDiv = editorDiv;
                return rtDiv;
            })(TT.ui.center.tool.dataDiv);
        },
        createHeader: function(){
            var dom = document.createElement('div');
            dom.id = 'tt_headerBar';
            document.body.appendChild(dom);
            dom.className = 'headerBar';
            
            TT.ui.buttonHome = TT.ui.createHeaderButton({id: 'tt_hdBtn_home', text: '說明', clickFn: function(e){TT.ui.setCenterActive('home');}});
            TT.ui.buttonTimeTable = TT.ui.createHeaderButton({id: 'tt_hdBtn_timeTable', text: '時刻表', clickFn: function(e){TT.ui.setCenterActive('timeTable');}});
            TT.ui.buttonTool = TT.ui.createHeaderButton({id: 'tt_hdBtn_tool', text: '工具', clickFn: function(e){TT.ui.setCenterActive('tool');}});
            TT.ui.buttonBackTop = TT.ui.createHeaderButton({id: 'tt_hdBtn_backTop', text: '回到頂端', cls: 'headerButton2', clickFn: function(e){TT.ui.centerScroll(0);TT.ui.bodyScroll(0);}});
            
            dom.appendChild(TT.ui.buttonHome);
            dom.appendChild(TT.ui.buttonTimeTable);
            dom.appendChild(TT.ui.buttonTool);
            dom.appendChild(TT.ui.buttonBackTop);
        },
        createButton: function(cfg){
            //cfg = id, text, cls(class), clickFn
            if(!cfg.cls){cfg.cls = ' systemButton';}
            var div = document.createElement('div');
            div.className = cfg.cls;
            div.id = cfg.id;
            div.innerHTML = '<span>' + cfg.text + '</span>';
            div.addEventListener('click', cfg.clickFn);
            if(cfg.appendT){
                if(cfg.appendT == 'body'){
                    document.body.appendChild(dom);
                }else{
                    document.getElementById(cfg.appendT).appendChild(div);
                }
            }
            return div;
        },
        createSystemButton: function(cfg){
            if(!cfg.cls){cfg.cls = '';}
            cfg.cls = cfg.cls + ' systemButton';
            return TT.ui.createButton(cfg);
        },
        createHeaderButton: function(cfg){
            if(!cfg.cls){cfg.cls = '';}
            cfg.cls = cfg.cls + ' headerButton';
            return TT.ui.createButton(cfg);
        },
        createStatus: function(){
            var dom = document.createElement('div');
            dom.id = 'tt_statusBar';
            document.body.appendChild(dom);
            dom.className = 'statusBar';
            TT.ui.statusBar = dom;
        },
        createTakeFindButton: function(cfg){
            cfg = cfg || {};
            if(!cfg.id) cfg.id = TT.ui.genRandomId();
            if(!cfg.text) cfg.text = '尋找';
            if(!cfg.cls) cfg.cls = '';
            if(!cfg.btnCls) cfg.btnCls = '';
            if(!cfg.clickFn){
                cfg.clickFn = function(){
                    TT.ui.findBeforeTrain();
                }
            }
            
            var btn = document.createElement('button');
            btn.id = cfg.id;
            btn.className = cfg.btnCls + ' findButton';
            btn.innerHTML = cfg.text;
            btn.addEventListener('click', cfg.clickFn);
            
            var div = document.createElement('div');
            div.className = cfg.cls + ' findButtonDiv';
            div.id = cfg.id+'_div';
            
            div.appendChild(btn);
            
            if(cfg.renderID && cfg.renderID!=''){document.getElementById(cfg.renderID).appendChild(div);}
            return div;
        },
        createPreSetting: function(cfg){
            cfg = cfg || {};
            if(!cfg.id) cfg.id = TT.ui.genRandomId();
            
            var div = document.createElement('div');
            div.id = cfg.id;
            div.className = 'preSetting';
            div.innerHTML = '<div class="title">預先調整參數</div>' +
            '<div><span>' +
                '<button class="transStationWalkTimeWindow">' + '我在每個轉乘站的步行時間' + '</button>' +
            '</span></div>';
            div.addEventListener('click', function(e){
                if(e.target.className=='transStationWalkTimeWindow') TT.ui.transStationWalkTimeWindow.show();
            }, false);
            if(cfg.renderID && cfg.renderID!=''){document.getElementById(cfg.renderID).appendChild(div);}
            return div;
        },
        createMapSelector: function(){
            if(TT.ui.mapSelector) return false;
            var cfg = {}, afterSelectCbFn, win;
            var astObj = TT.fn.getCommon_allTrainStation();
            var astLine = {};
            cfg.autoScroll = false;//(TT.os.isAndroidBrowser) ? false : true;
            astObj.allAry.map(function(objA){
                var line = (objA.byLine);
                if(!astLine[line]) astLine[line] = new Array();
                astLine[line].push(objA);
            });
            
            var divLine = (function(){
                var div = document.createElement('div');
                div.className = 'line_selector';
                var allHTML, htLine = '', tmpST, htStation = ''; 
                for(var k in astLine){
                    htLine += '<div class="lineName ' + TT.defined.railBgcolor + k + '" clickOnLine="1" lineID="' + k + '">' + TT.fn.getCommon_lineName(k) + '</div>';
                    tmpST = '';
                    astLine[k].map(function(sta){
                        tmpST += '<div class="stationName ' + 'mmm'+TT.defined.railBgcolor + k + '" clickOnStation="1" stationID="' + sta.id + '">' + TT.fn.getCommon_stationDataOfID(sta.id).name + '</div>';
                    });
                    htStation += '<div style="display:none;" class="stationGroup ' + k + ' ' + TT.defined.railBgcolor + k + '" lineID="' + k + '">' + tmpST + '</div>';
                }
                htLine = '<div class="allLine">' + htLine +'</div>';
                htStation = '<div class="allStation">' + htStation +'</div>';
                allHTML = htLine + htStation;
                div.innerHTML = allHTML;
                div.headerText = '使用路線列表選擇車站';
                
                div.addEventListener('click', function(e){
                    var t = e.target;
                    if(t.attributes.getNamedItem('clickOnLine')){
                        var id = t.attributes.getNamedItem('lineID').value;
                        $('.line_selector .allLine .lineName').each(function(idx,dom){
                            dom.className = dom.className.replace(' select','');
                        });
                        $('.line_selector .allStation .stationGroup').hide();
                        $('.line_selector .allStation .stationGroup.' + id).show();
                        t.className = t.className + ' select';
                    }else if(t.attributes.getNamedItem('clickOnStation')){
                        var id = t.attributes.getNamedItem('stationID').value;
                        if(afterSelectCbFn){
                            afterSelectCbFn(id);
                        }
                        win.close();
                        TT.ui.msg.show(TT.fn.getCommon_stationDataOfID(id).name,600);
                    }
                }, false);
                return div;
            })();
            var divLineAfterFn = function(){
            
            }
            
            
            var divNet = (function(){
                var div = document.createElement('div');
                div.className = 'line_selector';
                div.headerText = '使用路網圖選擇車站';
                return div;
            })();
            
            cfg.items = [divLine, divNet];
            cfg.onShow = function(wwin, wcfg, scfg){
                //scfg from call show take parameter
                scfg = scfg || {};
                afterSelectCbFn = scfg.afterSelectCbFn;
                win = wwin;
                if(TT.lib.canvasMap && !TT.ui.mapSelector.canvasMap){
                    var canvasMap = new TT.lib.canvasMap({
                        drawPlanLine: true,
                        drawPlanLineOriginalColor: false
                        //,baseWidth: 1550, baseHeight: 2350
                    });
                    canvasMap.initAll();
                    divNet.style.width = canvasMap.cfg.baseWidth + 'px';
                    divNet.style.height = canvasMap.cfg.baseHeight + 'px';
                    divNet.appendChild(canvasMap.div);
                    TT.ui.mapSelector.canvasMap = canvasMap;
                }
            }
            TT.ui.mapSelector = new TT.lib.classMapSelector(cfg);
            TT.ui.mapSelector.el.addEventListener('click', function(e){
                var me = TT.ui.mapSelector;
                var t = e.target;
                if(t.className.indexOf('canvasTWRMapButton')!=-1){
                    if(me.itemActiveString==divNet.headerText){
                        var id = t.className.split('caTWRMap_')[1];
                        if(afterSelectCbFn){
                            afterSelectCbFn(id);
                        }
                        win.close();
                        TT.ui.msg.show(TT.fn.getCommon_stationDataOfID(id).name,600);
                    }else{
                        me.itemSwitch(divNet.headerText);
                    }
                }
                if(t.className.indexOf('canvasTWRMapClickDiv')!=-1){
                    me.itemSwitch(divNet.headerText);
                }
            }, false);
        },
        createTakeStation: function(cfg){
            cfg = cfg || {};
            if(!cfg.id) cfg.id = TT.ui.genRandomId();
            
            var astObj = TT.fn.getCommon_allTrainStation();
            var traAry = astObj.traAry, trtcAry = astObj.trtcAry, allAry = astObj.allAry;
            
            if(!TT.ui.mapSelector) TT.ui.createMapSelector();
            
            if(!cfg.fieldText) cfg.fieldText = '';
            if(!cfg.fieldStartText) cfg.fieldStartText = '出發站:';
            if(!cfg.fieldEndText) cfg.fieldEndText = '到達站:';
            var div = document.createElement('div');
            div.id = cfg.id;
            
            var optSt = (function(){
                var company, cmpStr = '', lineC, rt='';
                for(var i=0; i<allAry.length; i++){
                    company = TT.fn.getCompanyOfStation(allAry[i].id);
                    //lineC = (allAry[i].byLine) ? 'background-color:' + TT.fn.getCommon_lineColor(allAry[i].byLine) + ';' : '';
                    cmpStr = '(' + company.toUpperCase() + ')';
                    rt += '<option value="' + allAry[i].id + '" class="' + TT.defined.railBgcolor + allAry[i].byLine + '">' + allAry[i].name + cmpStr + '</option>';
                }
                return rt;
            })();
            
            var fieldTextDiv = (cfg.fieldText=='') ? '' : '<div id="' + div.id + '_fieldText">' + '<span>' + cfg.fieldText + '</span>' + '</div>';
            div.innerHTML = fieldTextDiv +
            '<div class="selectStationOut">' +
                '<div class="selectStationIn" id="' + cfg.id + '_fromin">' +
                    '<span>' + cfg.fieldStartText + '</span>' +
                    '<span><select id="' + cfg.id + '_start">' + optSt + '</select></span>' +
                    '<div class="selectStationByLine sta_from">' + '選擇車站' + '</div>' +
                    '<input type="text" class="inputStation" id="' + cfg.id + '_inputFrom" placeholder="' + '搜尋站名(拼音可)' + '" />' +
                    '<div class="selectStationExchange">' + '起訖點對調' + '</div>' +
                '</div>' +
                '<div class="selectStationIn" id="' + cfg.id + '_toin">' +
                    '<span>' + cfg.fieldEndText + '</span>' +
                    '<span><select id="' + cfg.id + '_end">' + optSt + '</select></span>' +
                    '<div class="selectStationByLine sta_to">' + '選擇車站' + '</div>' +
                    '<input type="text" class="inputStation" id="' + cfg.id + '_inputTo" placeholder="' + '搜尋站名(拼音可)' + '" />' +
                '</div>' +
            '</div>';
            
            if(cfg.renderID && cfg.renderID!=''){document.getElementById(cfg.renderID).appendChild(div);}
            
            div.addEventListener('click', function(e){
                var t = e.target, scfg = {};
                if(t.className.indexOf('selectStationByLine') != -1){
                    if(/sta_from/.test(t.className)){
                        scfg.afterSelectCbFn = function(staID){
                            div.fnSetStart(staID);
                        }
                    }else if(/sta_to/.test(t.className)){
                        scfg.afterSelectCbFn = function(staID){
                            div.fnSetEnd(staID);
                        }
                    }
                    TT.ui.mapSelector.show(scfg);
                }else if(t.className.indexOf('selectStationExchange') != -1){
                    var tmpV = div.fnGetStart();
                    div.fnSetStart(div.fnGetEnd());
                    div.fnSetEnd(tmpV);
                }else if(t.className.indexOf('inputStation') != -1){
                    renderInputEvent(t);
                }
            }, false);
            
            div.fnGetStart = function(){
                return document.getElementById(cfg.id + '_start').value;
            }
            div.fnGetEnd = function(){
                return document.getElementById(cfg.id + '_end').value;
            }
            div.fnSetStart = function(val){
                return document.getElementById(cfg.id + '_start').value = val;
            }
            div.fnSetEnd = function(val){
                return document.getElementById(cfg.id + '_end').value = val;
            }
            
            var renderInputEvent = function(t){
                var dom, isFrom = false, isTo = false;
                if(t.id== cfg.id + '_inputFrom'){ isFrom = true; }else if(t.id== cfg.id + '_inputTo'){ isTo = true; }
                if(!isFrom && !isTo) return false;
                if(t.tt_isRenderKeyEvent) return false;
                t.tt_isRenderKeyEvent = (isFrom) ? 'from' : 'to';
                
                function clearInput(){
                    t.value = '';
                }
                
                function giveValue(val){
                        var tarID = (isFrom) ? cfg.id + '_start' : cfg.id + '_end';
                        document.getElementById(tarID).value = val;
                        listDiv.style.display = 'none';
                        clearInput();
                }
                
                var listDiv = document.createElement('div');
                listDiv.className = 'inputListStation';
                listDiv.id = t.id + '_list';
                listDiv.addEventListener('click', function(e){
                    if(e.target.className=='name'){
                        var stid = e.target.attributes.getNamedItem('stid').value;
                        giveValue(stid);
                    }
                });
                
                document.body.appendChild(listDiv);
                t.tt_listDiv = listDiv;
                
                t.addEventListener('keyup', function(e){
                    var t = e.target;
                    var val = t.value.replace(/\s/g,''), displayAry = new Array(), comp;
                    var pos = $('#' + t.id).position();
                    if(t.oldValue && t.oldValue==val && e.keyCode!=13) return false;
                    t.oldValue = val;
                    var allStAry = TT.fn.findStationByString(val);
                    if(!allStAry) return false;
                    allStAry.map(function(st){
                        if(st.noShow) return false;
                        comp = TT.defined.stringSimpleOfCompany[TT.fn.getCompanyOfStation(st.id)];
                        comp = (comp) ? ' (' + comp + ')' : '';
                        displayAry.push({
                            value: st.id,
                            text: st.name + comp
                        });
                    });
                    
                    if(e.keyCode==13 && displayAry[0]){
                        giveValue(displayAry[0].value);
                        return false;
                    }
                    t.tt_listDiv.style.left = pos.left + 'px';
                    t.tt_listDiv.style.top = (pos.top+22) + 'px';
                    t.tt_listDiv.style.display = '';
                    var ht = '';
                    for(var i=0; i<displayAry.length; i++){
                        ht += '<div class="name" stid="' + displayAry[i].value + '">' + displayAry[i].text + '</div>';
                        if(i>10) break;
                    };
                    t.tt_listDiv.innerHTML = ht;
                });
                
                t.addEventListener('blur', function(e){
                    var t = e.target;
                    setTimeout(function(){if(t.tt_listDiv) t.tt_listDiv.style.display = 'none';},500);
                });
            }
            
            return div;
            
        },
        createTakeTimeFindDepArr: function(cfg){
            cfg = cfg || {};
            if(!cfg.id) cfg.id = TT.ui.genRandomId();
            if(!cfg.flagAD) cfg.flagAD = true;//true=Dep, Default Dep
            if(!cfg.fieldText) cfg.fieldText = '';
            if(!cfg.fieldDepText) cfg.fieldDepText = '出發的列車';
            if(!cfg.fieldArrText) cfg.fieldArrText = '到達的列車';
            var div = document.createElement('div');
            div.id = cfg.id;
            
            var f0ck = (cfg.flagAD) ? '' : ' checked';
            var f1ck = (cfg.flagAD) ? ' checked' : '';
            
            var fieldTextDiv = (cfg.fieldText=='') ? '' : '<div id="' + div.id + '_fieldText">' + '<span>' + cfg.fieldText + '</span>' + '</div>';
            div.innerHTML = fieldTextDiv +
            '<div class="radioAD" id="' + cfg.id + '">' +
                '<input type="radio" name="' + cfg.id + '_gp" value="1" id="' + cfg.id + '_1" ' + f1ck + '>' + '</span>' + cfg.fieldDepText + '</span>' +
                '<div style="display:inline-block;width: 50px;"></div>' +
                '<input type="radio" name="' + cfg.id + '_gp" value="0" id="' + cfg.id + '_0" ' + f0ck + '>' + '</span>' + cfg.fieldArrText + '</span>' +
            '</div>';
            
            div.fnGetValue = function(){
                return document.getElementById(cfg.id+'_1').checked;
            }
            
            if(cfg.renderID && cfg.renderID!=''){document.getElementById(cfg.renderID).appendChild(div);}
            
            return div;
        },
        createTakeTimeSelect: function(cfg){
            cfg = cfg || {};
            if(!cfg.id) cfg.id = TT.ui.genRandomId();
            if(!cfg.cls) cfg.cls = '';
            if(!cfg.fieldText) cfg.fieldText = '';
            if(!cfg.fieldStartText) cfg.fieldStartText = '從這個時間開始：';
            if(!cfg.fieldEndText) cfg.fieldEndText = '到這個時間為止：';
            var div = document.createElement('div');
            div.id = cfg.id;
            
            var hourOpt = (function(){
                var rt = '', tmp='';
                for(var i=0; i<24; i++){
                    tmp = TT.fn.transNum2StrA(i);
                    rt += '<option value="' + tmp + '">' + tmp + '</option>';
                }
                return rt;
            })();
            
            var minOpt = (function(){
                var rt = '', tmp='';
                for(var i=0; i<60; i+=5){
                    tmp = TT.fn.transNum2StrA(i);
                    rt += '<option value="' + tmp + '">' + tmp + '</option>';
                }
                return rt;
            })();
            
            var fieldTextDiv = (cfg.fieldText=='') ? '' : '<div id="' + div.id + '_fieldText">' + '<span>' + cfg.fieldText + '</span>' + '</div>';
            div.innerHTML = fieldTextDiv +
            '<div class="selectTimeOut">' +
                '<div class="selectTimeIn" id="' + cfg.id + '_startTimeDiv">' +
                    '<span>' + cfg.fieldStartText + '</span>' +
                    '<span><select id="' + cfg.id + '_startHour">' + hourOpt + '</select></span>' +
                    '<span>:</span>' + 
                    '<span><select id="' + cfg.id + '_startMin">' + minOpt + '</select></span>' +
                    '<span><div class="setNow">' + '設成現在' + '</div></span>' +
                '</div>' +
                '<div class="selectTimeIn" id="' + cfg.id + '_endTimeDiv">' +
                    '<span>' + cfg.fieldEndText + '</span>' +
                    '<span><select id="' + cfg.id + '_endHour">' + hourOpt + '</select></span>' +
                    '<span>:</span>' + 
                    '<span><select id="' + cfg.id + '_endMin">' + minOpt + '</select></span>' +
                '</div>' +
            '</div>';
            
            var sh = cfg.id + '_startHour', sm = cfg.id + '_startMin', eh = cfg.id + '_endHour', em = cfg.id + '_endMin';
            
            div.fnGetStartTime = function(){
                var h = document.getElementById(sh).value;
                var m = document.getElementById(sm).value;
                return h + ':' + m + ':00';
            }
            div.fnGetEndTime = function(){
                var h = document.getElementById(eh).value;
                var m = document.getElementById(em).value;
                return h + ':' + m + ':00';
            }
            div.fnSetStartTime = function(val){
                var aryA = val.split(':');
                document.getElementById(sh).value = aryA[0];
                document.getElementById(sm).value = aryA[1];
                return true;
            }
            div.fnSetEndTime = function(val){
                var aryA = val.split(':');
                document.getElementById(eh).value = aryA[0];
                document.getElementById(em).value = aryA[1];
                return true;
            }
            div.addEventListener('click', function(e){
                var t = e.target;
                if(t.className=='setNow'){
                    var nowT = new Date();
                    var h = nowT.getHours(), m = Math.ceil(nowT.getMinutes()/5)*5;
                    if(m==60){
                        h = (h==23) ? 0 : h+1;
                        m = 0;
                    }
                    var h2 = (h + 2) % 24;
                    var w = nowT.getDay();
                    h = h.toString();
                    h2 = h2.toString();
                    m = m.toString();
                    if(h.length==1) h = '0' + h;
                    if(h2.length==1) h2 = '0' + h2;
                    if(m.length==1) m = '0' + m;
                    div.fnSetStartTime(h + ':' + m);
                    div.fnSetEndTime(h2 + ':' + m);
                    TT.ui.center.timeTable.controlDiv.weekSelectDiv.fnSetDay(w);
                }
            }, false);
            
            if(cfg.renderID && cfg.renderID!=''){document.getElementById(cfg.renderID).appendChild(div);}
            
            return div;
        },
        createWeekSelect: function(cfg){
            cfg = cfg || {};
            if(!cfg.id) cfg.id = TT.ui.genRandomId();
            if(!cfg.cls) cfg.cls = '';
            if(!cfg.fieldText) cfg.fieldText = '星期幾要搭乘呢？';
            var div = document.createElement('div');
            div.id = cfg.id;
            
            var weekOpt = (function(){
                var rt = '', sty = '', weekStringAry = TT.defined.weekStringAry;
                for(var i=0; i<7; i++){
                    sty = (i==0) ? ' style="background-color:#FFAABC;"' : (i==6) ? ' style="background-color:#44DFAA;"' : ' style="background-color:#EEE;"'
                    rt += '<option value="' + i + '" ' + sty + '>' + weekStringAry[i] + '</option>';
                }
                return rt;
            })();
            
            div.innerHTML = '' +
            '<div class="selectWeekOut">' +
                '<div class="selectWeekIn" id="' + cfg.id + '_startTimeDiv">' +
                    '<span>' + cfg.fieldText + '</span>' +
                    '<span><select id="' + cfg.id + '_selector">' + weekOpt + '</select></span>' +
                '</div>' +
            '</div>';
            
            if(cfg.renderID && cfg.renderID!=''){document.getElementById(cfg.renderID).appendChild(div);}
            
            div.fnSetDay = function(val){
                val = val.toString();
                document.getElementById(cfg.id + '_selector').value = val;
                return val;
            }
            div.fnGetDay = function(){
                return document.getElementById(cfg.id + '_selector').value;
            }
            
            return div;
        
        },
        createTrainRouteSelectBox: function(aryRoute){
            var rDiv = TT.ui.center.timeTable.displayDiv.routeDiv;
            var sortByNow = (TT.now.sortBy) ? TT.now.sortBy : '';
            //+++++++++++ Create sort select box +++++++++++
            var sdtx = '', sDiv = document.createElement('div');
            sdtx += '<div class="tt_ck_sortby_sh" id="tt_timeTable_seSortBy_">' + '越早抵達目的地的越上面' + '</div>';
            sdtx += '<div class="tt_ck_sortby_sh" id="tt_timeTable_seSortBy_travelMinute">' + '花費時間越短的越上面' + '</div>';
            sdtx += '<div class="tt_ck_sortby_sh" id="tt_timeTable_seSortBy_transCount">' + '轉乘次數越少的越上面' + '</div>';
            sDiv.innerHTML = sdtx + '<span class="helpForSortBySelectButton"><div class="arrow"></div>' + '點一下，你可以換個排列順序' + '</span>';
            sDiv.style.borderBottom = '1px solid #23C';
            sDiv.style.backgroundColor = '#332';
            sDiv.addEventListener('click', function(e){
                var t = e.target;
                var tid = t.id.replace('tt_timeTable_seSortBy_','');
                if(sortByNow != tid){
                    var aryCk = new Array();
                    function callback(){
                        $('.tt_ck_route_sh .ckRoute').each(function(idx,domA){
                            domA.checked = aryCk[idx];
                            changeChecked(domA);
                        });
                        resetCountOfTrainRouteBox();
                        TT.ui.unmask();
                        TT.msg.show('排序已調整',500);
                    }
                    $('.tt_ck_route_sh .ckRoute').each(function(idx,domA){
                        aryCk[idx] = domA.checked;
                    });
                    if(TT.now.sortRoute.length > 100){
                        TT.ui.mask();
                        setTimeout(function(){
                            TT.ui.printTrain(TT.now.totalRoute, tid, callback);
                        },100);
                    }else{
                        TT.ui.printTrain(TT.now.totalRoute, tid, callback);
                    }
                }
            }, false);
            //+++++++++++ End sort select box +++++++++++
            var routeBy = '', routeP, tmpS = '', st = '', ht ='', fastestStr='', dmClass='', ckDom, hDiv = document.createElement('div'), sortTC = new Array();
            for(var tc=0; tc<aryRoute.length; tc++){
                routeP = aryRoute[tc];
                routeBy = ''; st = ''; tmpS='';
                for(var i=0; i<routeP.length; i++){
                    if(routeP[i].transStation){
                        tmpS += '<div class="stag">' + routeP[i].transStation.name + '</div>';
                    }
                }
                fastestStr = '(' + '最快' + ' <span class="fmin">' + TT.ui.formatMinute2HM(routeP[0].total_fastestMinute) + '</span> ' + ')&nbsp;';
                dmClass = '';
                if(routeP[0].total_fastestMinute==9999){
                    fastestStr = '(無班車)&nbsp;';
                    dmClass = ' tt_display_none';
                }
                st = '經由' + ' ' + tmpS + fastestStr;
                if(routeP.length==1 && !(routeP[0].transStation)) st = '<span class="stag ' + TT.defined.railBgcolor + routeP[0].line + '">' + TT.fn.getCommon_lineName(routeP[0].line) + '</span>' + '直達' + fastestStr;
                routeBy = '<div class="tt_ck_route_sh' + dmClass + '">' +
                    '<input type="checkbox" id="tt_timeTable_ckRoute_' + tc + '" class="ckRoute" checked>' + st +
                '</div>';
                sortTC.push({id: 'tt_timeTable_ckRoute_' + tc, tc:tc, tt_sortTime: routeP[0].total_fastestMinute, routeBy:routeBy});
                //ht += routeBy;
            }
            if(sortTC.length > 1){
                sortTC = sortTC.sort(TT.fn.getTRA_sortByTTSortTime);
                ht += '<div class="tt_ck_route_filterPri" tmf="1">1</div>';
                if(sortTC.length > 2) ht += '<div class="tt_ck_route_filterPri" tmf="2">2</div>';
                if(sortTC.length > 3) ht += '<div class="tt_ck_route_filterPri" tmf="3">3</div>';
            }
            sortTC.map(function(objA){
                ht += objA.routeBy;
            });
            hDiv.innerHTML = ht + '<span class="helpForRouteCheckBox"><div class="arrow"></div>' + '把勾取消，隱藏你不想轉乘的路徑' + '</span>';
            hDiv.style.backgroundColor = '#DEF';
            hDiv.addEventListener('click', function(e){
                var t = e.target;
                var tmf = t.attributes.getNamedItem('tmf');
                if(tmf && tmf.value){
                    var domCk;
                    tmf = parseInt(tmf.value,10);
                    //sortTC.map(function(objA,idx){
                        //domCk = document.getElementById(objA.id);
                        //if(idx<tmf){
                            //domCk.checked = true;
                        //}else{
                            //domCk.checked = false;
                        //}
                        //changeChecked(domCk);
                    //});
                    function callChangeChk(objA, idx){
                        domCk = document.getElementById(objA.id);
                        if(idx<tmf){
                            domCk.checked = true;
                        }else{
                            domCk.checked = false;
                        }
                        changeChecked(domCk);
                        idx++;
                        if(sortTC.length > idx){
                            setTimeout(function(){
                                callChangeChk(sortTC[idx], idx);
                            },10);
                        }else{
                            resetCountOfTrainRouteBox();
                            TT.ui.unmask();
                        }
                    }
                    if(TT.now.sortRoute.length > 100){
                        TT.ui.mask();
                        setTimeout(function(){ callChangeChk(sortTC[0], 0); },100);
                    }else{
                        callChangeChk(sortTC[0], 0);
                    }
                }
            }, false);
            rDiv.appendChild(sDiv);
            rDiv.appendChild(hDiv);
            function changeChecked(domCk){
                    //if(typeof(domCk)=='string') domCk = document.getElementById(domCk);
                    var ckcss = domCk.id.replace('tt_timeTable_ckRoute_','.tt_search_route_css_');
                    if(domCk.checked==true){
                        $('#' + TT.ui.center.timeTable.displayDiv.trainDiv.id + ' ' + ckcss).show();
                    }else{
                        $('#' + TT.ui.center.timeTable.displayDiv.trainDiv.id + ' ' + ckcss).hide();
                    }
            }
            function resetCountOfTrainRouteBox(){
                    var ct = 0;
                    $('#' + TT.ui.center.timeTable.displayDiv.trainDiv.id + ' .timeTableTrainRouteBox').each(function(idx,dom){
                        if(dom.style.display != 'none'){
                            ct++;
                            //$('#timeTableTrainRouteBox_' + idx + ' .sub.num span.val')[0].innerHTML = ct;//Too slow
                            document.getElementById('timeTableTrainRouteBoxCountVal_' + idx).innerHTML = ct;
                        }
                    });
            }
            for(var tc=0; tc<aryRoute.length; tc++){
                ckDom = document.getElementById('tt_timeTable_ckRoute_' + tc);
                ckDom.addEventListener('change', function(e){
                    changeChecked(e.target);
                    resetCountOfTrainRouteBox();
                }, false);
            }
            $('.tt_ck_sortby_sh').each(function(idx,dom){
                dom.className = dom.className.replace(' select','');
                var tid = dom.id.replace('tt_timeTable_seSortBy_','');
                if(tid==sortByNow){
                    dom.className = dom.className + ' select';
                }
            });
        },
        createTrainRouteTimeBox: function(routeP, ct, renderID){
            if(!renderID) renderID = TT.ui.center.timeTable.displayDiv.trainDiv.id;
            var id = 'timeTableTrainRouteBox_' + ct;
            var div = document.createElement('div');
            div.className = 'timeTableTrainRouteBox' + ' tt_search_route_css_' + routeP.routeIndex;
            div.id = id;
            
            function createTimeBox(tbd, startTime, endTime){
                if(tbd.doNotTakeTrain) return '';
                var st = Math.ceil(TT.fn.transTime2Sec(startTime)/60),
                    ed = Math.ceil(TT.fn.transTime2Sec(endTime)/60),
                    min;
                
                if(ed < st) ed = 1440 + ed;
                min = ed - st;
                
                return '<div class="timeBox">' +
                    '<div class="value start">' + TT.fn.transTime2HM(startTime) + '</div>' +
                    '<div class="deep"><div class="minute">' + TT.ui.formatMinute2HM(min) + '</div></div>' +
                    '<div class="value end">' + TT.fn.transTime2HM(endTime) + '</div>' +
                '</div>';
            }
            function createStationBox(tbd, a, b, line){
                var aObj = TT.fn.getCommon_stationDataOfID(a);
                var bObj = TT.fn.getCommon_stationDataOfID(b);
                if(tbd.doNotTakeTrain) return aObj.name;
                
                return '<div class="stationBox">' +
                    '<div class="value from">' + aObj.name + '</div>' +
                    '<div class="deep"><div class="line_color ' + line + '"><div class="bd"></div></div>' + '</div>' +
                    '<div class="value to">' + bObj.name + '</div>' +
                '</div>';
            }
            
            function createInfoBox(tbd, info, line){
                if(tbd.doNotTakeTrain) return '';
                var rt = '';
                if(TT.fn.getCompanyOfLine(line)=='tra'){//TRA info
                    var se = '', st = TT.fn.getTRA_stationDataOfID('tra_' + info['TimeInfo'][0].Station).name,
                        ed = TT.fn.getTRA_stationDataOfID('tra_' + info['TimeInfo'][info['TimeInfo'].length-1].Station).name;
                    if(st && ed) se = '<div>' + '[' + st + ' -&gt; ' + ed + ']' + '</div>';
                    rt = '<div class="infoBox">' +
                        se +
                        '<div>' + '車次: ' + info['Train'] + '</div>' +
                        '<div>' + '車種: ' + TT.fn.getTRA_carClassName(info['CarClass'], {color: true}) + '</div>' +
                    '</div>';
                }else if(TT.fn.getCompanyOfLine(line)=='trtc'){
                    var trtcSpe = '捷運到站時間是以官方站間行駛時間做相對計算。';
                    var outArea=TT.fn.getTRTC_stationOnOutArea(tbd.takeRange[0], tbd.takeRange[1], line);
                    if(outArea){
                        trtcSpe = '請留意是否需在<span class="defineFontStyle1">' + TT.fn.getTRTC_stationDataOfID(outArea.transAt).name + '</span>改搭下一班車，因目的地並非每班車都有到。';
                    }
                    rt = '<div class="infoBox">' +
                        '<span class="trtcArriveTimeInfo">' + trtcSpe + '</span>' +
                    '</div>';
                }
                return rt;
            }
            
            function createLineBox(tbd, line){
                var rt = '',
                    name = TT.fn.getCommon_lineName(line);//,
                    //color = TT.fn.getCommon_lineColor(line);
                //var ary = name.split(']');
                //rt = ary[0] + ']' + '<span style="color:' + color + ';">' + ary[1] + '</span>';
                rt = '<span class="' + TT.defined.railBgcolor + line + '">' + name + '</span>';
                return rt;
            }
            
            function createTransStationBox(ts, st){
                var vLink = '';
                if(ts.video && ts.video[st]){
                    vLink = '<div class="transStationVideoClick" tsid="' + ts.id + '" stid="' + st + '">轉乘教學</div>';
                }
                return '轉乘步行時間: ' + ts.walkMinute + '分鐘' + vLink;
            }
            
            var hDiv = document.createElement('div');
            hDiv.className = 'header';
            hDiv.innerHTML = '<div class="sub num">' + 'NO. ' + '<span class="val" id="timeTableTrainRouteBoxCountVal_' + ct + '">' + (ct+1) + '</span>' + '</div>' + 
                '<div class="sub count">' + '轉乘次數: ' + '<span class="val">' + (routeP.routeMap.length-1) + '</span>' + '</div>' + 
                '<div class="sub totalTime">' + '花費時間: ' + '<span class="val">' + TT.ui.formatMinute2HM(routeP.travelMinute) + '</span>' + '</div>' +
                '<div class="sub startTime">' + '開始時間: ' + '<span class="val">' + routeP.travelStartTime + '</span>' + '</div>' +
                '<div class="sub endTime">' + '到達時間: ' + '<span class="val">' + routeP.travelEndTime + '</span>' + '</div>' +
                '<div class="sub printCanvas" printid="' + id + '">' + '截圖' + '</div>';
            
            hDiv.addEventListener('click', function(e){
                var dom = e.target;
                if(dom.className.indexOf('printCanvas') != -1){
                    var pid = e.target.attributes.getNamedItem('printid').value;
                    var targetBox = $('#' + pid);
                    if(targetBox[0].offsetTop) TT.ui.centerScroll(targetBox[0].offsetTop-38, true);
                    TT.html2canvas(targetBox, {
                        onrendered: function(imgA) {
                            if(imgA && imgA.toDataURL){
                                window.open(imgA.toDataURL("image/png"));
                            }else{
                                TT.msg.show('截圖失敗，可能是瀏覽器長寬不足截下整張圖片');
                            }
                        }
                    });
                }
            }, false);
            var tDiv = document.createElement('div');
            tDiv.className = 'timeRouteDiv';
            var tTD = (function(){
                var td = '', tbd;
                for(var i=0; i<routeP.routeMap.length; i++){
                    tbd = routeP.routeMap[i];
                    td += '<tr>' +
                        '<td class="sect">' + (i+1) + '</td>' +
                        '<td class="time">' + createTimeBox(tbd, tbd.time[0], tbd.time[1]) + '</td>' +
                        '<td class="station">' + createStationBox(tbd, tbd.takeRange[0], tbd.takeRange[1], tbd.line) + '</td>' +
                        '<td class="info">' + createInfoBox(tbd, tbd.info, tbd.line) + '</td>' +
                        '<td class="line">' + createLineBox(tbd, tbd.line) + '</td>' +
                        '<td class="other">' + '' + '</td>' +
                    '</tr>';
                    if(tbd.transStation){
                        td += '<tr>' +
                            '<td></td>' +
                            '<td class="time"></td>' +
                            '<td colspan="3" class="transStation">' + createTransStationBox(tbd.transStation, tbd.takeRange[1]) + '</td>' +
                            '<td></td>' +
                        '</tr>';
                    }
                }
                return td;
            })();
            tDiv.innerHTML = '<div class="more btn">&gt;&gt;</div>' +
            '<table class="table" cellspacing="5" cellpadding="6">' +
                '<tr>' +
                    '<th class="sect">' + '區段' + '</td>' +
                    '<th class="time">' + '列車時刻' + '</td>' +
                    '<th class="station">' + '車站' + '</td>' +
                    '<th class="info">' + '列車資訊' + '</td>' +
                    '<th class="line">' + '路線資訊' + '</td>' +
                    '<th class="other">' + '其他' + '</td>' +
                '</tr>' +
                tTD +
            '</table>';
            tDiv.addEventListener('click', function(e){
                if(e.target.className.indexOf('more btn')!=-1){
                    e.target.parentNode.className += ' showAll';
                }
                if(e.target.className.indexOf('transStationVideoClick')!=-1){
                    var tsid = e.target.attributes.getNamedItem('tsid').value,
                        stid = e.target.attributes.getNamedItem('stid').value;
                    
                    var tsObj = TT.fn.getRoute_transStationById(tsid);
                    if(tsObj.video && tsObj.video[stid]){
                        TT.ui.displayTransVideo(tsObj.video[stid]);
                    }
                }
            }, false);
            div.appendChild(hDiv);
            div.appendChild(tDiv);
            document.getElementById(renderID).appendChild(div);
        },
        createTransStationWalkTimeWindow: function(){
            var id = 'tt_transStationWalkTimeWindow:';
            if(!TT.ui.transStationWalkTimeWindow){
                
                function updateCDiv(){
                    var aryT = TT.data.transStation, ht='', mt='', st='', st1='', st2='', inputID='';
                    for(var i=0; i<aryT.length; i++){
                        mt = '在<span class="stationName">{st}</span>往返{st1}與{st2}間的步行時間';
                        st = aryT[i].name;
                        st1 = TT.fn.getCommon_lineName(aryT[i]["changeLine"][0]);
                        st2 = TT.fn.getCommon_lineName(aryT[i]["changeLine"][1]);
                        mt = mt.replace('{st}',st).replace('{st1}',st1).replace('{st2}',st2);
                        ht += '<div><input class="minute" type="text" id="' + id + aryT[i].id + '" value="' + aryT[i].walkMinute + '"><span>' + '分鐘' + ' , ' + mt + '</span></div>';
                    }
                    cDiv.innerHTML = ht;
                }
                
                function updateData(){
                    var aryT = TT.data.transStation, stid='', domA;
                    for(var i=0; i<aryT.length; i++){
                        stid = aryT[i].id;
                        domA = document.getElementById(id + stid);
                        if(domA){
                            aryT[i].walkMinute = parseInt(domA.value, 10);
                        }
                    }
                }
                
                var cDiv = TT.ui.createDiv(id + 'c', 'contentBox');
                var bDiv = TT.ui.createDiv(id + 'b', 'buttonBox');
                bDiv.innerHTML = '<span><button id="' + id + 'save">' + '儲存' + '</button></span>' +
                    '<span><button id="' + id + 'cancel">' + '取消' + '</button></span>';
                bDiv.addEventListener('click', function(e){
                    var bid= e.target.id.replace(id,'');
                    if(bid=='save'){
                        updateData();
                        win.close();
                    }
                    if(bid=='cancel'){
                        win.close();
                    }
                },false);
                var win = new TT.lib.classWindow({
                    id: id,
                    items: [cDiv, bDiv],
                    mask: true,
                    cls: 'transStationWalkTimeWindow',
                    onShow: function(thisA){
                        TT.ui.centerTimeTableDisplayDivClear();
                        updateCDiv();
                        thisA.resetPosition();
                    }
                });
                TT.ui.transStationWalkTimeWindow = win;
            }
        },
        displayTransVideo: function(cfg){
            cfg = cfg || {};
            cfg.width = (cfg.width) ? cfg.width : 640;
            cfg.height = (cfg.height) ? cfg.height : 480;
            function renderInner(ww){
                        var ifm = '<iframe width="' + ww.vcfg.width + '" height="' + ww.vcfg.height + '" src="' + ww.vcfg.src + '" frameborder="0" allowfullscreen></iframe>';
                        ww.inner.innerHTML = ifm;
            }
            if(!this.win){
                this.win = new TT.lib.classWindow({
                    mask: true,
                    onShow: function(ww){
                        renderInner(ww);
                    }
                });
            }
            
            var win = this.win;
            win.el.style.width = (cfg.width + 30) + 'px';
            win.el.style.height = (cfg.height + 60) + 'px';
            win.vcfg = cfg;
            win.show();
            
            
        },
        findBeforeTrain: function(cbFn){
            TT.ui.findTrain(cbFn);
        },
        findTrain: function(cbFn){
            var w = TT.ui.center.timeTable.controlDiv.weekSelectDiv.fnGetDay();
            var localDataFn = TT.fn.localData;
            function fnAfterCheck(){
                
                var controlDiv = TT.ui.center.timeTable.controlDiv;
                var startTime = controlDiv.timeSelectDiv.fnGetStartTime();
                var endTime = controlDiv.timeSelectDiv.fnGetEndTime();
                var flagAD = controlDiv.depArrDiv.fnGetValue();
                var a = controlDiv.stationSelectDiv.fnGetStart();
                var b = controlDiv.stationSelectDiv.fnGetEnd();
                //var w = controlDiv.weekSelectDiv.fnGetDay();
                
                var aryRoute = TT.fn.getCommon_timeRangeBestByFromTo(a,b,startTime,endTime,flagAD,w);
                TT.ui.printStatus('尋找列車班次完成');TT.msg.show('尋找完成',200);
                TT.ui.printTrain(aryRoute,'', cbFn);
                
                localDataFn.setItem('defaultFromStation', a);
                localDataFn.setItem('defaultToStation', b);
                localDataFn.setItem('defaultStartTime', startTime);
                localDataFn.setItem('defaultEndTime', endTime);
                
                //rewrite url Get param
                var sObj = {
                    a: a,
                    b: b,
                    w: w,
                    startTime: startTime,
                    endTime: endTime
                }
                var sParam = '?a=' + a + '&b=' + b + '&w=' + w + //'&findTrain=1' +
                     '&startTime=' + encodeURIComponent(startTime) +
                     '&endTime=' + encodeURIComponent(endTime);
                if(window.history) history.pushState(sObj,'',sParam)
            }
            
            function fnCheck(){
                var a1 = TT.fn.checkTRA_dayTimeIsLoaded(w);
                if(!a1){
                    TT.fn.getTRA_TimeTable2Data(w, fnCheck);
                    return false;
                }
                var a2 = TT.fn.checkTRTC_rnwTimeTableIsLoaded();
                if(!a2){
                    TT.fn.getTRTC_timeTable2Data(fnCheck);
                    return false;
                }
                fnAfterCheck();
            }
            fnCheck();
        },
        formatMinute2HM: function(mi){
            if(typeof(mi)=='string' && mi.indexOf(':') > 0){
                mi = Math.ceil(TT.fn.transTime2Sec(mi)/60)
            }
            
            if(mi<60){
                return mi + ' 分';
            }else{
                return Math.floor(mi/60) + ' 小時 ' + (mi % 60) + ' 分';
            }
        },
        genRandomId: function(){
            return 'ttGenID_' + TT.ui.randomIdNum++;;
        },
        getCenterPage: function(str){
            for(var k in TT.ui.center){
                if(TT.ui.center[k].id == 'tt_' + str){
                    return TT.ui.center[k];
                }
            }
            return false;
        },
        getCenterActive: function(){
            for(var k in TT.ui.center){
                if(TT.ui.center[k].className.indexOf('show')>=0){
                    return TT.ui.center[k];
                }
            }
            return false;
        },
        setCenterActive: function(str){
            for(var k in TT.ui.center){
                TT.ui.center[k].className = TT.ui.center[k].className.replace(' show','');
                if(TT.ui.center[k].id == 'tt_' + str){
                    var dom = TT.ui.center[k];
                    TT.ui.center[k].className = TT.ui.center[k].className + ' show';
                }
            }
            return dom;
        },
        mask: function(str){
            if(TT.ui.maskDiv.className.indexOf('show')<0){
                TT.ui.maskDiv.className = TT.ui.maskDiv.className + ' show';
            }
            if(str){
                TT.ui.maskText.innerHTML = str;
            }else{
                TT.ui.maskText.innerHTML = TT.defined.defaultMaskText;
            }
        },
        unmask: function(){
            TT.ui.maskDiv.className = TT.ui.maskDiv.className.replace(' show','');
        },
        msg: (function(){
            var rt = {};
            rt.show = function(str, delay){
                delay = (delay) ? delay : 3000;
                var div = TT.ui.createDiv('_gen', 'msg show', 'body');
                div.innerHTML = str;
                var divWidth = div.offsetWidth, divHeight = div.offsetHeight;
                var dw = TT.fn.getDocumentWidth(), dh = TT.fn.getDocumentHeight();
                div.style.top = (dh - divHeight) / 2 + 'px';
                div.style.left = (dw - divWidth) / 2 + 'px';
                var time1 = setTimeout(function(){
                    div.className += ' afterEffect';
                },delay);
                var time2 = setTimeout(function(){
                    document.body.removeChild(div);
                },delay+1000);
                div.addEventListener('click', function(e){
                    clearTimeout(time1);
                    clearTimeout(time2);
                    document.body.removeChild(div);
                }, false);
                return div;
            }
            rt.alert = function(st){
                alert(st);
            }
            
            return rt;
        })(),
        printStatus: function(str){
            TT.ui.statusBar.innerHTML = str;
        },
        printTrain: function(aryRoute, sortBy, cbFn){
            var controlDiv = TT.ui.center.timeTable.controlDiv;
            var startTime = controlDiv.timeSelectDiv.fnGetStartTime();
            var endTime = controlDiv.timeSelectDiv.fnGetEndTime();
            var flagAD = controlDiv.depArrDiv.fnGetValue();
            var a = controlDiv.stationSelectDiv.fnGetStart();
            var b = controlDiv.stationSelectDiv.fnGetEnd();
            
            //sortBy: '', 'travelMinute'
            var fRouteAry = TT.fn.mixAllRoute(aryRoute, flagAD, sortBy);
            TT.now = {
                totalRoute: aryRoute,
                sortRoute: fRouteAry,
                sortBy: sortBy
            }
            
            var tDiv;
            //Clear Old
            document.getElementById(TT.ui.center.timeTable.displayDiv.routeDiv.id).innerHTML = '';
            document.getElementById(TT.ui.center.timeTable.displayDiv.trainDiv.id).innerHTML = '';
            TT.ui.createTrainRouteSelectBox(aryRoute);
            for(var i=0; i<fRouteAry.length; i++){
                tDiv = TT.ui.createTrainRouteTimeBox(fRouteAry[i], i);
            }
            if(fRouteAry.length==0) TT.msg.show('糟糕，系統找不到這個時間內的列車！');
            if(TT.fn.checkIsFunction(cbFn)) cbFn();
        },
        resizeFn: function(e){
            var h = TT.fn.getDocumentHeight();
            var w = TT.fn.getDocumentWidth();
            var ch = h - 64;
            if(ch < 0) ch = 0;
            if(TT.os.isAndroidBrowser){
                TT.ui.centerDiv.style.height = 'auto';
            }else{
                TT.ui.centerDiv.style.height = ch + 'px';
            }
        },
        transWeekToString: function(w){
            w = parseInt(w,10);
            var ary = ['日','一','二','三','四','五','六'];
            return '星期' + ary[w];
        },
        updateCenter: function(cmd){
            if(!cmd || /home/g.test(cmd)){
                var aryCkWeekLoaded = $('.center .home .frameA.tra div.ckWeekLoaded').hide();
                if(TT.data.tra.timeTable){
                    for(var i=0; i<TT.data.tra.timeTable.length; i++){
                        if(TT.fn.checkTRA_dayTimeIsLoaded(i)){
                            document.getElementById('tt_home_tra_ckWeekLoaded_' + i).style.display = '';
                        }
                    }
                }
                TT.data.tra.timeTable
            }
        }
    }
    
    TT.msg = TT.ui.msg;
    TT.initFn = function(){
        //Remove HTML Element
        //var msff = document.getElementById(new Array('pre','_g','_text').join(''));
        //msff.innerHTML = '';
        //msff.style.display = 'none';
        //msff.remove();
        //.....
        TT.ui.createBaseDiv();
        TT.ui.createHeader();
        TT.ui.createStatus();
        
        TT.ui.createHome();
        TT.ui.createTimeTable();
        TT.ui.createTool();
        TT.ui.setCenterActive('timeTable');//home
        TT.ui.updateCenter();
        TT.msg.show('歡迎使用接軌時刻 Web APP。',2000);
        
        //TT.fn.getTRTC_timeTable2Data();//Initital get TRTC time
        //Check if auto search
        var GetP = TT.defined.GetP;
        if(GetP && GetP['findTrain'] && GetP['findTrain']==1) TT.ui.findTrain();
        
        //Resize function
        window.addEventListener('resize', TT.ui.resizeFn, false);
        TT.ui.resizeFn();
    }
        
    return TT;
})();

</script>
<script type="text/javascript" src="canvasTaiwanRailwayMap.js"></script>
<script type="text/javascript" src="html2canvas.js"></script>
<!-- -->
<!-- -->
</head>
<body onload="TT.initFn()">
    <!--
    <div id="pre_g_text">
        <p>接軌時刻，台灣的鐵路、火車、捷運 等運行之 時刻表以及路線轉乘查詢系統 </p>
        <p>Taiwan Railway MRT Timetable Search System</p>
        <p>提供您查詢[台鐵]轉[捷運]或[MRT]轉[火車]等多種需求</p>
        <ul>
            <li>淡水線、信義線、淡水信義線</li>
            <li>新店線、松山線、松山新店線</li>
            <li>中和線、新莊線、蘆洲線、中和新蘆線</li>
            <li>板橋線、南港線、板南線</li>
            <li>火車、台鐵、台灣鐵路局西部幹線縱貫線</li>
        </ul>
    </div>
    -->
</body>
</html>
